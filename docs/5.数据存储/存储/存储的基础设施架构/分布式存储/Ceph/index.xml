<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Ceph on 断念梦的站点</title><link>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/</link><description>Recent content in Ceph on 断念梦的站点</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/index.xml" rel="self" type="application/rss+xml"/><item><title>Ceph</title><link>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph/</guid><description>概述 参考：
官网 官方文档 Wiki, Ceph https://blog.csdn.net/younger_china/article/details/73410727 Ceph 是一个开源的分布式存储系统，可以提供 对象存储、快存储、文件存储 能力。是一个 Software Defined Storage(软件定义存储) 的代表性产品。
一个 Ceph 存储集群至少需要 Ceph Monitor、Ceph Manager、Ceph OSD 这三个组件；如果要运行 Ceph 文件系统客户端，则也需要 Ceph MDS。
Monitor # Ceph Monitor(Ceph 监视器，简称 ceph-mon) 负责维护集群状态的映射关系。通常至少需要 3 个 ceph-mon 以实现高可用，多节点使用 Paxos 算法达成共识。 可以这么说，Ceph 集群就是指 ceph-mon 集群。ceph-mon 负责维护的集群状态，就是用来提供存储服务的。 ceph-mon 映射、ceph-mgr 映射、ceph-osd 映射、ceph-mds 映射、ceph-crush 映射。这些映射是 Ceph 守护进程相互协调所需的关键集群状态，说白了，就是映射关系。 这里的映射，英文用的是 Map，其实也有地图的意思，就是表示这个集群有多少个 ceph-mon、有多少个 ceph-mgr 等等，还有底层对象属于哪个 PG，等等等等，这些东西构成了一副 Ceph 的运行图。 ceph-mon 还负责管理守护进程和客户端之间的身份验证。 Manager # Ceph Manager(Ceph 管理器，简称 ceph-mgr) 负责跟踪运行时指标和 Ceph 集群的当前状态，包括存储利用率、性能、系统负载等。通常至少需要 2 个 ceph-mgr 以实现高可用。 ceph-mgr 可以提供 Web 管理页面、关于 Ceph 集群的 Prometheus 格式的监控指标 OSD Daemon # Ceph OSD Daemon(Ceph OSD 守护进程，简称 ceph-osd) 负责向 OSD 读写数据、处理数据复制、恢复、重新平衡，并通过检查其他 ceph-osd 的心跳向 ceph-mon 和 ceph-mgr 提供一些监控信息。通常至少需要 3 个 ceph-osd 以实现高科用。 Object Storage Device(对象存储设备，简称 OSD) 是一个物理或逻辑上的存储单元(比如一块硬盘)，这是 Ceph 得以运行的最基本的存储单元。 有的时候，人们容易把 OSD 理解为 Ceph OSD Daemon，这俩是有本质区别的。因为在最早的时候，OSD 有两种含义，一种是 Object Storage Device 另一种是 Object Storage Daemon。由于这种称呼的模糊性，后来就将 Object Storage daemon 扩展为 OSD Daemon。OSD 则仅仅代表 Object Storage Device。只不过运行 OSD Daemon 的程序名称，依然沿用了 osd 的名字。 注意，为了让每一个 OSD 都可以被单独使用并管理，所以每个 OSD 都有一个对应的 ceph-osd 进程来管理。一般情况，Ceph 集群中每个节点，除了系统盘做 Raid 以外，其他硬盘都会单独作为 OSD 使用，且一个节点会有大量磁盘来对应 OSD。 MDS # Ceph Metadata Server(Ceph 元数据服务器，简称 ceph-mds) 代表 Ceph 文件系统元数据。ceph-mds 允许 POSIX 文件系统用户执行基本命令(比如 ls、find 等)，而不会给 Ceph 集群带来巨大负担。 注意，Ceph 提供的 块存储 和 对象存储 功能并不使用 ceph-mds。 架构 参考：</description></item><item><title>API</title><link>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/API/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/API/</guid><description>概述 Ceph RESTful API 参考：
官方文档，Ceph 管理器守护进程-Ceph RESTful API GitHub，ceph/ceph/src/pybind/mgr/dashboard/openapi.yaml(该 API 的 openapi 文件) 在 Dashboard 模块中，提供了一组用于管理集群的 RESTful 风格的 API 接口。这组 API 默认位于 https://localhost:8443/api 路径下
在 /docs 端点下，可以查看 OpenAPI 格式的信息
在 /dpcs/api.json 端点可以获取 openapi 格式的 API 信息。
/api/auth /api/auth 接口获取 Token
curl -X POST &amp;#34;https://example.com:8443/api/auth&amp;#34; \ -H &amp;#34;Accept: application/vnd.ceph.api.v1.0+json&amp;#34; \ -H &amp;#34;Content-Type: application/json&amp;#34; \ -d &amp;#39;{&amp;#34;username&amp;#34;: &amp;lt;username&amp;gt;, &amp;#34;password&amp;#34;: &amp;lt;password&amp;gt;}&amp;#39; 获取 Token 后，其他接口，都可以使用该 Token 进行认证，比如：
curl -H &amp;#34;Authorization: Bearer $TOKEN&amp;#34; ...... /api/auth/check /api/auth/check 接口可以检查 Token。通常还可以作为对 API 的健康检查接口。</description></item><item><title>Ceph 部署</title><link>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph-%E9%83%A8%E7%BD%B2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph-%E9%83%A8%E7%BD%B2/</guid><description>概述 参考：
官方文档, Cephadm 以 pacific 版本为例 安装 cephadm 在所有节点安装 cephadm，这是一个 python 程序，当通过第一个节点让其他节点加入集群时，会调用待加入节点中的 cephadm 程序。
curl --silent --remote-name --location https://github.com/ceph/ceph/raw/pacific/src/cephadm/cephadm chmod +x cephadm ./cephadm add-repo --release pacific ./cephadm install cephadm install ceph-common 引导第一个节点 cephadm bootstrap --mon-ip 192.168.1.201 配置 ceph CLI cephadm install ceph-common 其他 # 开启遥测，发送数据给官方 ceph telemetry on 添加其他节点 # 添加认证信息 ssh-copy-id -f -i /etc/ceph/ceph.pub root@192.168.1.202 ssh-copy-id -f -i /etc/ceph/ceph.pub root@192.168.1.203 # 添加节点 ceph orch host add hw-cloud-xngy-ecs-test-0002 192.168.1.202 ceph orch host add hw-cloud-xngy-ecs-test-0003 192.</description></item><item><title>Ceph 故障排查笔记</title><link>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph-%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E7%AC%94%E8%AE%B0/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph-%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E7%AC%94%E8%AE%B0/</guid><description>参考：公众号,云原声实验室-Ceph 故障排查笔记 | 万字经验总结
Ceph OSD 异常无法正常启动 当某个 OSD 无法正常启动时：
$ ceph -s cluster: id: b313ec26-5aa0-4db2-9fb5-a38b207471ee health: HEALTH_WARN Degraded data redundancy: 177597/532791 objects degraded (33.333%), 212 pgs degraded, 212 pgs undersized application not enabled on 3 pool(s) mon master003 is low on available space 1/3 mons down, quorum master002,master003 services: mon: 3 daemons, quorum master002,master003, out of quorum: master001 mgr: master003(active), standbys: master002 mds: kubernetes-1/1/1 up {0=master002=up:active}, 1 up:standby osd: 2 osds: 2 up, 2 in data: pools: 5 pools, 212 pgs objects: 177.</description></item><item><title>Ceph 命令行工具</title><link>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/5.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/Ceph-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</guid><description>概述 参考：
官方文档,Ceph 存储集群-手册页 官方文档,Ceph 对象网关-radosgw-admin 手册页 ceph # Ceph 管理工具 一个 Python 实现的脚本工具，用于手动部署和似乎 Ceph 集群。通过很多的子命令，允许部署 ceph-mon、ceph-osd、PG、ceph-mds 等，并可以对集群整体进行维护和管理。
orch Orchestrator(编排器，简称 orch)
Syntax(语法) COMMAND
host # 对集群中的节点进行管理 add &amp;lt;HOSTNAME&amp;gt; [ADDR] [LABELs&amp;hellip;] [&amp;ndash;maintenance] # 向集群中添加一个节点 label add &amp;lt;HOSTNAME&amp;gt; &amp;lt;LABEL&amp;gt; # 为节点添加一个标签 ls # 列出 Orch 已知的服务 rm &amp;lt;ServiceName&amp;gt;# 移除一个服务 EXAMPLE
radosgw-admin # RADOS 网关的用户管理工具 radosgw-admin 是一个 RADOS 网关用户的管理工具。可以增删改查用户。该工具通过非常多的子命令进行管理，并且每个子命令可用的选项也各不相同，Ceph 官方对这个工具的提示做的非常不好，子命令需要带的选项并不提示，只能自己尝试~~~
user Syntax(语法) radosgw-admin user COMMAND [OPTIONS]
COMMAND
user create &amp;ndash;display-name=&amp;lt;STRING&amp;gt; &amp;ndash;uid=&amp;lt;STRING&amp;gt; # 创建一个新用户 user info [&amp;ndash;uid=&amp;lt;STRING&amp;gt; | &amp;ndash;access-key=&amp;lt;STRING&amp;gt;] # 显示一个用户的信息，包括其子用户和密钥。通过 uid 或 ak 指定要显示的用户。 user list # 列出所有用户 user modify &amp;ndash;uid=&amp;lt;STRING&amp;gt; # 修改指定的用户 OPTIONS</description></item></channel></rss>