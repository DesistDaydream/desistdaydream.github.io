<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>LVS on 断念梦的站点</title><link>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/</link><description>Recent content in LVS on 断念梦的站点</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/index.xml" rel="self" type="application/rss+xml"/><item><title>LVS</title><link>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/LVS/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/LVS/</guid><description>概述 参考：
Wiki, LVS Wiki, IPVS 官网 官网,中文 官方文档，HOWTO Linux Virtual Server(Linux 虚拟服务器，简称 LVC) 是一个可以实现虚拟的服务器集群功能的项目，用于实现负载均衡的软件技术。一般情况下，LVS 代之一组服务器，对于外部客户端来说，这似乎是一台服务器，所以，也称为 。
目前，LVS 项目已经被集成到 Linux 内核中，并通过 IPVS模块实现。LVS 具有良好的可靠性、可扩展性和可操作性，加上其实现最优的集群服务性能所需的低廉成本， LVS 的负载均衡功能经常被用于高性能、高可用的服务器群集中。
LVS 项目在 1998 年 5 月由章文嵩博士成立，是中国国内最早出现的自由软件项目之一。在 linux2.2 内核时，IPVS 就已经以内核补丁的形式出现。从 2.4 版本以后 IPVS 已经成为 Linux 内核官方标准内核的一部分
名词解释 调度器的称呼：scheduler，director，dispatcher，balancer
Director(指挥器) # 运行 IPVS 的节点。
IPVS(IP 虚拟服务) # 实现调度功能的程序。是一个 Linux 内核模块。实际上，IPVS 就是一个 Schedulers(调度器)。 Forwarding Method(转发方法) # Forwarding Method 用来确定 Director 如何将数据包从客户端转发到 Real Servers。如果把 Director 比做路由器，其转发数据包的规则与普通路由器有所不同。 Forwarding Method 其实就是指 LVS 的工作模式，当前有 LVS-NAT、LVS-DR、LVS-TUN 这几种。 ipvsadm # 为 IPVS 程序配置调度规则的用户端应用程序。 Real Server(真实服务器，简称 RS) # 处理来自客户端请求的节点</description></item><item><title>LVS 配置示例</title><link>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/LVS-%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/LVS-%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</guid><description>概述 参考：
DR 模型配置样例 Director 配置
ipvsadm -A -t 10.10.100.107:80 -s rr ipvsadm -a -t 10.10.100.107:80 -r 10.10.100.111 -g ipvsadm -a -t 10.10.100.107:80 -r 10.10.100.112 -g RS 的配置
设置 arp 参数
cat &amp;gt; /etc/sysctl.d/lvs-sysctl.conf &amp;lt;&amp;lt; EOF net.ipv4.conf.all.arp_ignore = 1 net.ipv4.conf.lo.arp_ignore = 1 net.ipv4.conf.all.arp_announce = 2 net.ipv4.conf.lo.arp_announce = 2 EOF sysctl -p /etc/sysctl.d/* 配置 lo 网卡
cat &amp;gt; /etc/sysconfig/network-scripts/ifcfg-lo:0 &amp;lt;&amp;lt; EOF DEVICE=lo:0 IPADDR=10.10.100.107 NETMASK=255.255.255.255 ONBOOT=yes NAME=loopback EOF ifup ifcfg-lo\:0 其他配置样例 配置一个 NAT 类型（2 台 RS）的集群 LVS(Thinkpad): if1=172.</description></item><item><title>IPVS</title><link>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/IPVS/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/IPVS/</guid><description>概述 参考：
Wiki, IPVS 官方文档 IP Virtual Service(IP 虚拟服务，简称 IPVS) 是基于 Netfilter 的 Linux 内核模块，用来实现 LVS 集群中的 Scheduler(调度器) 功能。启动这个模块的 Linux 服务器就变成了 LVS 系统中的 Director，此时，这个服务器可以看作是一种高效的 Layer-4(四层) 交换机。在 Director 上运行 IPVS 代码是 LVS 的基本要素。
IPVS 在服务器上运行，并充当 RS 集群前面的负载均衡器。IPVS 可以将基于 TCP 和 UDP 的服务请求定向到真实服务器，并使真实服务器的服务在单个 IP 地址上表现为虚拟服务。当一个 TCP 连接的初始 SYN 报文到达时，IPVS 就选择一台服务器，将报文转发给它。此后通过查发报文的 IP 和 TCP 报文头地址，保证此连接的后继报文被转发到相同的服务器。这样，IPVS 无法检查到请求的内容再选择服务器，这就要求后端的服务器组是提供相同的服务，不管请求被送到哪一台服务器，返回结果都应该是一样的。但是在有一些应用中后端的服务器可能功能不一，有的是提供 HTML 文档的 Web 服务器，有的是提供图片的 Web 服务器，有的是提供 CGI 的 Web 服务器。这时，就需要基于内容请求分发 (Content-Based Request Distribution)，同时基于内容请求分发可以提高后端服务器上访问的局部性。
一个 ipvs 主机可以同时定义多个 cluster service 一个 cluster service 上至少应该定义一个 real server，定义时指明 lvs-type，以及 lvs scheduler 用白话理解 IPVS： IPVS 就是包括 Director 和 RS 在内的所有设备上的 IP，统一虚拟成一个 IP，这个 IP 就是面向用户的唯一 IP，用户通过这个 IP，就可以访问集群，让集群为其提供服务，这也是负载均衡的体现，也是集群的体现，把很多设备当做一个整体来看。</description></item><item><title>ipvsadm 命令行工具</title><link>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/ipvsadm-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/LVS/ipvsadm-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</guid><description>概述 参考：
Syntax(语法) 处理 Virtual Service 的命令语法：
ipvsadm COMMAND VirtualService [-s Scheduler] [Persistence OPTIONS] 处理指定 Virtual Service 下的 Real Server 的命令语法：
ipvsadm COMMAND VirtualService ServerAddress [PacketForwardingMethod] [Weight Options] ** 命令语法中各参数的含义
VirtuslService # 用于指定基于协议或者地址或者端口号的虚拟服务，通过三元组定义：Protocol、IP、PORT。 格式：-PROTOCOL IP:PORT -PROTOCOL 分两种 -t, &amp;ndash;tcp-service -u, &amp;ndash;udp-service Scheduler # Director 的调度方法 详见 LVS 文章中描述的调度方法，使用其中 10 种任意一种的英文简称来写该参数，注意：是小写字母 ServerAddress # RS 的 IP PacketForwardingMethod # 该位置指明 LVS 的工作模式，不写该参数表明默认 DR 类型 -g, &amp;ndash;gatewaying # 网关，表示 DR 模式 -i, &amp;ndash;ipip # IP 封装 IP，表示 TUN 模式 -m, &amp;ndash;masquerading # 伪装，表示 NAT 模式 Weight Options # 权重选项 COMMAND 管理集群服务的 COMMAND</description></item></channel></rss>