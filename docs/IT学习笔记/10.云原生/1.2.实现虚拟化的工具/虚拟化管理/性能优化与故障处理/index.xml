<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>断念梦 – 性能优化与故障处理</title><link>https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/</link><description>Recent content in 性能优化与故障处理 on 断念梦</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 常见问题</title><link>https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="unable-to-complete-install-vm-xxxx-didnt-show-up-after-expected-time">Unable to complete install: &amp;lsquo;VM &amp;lsquo;XXXX&amp;rsquo; didn&amp;rsquo;t show up after expected time.&amp;rsquo;&lt;/h2>
&lt;p>使用 virt-manager 安装 VM 时，惦记 Bejin Install 后报错。&lt;/p>
&lt;p>TODO: 咋解决？？&lt;/p>
&lt;h2 id="guest-has-not-initialized-the-display">guest has not initialized the display&lt;/h2>
&lt;p>无法连接虚拟机显示器&lt;/p>
&lt;p>video 设备选为 Node 后，连接虚拟机提示 This VM has no graphic display device&lt;/p>
&lt;p>使用 qemu-system 运行不会有这个问题，使用 virt-install 运行时会出现这个问题&lt;/p>
&lt;p>TODO: 咋解决？？&lt;/p>
&lt;h2 id="requested-operation-is-not-valid-cannot-undefine-domain-with-nvram">Requested operation is not valid: cannot undefine domain with nvram&lt;/h2>
&lt;p>用 virsh 删除虚拟机时报错&lt;/p>
&lt;p>解决方案：添加 &amp;ndash;nvram 或者删除配置文件中的这行 &lt;code> &amp;lt;nvram&amp;gt;/var/lib/libvirt/qemu/nvram/debian6.0_VARS.fd&amp;lt;/nvram&amp;gt;&lt;/code>&lt;/p>
&lt;p>TODO: 咋解决？？&lt;/p></description></item><item><title>Docs: 虚拟化调试和优化指南</title><link>https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%B0%83%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%B0%83%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/</guid><description>
&lt;h1 id="虚拟化调试和优化指南">虚拟化调试和优化指南&lt;/h1>
&lt;p>红帽官方的推荐方案，中文：&lt;a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index&lt;/a>&lt;/p>
&lt;h2 id="配置网卡多队列">配置网卡多队列&lt;/h2>
&lt;p>&lt;a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-Networking-Multi-queue_virtio-net">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-Networking-Multi-queue_virtio-net&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://notes-learning.oss-cn-beijing.aliyuncs.com/un2vm8/1616123000773-caaef550-ee28-43b8-94eb-417936b2e088.jpeg" alt="">&lt;/p>
&lt;h2 id="配置磁盘缓存">配置磁盘缓存&lt;/h2>
&lt;p>&lt;a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-BlockIO-Caching">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-BlockIO-Caching&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://notes-learning.oss-cn-beijing.aliyuncs.com/un2vm8/1616123000746-e6a1ffde-9736-4cd9-a115-0449b16ef631.jpeg" alt="">&lt;/p>
&lt;p>经测试&lt;/p>
&lt;p>node 类型 dd 命令速度为 不到 500MB/s&lt;/p>
&lt;p>writeback 类型 de 命令速度为 不到 300MB/s&lt;/p>
&lt;h1 id="网卡软中断过高问题">网卡软中断过高问题&lt;/h1>
&lt;p>原文连接：&lt;a href="http://www.simlinux.com/archives/1798.html">http://www.simlinux.com/archives/1798.html&lt;/a>&lt;/p>
&lt;h2 id="问题背景">问题背景&lt;/h2>
&lt;p>游戏网关高峰期时出网络丢包,CPU0 软中断%sys 高达 90%。&lt;/p>
&lt;p>这意思就是说多个 CPU 中，只有 1 个来处理软中断信号&lt;/p>
&lt;h2 id="解决思路">解决思路：&lt;/h2>
&lt;p>让多个 CPU 平均处理中断的信号&lt;/p>
&lt;p>在虚拟机中，默认一个网卡收到的消息，只由 1 个 CPU 来处理，所以需要修改配置来让该网卡可以把数据交给多个 CPU 进行处理&lt;/p>
&lt;h2 id="解决方式">解决方式：&lt;/h2>
&lt;p>virsh edit &amp;lt;虚拟机名称&amp;gt; # 修改磁盘缓存策略&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;disk&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;file&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">device=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;disk&amp;#39;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;driver&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;qemu&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;qcow2&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">cache=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;none&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span> # 添加cache=&amp;#39;none&amp;#39;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;source&lt;/span> &lt;span style="color:#a6e22e">file=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;/var/lib/libvirt/images/iptv-unc-haproxy-1.qcow2&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;target&lt;/span> &lt;span style="color:#a6e22e">dev=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;vda&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">bus=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;virtio&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;address&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;pci&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">domain=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0000&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">bus=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x00&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">slot=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x07&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">function=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/disk&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>virsh edit &amp;lt;虚拟机名称&amp;gt; # 修改网卡队列&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;interface&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;bridge&amp;#39;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;mac&lt;/span> &lt;span style="color:#a6e22e">address=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;52:54:00:29:39:61&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;source&lt;/span> &lt;span style="color:#a6e22e">bridge=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;br0&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;model&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;virtio&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;driver&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;vhost&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">queues=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;8&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span> # 添加该行
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;address&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;pci&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">domain=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0000&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">bus=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x01&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">slot=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x00&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">function=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/interface&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ethtool -L eth0 combined 8 # 修改实际队列&lt;/p>
&lt;p>可以使用 ethtool -l eth0 来查看 eth0 网卡的队列数，收到的数据是由几个 cpu 进行处理的&lt;/p></description></item></channel></rss>