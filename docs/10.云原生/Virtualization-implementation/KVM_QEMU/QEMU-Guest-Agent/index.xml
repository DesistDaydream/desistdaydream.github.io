<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>QEMU Guest Agent on 断念梦的站点</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/KVM_QEMU/QEMU-Guest-Agent/</link><description>Recent content in QEMU Guest Agent on 断念梦的站点</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/KVM_QEMU/QEMU-Guest-Agent/index.xml" rel="self" type="application/rss+xml"/><item><title>QEMU Guest Agent</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/KVM_QEMU/QEMU-Guest-Agent/QEMU-Guest-Agent/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/KVM_QEMU/QEMU-Guest-Agent/QEMU-Guest-Agent/</guid><description>概述 参考：
官方文档，系统模拟管理和互操作性-QEMU 客户机代理 官方文档，系统模拟管理和互操作性-QEMU 客户机代理协议参考(i.e.QGA 的 QMP API 参考文档) https://wiki.qemu.org/Features/GuestAgent https://www.toutiao.com/i6646012291059810823/ https://www.shuzhiduo.com/A/QV5ZgK76dy/ QEMU Guest Agent(QEMU 虚拟机代理，简称 QGA) 是一个类似于 VMware Tools 的工具，用来辅助 Hypervisor 实现对 VM 的管理。
QEMU Guest Agent 旨在通过标准的 **QEMU Monitor Protocol(QEMU 监控协议，简称 QMP)**命令，实现 VM 与 宿主机 之间数据交互的功能。(比如可以在不登陆 VM 的情况下，让 VM 执行某些命令或者直接获取 VM 的信息)
QEMU Guest Agent 架构 QGA 功能的实现与 虚拟化 I/O 的实现，是相同的原理。KVM/QEMU 会在 VM 中模拟一个 I/O 设备，并通过 ID 关联到宿主机的某个文件或设备上，这样就可以实现宿主机与虚拟机之间的交互。其实说白了，这个年代基本都是半虚拟化设备的实现方式，通过两部分来实现完整的功能：
Host Device # 宿主机设备 **socket(套接字)是宿主机中实现 QGA 的设备。**也可以是其他未来待发明的东西。 Guest Driver # 虚拟机驱动 **virtio-serial(半虚拟化的串口设备)是 VM 中实现 QGA 的设备。**也可以是 isa-serial 等模拟设备。 除了基本的半虚拟化设备，VM 中还需要一个程序来处理宿主机发来的 QMP 命令：</description></item><item><title>QMP 命令参考</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/KVM_QEMU/QEMU-Guest-Agent/QMP-%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/KVM_QEMU/QEMU-Guest-Agent/QMP-%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83/</guid><description>概述 参考：
官方文档，系统模拟管理与交互-QEMU Guest Agent 协议参考 简书，qemu-agent-command 命令含义 通过指令
virsh qemu-agent-command 虚拟机 --cmd '{&amp;quot;execute&amp;quot;:&amp;quot;guest-info&amp;quot;}' 可以查看其所有支持的命令，返回的数据如下
{&amp;quot;return&amp;quot;:{&amp;quot;version&amp;quot;:&amp;quot;2.8.0&amp;quot;, &amp;quot;supported_commands&amp;quot;: [ {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-sync-delimited&amp;quot;,&amp;quot;success-response&amp;quot;:true},{&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-sync&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-suspend-ram&amp;quot;,&amp;quot;success-response&amp;quot;:false}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-suspend-hybrid&amp;quot;,&amp;quot;success-response&amp;quot;:false}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-suspend-disk&amp;quot;,&amp;quot;success-response&amp;quot;:false}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-shutdown&amp;quot;,&amp;quot;success-response&amp;quot;:false}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-set-vcpus&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-set-user-password&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-set-time&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-set-memory-blocks&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-ping&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-network-get-interfaces&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-info&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-get-vcpus&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-get-time&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-get-memory-blocks&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-get-memory-block-info&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-get-fsinfo&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-fstrim&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-fsfreeze-thaw&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-fsfreeze-status&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-fsfreeze-freeze-list&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:true,&amp;quot;name&amp;quot;:&amp;quot;guest-fsfreeze-freeze&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-file-write&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-file-seek&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-file-read&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-file-open&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-file-flush&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-file-close&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-exec-status&amp;quot;,&amp;quot;success-response&amp;quot;:true}, {&amp;quot;enabled&amp;quot;:false,&amp;quot;name&amp;quot;:&amp;quot;guest-exec&amp;quot;,&amp;quot;success-response&amp;quot;:true} ]}} 返回为数据，其中 supported_command 为所有命令的数组
其官方地址为：QEMU Guest Agent Protocol Reference
各命令含义如下： 1. guest-sync-delimited
宿主机发送一个 int 数字给 qga，qga 返回这个数字，并且在后续返回字符串响应中加入 ascii 码为 0xff 的字符。 2. guest-sync</description></item></channel></rss>