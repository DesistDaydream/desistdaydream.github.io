<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>virsh 命令行工具 on 断念梦的站点</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</link><description>Recent content in virsh 命令行工具 on 断念梦的站点</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/index.xml" rel="self" type="application/rss+xml"/><item><title>virsh 命令行工具</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</guid><description>概述 参考：
官方文档，手册-virsh GitHub 位置，libvirt/libvirt/docs/manpages/virsh.rst virsh 是 libvirt 核心发行版的一部分，通过 Libvirt API 管理虚拟机的命令行工具。
virsh 有两种使用方式
virsh + 子命令 交互式 shell。不加任何子命令时，进入交互式 shell Syntax(语法) virsh [OPTION]&amp;hellip; [COMMAND_STRING]
virsh [OPTION]&amp;hellip; COMMAND [ARG]&amp;hellip;
注意：
DOMAIN 的说明：libvirt 使用 domain 代指 VM，所有关于 domain 的描述都可以理解为 VM 或者 instance 当指定要操作某个特定 DOMAIN 的时候，可以使用该 DOMAIN 的 ID 号、NAME、UUID，三者任选其一 想要查看 VM 的信息，可以在 virsh 的 shell 中使用 help 命令，找 list 和 info 的关键字，help 中是以不同类型的命令进行分类的比如 DOMAIN 相关的，监控信息，网络存储等 OPTIONS -c, &amp;ndash;connect=URI # 通过 URI 连接远程 Hypervisor -d, &amp;ndash;debug=NUM # debug level [0-4] -e, &amp;ndash;escape &amp;lt;char&amp;gt; # set escape sequence for console -k, &amp;ndash;keepalive-interval=NUM # keepalive interval in seconds, 0 for disable -K, &amp;ndash;keepalive-count=NUM # number of possible missed keepalive messages -l, &amp;ndash;log=FILE output logging to file -q, &amp;ndash;quiet # 安静模式。输出时没有标题 -r, &amp;ndash;readonly # connect readonly -t, &amp;ndash;timing # print timing information COMMAND Note：其中各种命令用法，详见 virsh 命令行工具目录下每个子命令的专题文章</description></item><item><title>Storage Pool 命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Storage-Pool-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Storage-Pool-%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
官方 Manual(手册)，STORAGE POOL COMMANDS pool-create pool-info pool-list pool-destroy pool-dumpxml</description></item><item><title>Device 命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Device-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Device-%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
官方 Manual(手册)，DEVICE COMMANDS 注意：由于 Libvirt 适用于多种虚拟化后端，所以每个选项可用的值会分别适用于多种虚拟化后端，但是个人一般只用 QEMU/KVM，所以笔记中的选项一般也只记录 QEMU/KVM 相关的值。
这部分命令主要是用来为虚拟机添加/移除各种设备，比如 网卡、硬盘 等等。这些添加/移除的命令有一些通用的选项可用，为了记笔记方便，在开头这统一记录一下，添加设备的命令通常以 attach 开头，移除设备的命令通常以 detach 开头。
生效策略配置选项，用于配置添加/移除的行为在什么时候生效：
&amp;ndash;config # 影响已关机的 Domain，将会在下一次启动时添加/移除设备 &amp;ndash;live # 影响运行中的 Domain，立刻为虚拟机添加/移除设备 &amp;ndash;current # 等效于 &amp;ndash;live 或 &amp;ndash;config，具体取决于虚拟机当前的状态 &amp;ndash;persistent # 处于兼容的目的，该命令对关机或者开机状态的虚拟机都有效，相当于为当前运行中的虚拟机以及以后启动后的虚拟机都添加/移除设备。 attach-device - attach device from an XML file 添加与移除磁盘设备 在 Libvirt 的最佳实践中有命令使用示例
attach-disk 将一个新的磁盘设备添加到 domian 中
https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#attach-disk
Syntax(语法) virsh attach-disk DOMAIN SOURCE TARGET [OPTIONS]
将 SOURCE 添加到 DOMAIN 中，作为 TARGET 磁盘设备。
SOURCE 是本地的 qcow2、raw 这种格式的文件。如果指定了 &amp;ndash;source-protocol 选项，则 SOURCE 可以是网络磁盘。 TARGET 是虚拟机中的设备，比如 vdb、vdc 这种。 可以使用 &amp;ndash;target 选项指定 TARGET OPTIONS</description></item><item><title>Domain 命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Domain-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Domain-%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#domain-commands 可以为虚拟机重命名、查看虚拟机信息，状态、等等
简单的子命令 autostart # 指定 Domain 是否在开机后自启动，可以使用 &amp;ndash;disable 选项关闭 Domain 的开机自启功能。
console - 连接到 VM 的终端 console 用于把虚拟机屏幕上的信息投射到宿主机上，可以直接在宿主机的终端上操作虚拟机。 注意：如果无法通过 console 连接到 VM，则需要在 VM 上启动 serial-getty@.service 服务并在开启服务的时候指定一个终端。e.g.systemctl enable serial-getty@ttyS0.service &amp;ndash;now
cpu-stats - 显示 Domain 的 CPU 统计信息 默认显示所有 CPU 的统计信息和总数。仅使用 &amp;ndash;total 获取总统计信息，仅使用 start 获取从 &amp;ndash;start 开始的 CPU 的 per-cpu 统计信息，仅使用 &amp;ndash;count CPU 的统计信息。
create - 从一个 XML 文件里创建一个 domain 通过 XML 直接启动一台 VM，VM 关闭后，virsh list 列表中该 VM 会消失。</description></item><item><title>Interface 命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Interface-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Interface-%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
iface-begin create a snapshot of current interfaces settings, which can be later committed (iface-commit) or restored (iface-rollback) iface-bridge create a bridge device and attach an existing network device to it iface-commit commit changes made since iface-begin and free restore point iface-define define an inactive persistent physical host interface or modify an existing persistent one from an XML file iface-destroy destroy a physical host interface (disable it / &amp;ldquo;if-down&amp;rdquo;) iface-dumpxml interface information in XML iface-edit edit XML configuration for a physical host interface</description></item><item><title>Snapshot 命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Snapshot-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Snapshot-%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
官方 Manual(手册)，SNAPSHOT COMMANDS snapshot-create - 从 XML 文件中创建一个 domain 的快照 https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#snapshot-create
这个命令可以在虚拟机迁移时为虚拟机还原快照的元数据。
Syntax(语法) snapshot-create DOMAIN [OPTIONS]
OPTIONS
为虚拟机还原名为 base 快照的元数据
virsh snapshot-create &amp;ndash;redefine &amp;ndash;xmlfile /var/lib/libvirt/qemu/snapshot/tj-test-spst-node-1/base.xml tj-test-spst-node-1 EXAMPLE 使用 base.xml 文件，为虚拟机 master 创建一个快照 virsh snapshot-create master base.xml snapshot-create-as - 从一组参数中创建一个 domain 的快照 https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#snapshot-create-as
EXAMPLE
为虚拟机 master 创建一个当前状态的快照，名字为 base virsh snapshot-create-as master &amp;ndash;name base snapshot-current https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#snapshot-current
snapshot-edit - 编辑指定的 domain 的快照的 XML 文件 https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#snapshot-edit
snapshot-info https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#snapshot-info
snapshot-list - 列出指定 domain 的快照 https://github.</description></item><item><title>Virtual Network 命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Virtual-Network-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/Virtual-Network-%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
官方 Manual(手册)，VIRTUAL NETWORK COMMANDS net-autostart net-create net-define # 定义一个非活动的持久虚拟网络或从 XML 文件中修改一个现有的持久虚拟网络 net-destroy # 摧毁一个网络 net-dumpxml net-edit net-event net-info net-list net-name net-start net-undefine net-uuid net-update net-dhcp-leases</description></item><item><title>通用命令</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/virsh-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4/</guid><description>概述 参考：
官方 Manual(手册)，GENERIC COMMANDS quit, exit version cd pwd connect uri hostname sysinfo nodeinfo nodecpumap nodecpustats nodememstats nodesevinfo nodesuspend node-memory-tune capabilities domcapabilities pool-capabilities inject-nmi
list # 列出所有正在运行的 domain https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#list
Syntax(语法) list [OPTIONS]
OPTIONS
&amp;ndash;all # 列出活动和非活动的所有 domain &amp;ndash;title # 显示 domain 的 title &amp;ndash;name # 仅显示虚拟机名称 EXAMPLE
virsh list # 列出所有正在运行的 domain freecell freepages allocpages
cpu-baseline https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#cpu-baseline
cpu-compare https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#cpu-compare
cpu-models https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#cpu-models
hypervisor-cpu-compare https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#hypervisor-cpu-compare
hypervisor-cpu-baseline https://github.com/libvirt/libvirt/blob/master/docs/manpages/virsh.rst#hypervisor-cpu-baseline</description></item></channel></rss>