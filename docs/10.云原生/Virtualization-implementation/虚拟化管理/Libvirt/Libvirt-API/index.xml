<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>使用 libvirt API 的其他应用程序 on 断念梦的站点</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/</link><description>Recent content in 使用 libvirt API 的其他应用程序 on 断念梦的站点</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/index.xml" rel="self" type="application/rss+xml"/><item><title>Libvirt API</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/Libvirt-API/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/Libvirt-API/</guid><description>概述 参考：
官网，API 参考 官网，使用 libvirt 的应用程序 在官方的 API 参考中，包含所有 C 语言表示的 API 信息，这些 API 分为如下几类：
common # libvirt 和 libvirt-admin 库的常用宏和枚举 domain # 用于管理 Domain 的 API domain checkpoint # 用于管理 Domain 检查点的 API domain snapshot # 用于管理 Domain 快照的 API error event host # 用于管理主机的 API interface network node device network filter secret storage stream and admin QEMU LXC libs 在我们使用非 C 代码，比如 Python、Go 的时候，如果想要找到 API 的说明，可以参考官方的 C 语言的 API 文档，函数名基本差不多，用一个最常见的“列出所有 Domain”举例：</description></item><item><title>virt-install</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/virt-install/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/virt-install/</guid><description>概述 参考：
GitHub 项目，virt-manager/virt-manager 中的 Manual(手册) Manual(手册)，virt-install(1)（另一个网站的 Manual） virt-install 是一个命令行工具，用于通过 Libvirt 管理程序管理库创建新的 KVM、Xen 或 Linux 容器。请参阅本文档末尾的示例部分以快速入门。
virt-manager 在图形化界面创建的虚拟机本质上就是调用的 virt-install 命令在系统中执行的。virt-manager 创建的虚拟机生成的 xml 文件可以推导出 virt-install 创建同样虚拟机所需要使用到的参数。
virt-install 命令中很多参数都可以在 XML 文件中找到对应的配置。比如 --memory 的全部可配置参数可以在 https://libvirt.org/formatdomain.html#memory-allocation 这里找到。
Syntax(语法) virt-install &amp;ndash;name NAME &amp;ndash;memory MB STORAGE INSTALL [OPTIONS]
许多参数都有子选项，要查看与该参数相关联的子选项的完整列表使用例子中类似的命令，例如：virt-install &amp;ndash;disk=?
随着版本的更新，很多选项都会被更好的选项而替代，那些被弃用的选项可能不会在笔记中出现，具体详见官方文档。
有几个参数是在使用 libvirt 工具安装虚拟机时必须指定的：
&amp;ndash;name is required &amp;ndash;memory amount in MiB is required &amp;ndash;disk storage must be specified (override with &amp;ndash;disk none) 安装方式 &amp;ndash;location URL, &amp;ndash;cdrom CD/ISO, &amp;ndash;pxe, &amp;ndash;import, &amp;ndash;boot hd|cdrom|&amp;hellip; 注意： 在创建虚拟机时，我们一般都会指定一下虚拟机的系统类型，以便优化 virtio 等性能相关功能。所有 virt-manager 支持的虚拟机列表可以通过 virt-install --osinfo list 命令列出。</description></item><item><title>libguestfs</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/libguestfs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/libguestfs/</guid><description>概述 参考：
GitHub 项目，libguestfs/libguestfs 官网 Libguestfs 是用于访问和修改虚拟机磁盘映像的库和工具。
常见问题 参考：
https://access.redhat.com/solutions/4073061 https://wandering-wolf.tistory.com/entry/Centos-7-KVM-%EC%97%90%EC%84%9C-rhel-8-vm-virt-sysperp-error https://dovangiang.wordpress.com/2021/08/06/errorcentos-mount-mount-exited-with-status-32-mount-wrong-fs-type-bad-option-bad-superblock/ 注意：CentOS7 宿主机上想要挂载 Ubuntu 20.04 虚拟机的 xfs 格式的文件系统是不行的，内核版本低不支持，报错如下：
~]# guestmount --rw -a /var/lib/libvirt/images/common-ubuntu-test.bj-test.qcow2 -m /dev/ubuntu-vg/lv-0 /mnt/test libguestfs: error: mount_options: mount exited with status 32: mount: wrong fs type, bad option, bad superblock on /dev/mapper/ubuntu--vg-lv--0, missing codepage or helper program, or other error In some cases useful info is found in syslog - try dmesg | tail or so. guestmount: ‘/dev/ubuntu-vg/lv-0’ could not be mounted.</description></item><item><title>Libvirt 客户端库</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/Libvirt-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%93/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/Libvirt-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%93/</guid><description>概述 参考：
官方文档，binding Libvirt 直接支持 C 和 C++，并且具有可用于其他语言的绑定：
C#：Arnaud Champion 开发C# 绑定。 Go：Daniel Berrange 开发了 Go 绑定。 Java：Daniel Veillard 开发 Java 绑定。 OCaml：Richard Jones 开发 OCaml 绑定。 Perl：Daniel Berrange 开发 Perl 绑定。 PHP：Radek Hladik 于 2010 年开始开发 PHP 绑定。2011 年 2 月，绑定开发已作为 libvirt-php 项目移至 libvirt.org 网站。该项目现在由 Michal Novotny 维护，并且很大程度上基于 Radek 的版本。有关更多信息，包括发布补丁到 libvirt-php 的信息，请参阅PHP 绑定站点。 Python：Libvirt 的 python 绑定从 1.2.0 版本开始被拆分为一个单独的 包，旧版本直接支持 Python 语言。如果您的 libvirt 是作为软件包安装的，而不是由您从源代码编译的，请确保您安装了适当的软件包。这在 RHEL/Fedora 上被命名为 libvirt-python ，在 Ubuntu 上被命名为 python-libvirt ，并且在其他人上可能有不同的命名。有关使用信息，请参阅Python API 绑定 页面。 Ruby：Chris Lalancette 开发Ruby 绑定。 集成 API 模块：</description></item><item><title>virt-manager</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/virt-manager/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Virtualization-implementation/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/Libvirt/Libvirt-API/virt-manager/</guid><description>概述 参考
GitHub 项目，virt-manager/virt-manager 官网 virt-manager 是一个图形化的应用程序，通过 libvirt 管理虚拟机。
virt-manager 提供了多个配套的工具
virt-manager # GUI 模式的 VM 管理程序 virt-viewer # 是一个轻量级的 UI 界面，用于与虚拟客户操作系统的图形显示进行交互。它可以显示 VNC 或 SPICE，并使用 libvirt 查找图形连接详细信息。 virt-install # 是一个命令行工具，它提供了一种将操作系统配置到虚拟机中的简单方法。 virt-clone # 是一个用于克隆现有非活动客户的命令行工具。它复制磁盘映像，并使用指向复制磁盘的新名称、UUID 和 MAC 地址定义配置。 virt-xml # 是一个命令行工具，用于使用 virt-install 的命令行选项轻松编辑 libvirt 域 XML。 virt-bootstrap # 是一个命令行工具，提供了一种简单的方法来为基于 libvirt 的容器设置根文件系统。 virt-clone、virt-xml、virt-install 属于安装虚拟机的工具，通常都在 virtinst 包中。
virt-manager、virt-viewer 属于图形化管理虚拟机的工具，通常都在 virt-manager 包中。
virt-manager 使用 virt-manager 管理多台虚拟机 在一台机器上的 virt-manager 可以通过 add connection 管理其它宿主机上的虚拟机，但是前提是建立 ssh 的密钥认证，因为在 virt-manager 在通过 ssh 连接的时候，需要使用窗口模式输入密码，而一般情况下 ssh 是默认不装该组件的。如果不想添加密钥认证，那么安装 ssh-askpass-gnome 组件即可。</description></item></channel></rss>