<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>断念梦 – CoreDNS</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/2.3.Kubernetes-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%B3%BB%E7%BB%9F/8.Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/</link><description>Recent content in CoreDNS on 断念梦</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/2.3.Kubernetes-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%B3%BB%E7%BB%9F/8.Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: CoreDNS Plugins</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/2.3.Kubernetes-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%B3%BB%E7%BB%9F/8.Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/CoreDNS-Plugins/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/2.3.Kubernetes-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%B3%BB%E7%BB%9F/8.Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/CoreDNS-Plugins/</guid><description/></item><item><title>Docs: CoreDNS 配置详解</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/2.3.Kubernetes-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%B3%BB%E7%BB%9F/8.Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/CoreDNS-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/2.3.Kubernetes-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%B3%BB%E7%BB%9F/8.Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/CoreDNS-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://coredns.io/manual/toc/#configuration">官方配置文档&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>CoreDNS 的配置文件为 Corefile。
Corefile 源于 Caddy 框架的的配置文件 Caddyfile。Corefile 将会定义如下 CoreDNS 的行为：&lt;/p>
&lt;ul>
&lt;li>CoreDNS 的运行逻辑很像 Nginx，会抽象出 &lt;code>server&lt;/code> 的概念并运行。可以同时定义多个 Server 以实现不同功能，每个 Server 主要定义下面几种行为：
&lt;ul>
&lt;li>Server 以什么协议监听在哪个端口&lt;/li>
&lt;li>Server 负责哪个 zone 的权威 DNS 解析&lt;/li>
&lt;li>Server 将会加载哪些插件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>一个典型的最基础的 Corefile 格式如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ZONE&lt;span style="color:#f92672">[&lt;/span>:PORT&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">[&lt;/span>PLUGIN&lt;span style="color:#f92672">]&lt;/span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ZONE&lt;/strong># 定义 Server 的 zone。&lt;code>默认值： .&lt;/code>&lt;/li>
&lt;li>&lt;strong>PORT&lt;/strong># 定义 Server 监听的端口。&lt;code>默认值：53&lt;/code>。即 -dns.port 标志的值。&lt;/li>
&lt;li>&lt;strong>PLUGIN&lt;/strong># 定义 Server 要加载的&lt;a href="https://coredns.io/plugins/">插件&lt;/a>。这是可选的，但是如果不加载任何插件，那么 coredns 将为所有查询返回 SERVFAIL 。
&lt;ul>
&lt;li>并且，不同的 Plugins 还可以定义不同的参数以改变其运行行为。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>比如：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>. {}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上述配置文件表达的是：server 负责根域 &lt;code>.&lt;/code> 的解析，监听在 53 端口，并且不使用任何插件。&lt;/p>
&lt;h1 id="配置示例">配置示例&lt;/h1>
&lt;h2 id="定义-server">定义 server&lt;/h2>
&lt;p>一个最简单的配置文件可以为：&lt;/p>
&lt;pre>&lt;code>.{}
&lt;/code>&lt;/pre>
&lt;p>即 server 监听 53 端口并不使用插件。
如果此时在定义其他 server，要保证监听端口不冲突；如果是在原来 server 增加 zone，则要保证 zone 之间不冲突，如：&lt;/p>
&lt;pre>&lt;code>. {}
.:54 {}
&lt;/code>&lt;/pre>
&lt;p>另一个 server 运行于 54 端口并负责根域 &lt;code>.&lt;/code> 的解析。&lt;/p>
&lt;p>又如：&lt;/p>
&lt;pre>&lt;code>example.org {
whoami
}
org {
whoami
}
&lt;/code>&lt;/pre>
&lt;p>同一个 server 但是负责不同 zone 的解析，有不同插件链。&lt;/p>
&lt;h3 id="定义-reverse-zone">定义 Reverse Zone&lt;/h3>
&lt;p>跟其他 DNS 服务器类似，Corefile 也可以定义 &lt;code>Reverse Zone&lt;/code>（反向解析 IP 地址对应的域名）：&lt;/p>
&lt;pre>&lt;code>0.0.10.in-addr.arpa {
whoami
}
&lt;/code>&lt;/pre>
&lt;p>或者简化版本：&lt;/p>
&lt;pre>&lt;code>10.0.0.0/24 {
whoami
}
&lt;/code>&lt;/pre>
&lt;p>可以通过 &lt;code>dig&lt;/code> 进行反向查询：&lt;/p>
&lt;pre>&lt;code>$ dig -x 10.0.0.1
&lt;/code>&lt;/pre>
&lt;h3 id="使用不同的通信协议">使用不同的通信协议&lt;/h3>
&lt;p>CoreDNS 除了支持 DNS 协议，也支持 &lt;code>TLS&lt;/code> 和 &lt;code>gRPC&lt;/code>，即 DNS-over-TLS[3] 和 DNS-over-gRPC 模式：&lt;/p>
&lt;pre>&lt;code>tls://example.org:1443 {
#...
}
&lt;/code>&lt;/pre>
&lt;h3 id="添加其他的域名解析">添加其他的域名解析&lt;/h3>
&lt;pre>&lt;code>.:53 {
hosts {
123.138.66.130 xsky.xa.ehualu.it
123.138.66.130 prometheus.xa.ehualu.it
116.182.4.38 xsky.heb.ehualu.it
116.182.4.38 prometheus.heb.ehualu.it
fallthrough
}
}
&lt;/code>&lt;/pre>
&lt;h2 id="forwarding转发">Forwarding(转发)&lt;/h2>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://coredns.io/manual/toc/#forwarding">https://coredns.io/manual/toc/#forwarding&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote></description></item></channel></rss>