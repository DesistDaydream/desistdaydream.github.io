<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>断念梦的站点 – Kubernetes DNS</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/</link><description>Recent content in Kubernetes DNS on 断念梦的站点</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Kubernetes DNS</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/Kubernetes-DNS/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/Kubernetes-DNS/</guid><description>
&lt;h1 id="概述">概述&lt;a class="td-heading-self-link" href="#%e6%a6%82%e8%bf%b0" aria-label="Heading self-link">&lt;/a>&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">官方文档，概念-服务,负载均衡,网络-service 与 pod 的 DNS&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>DNS 是 kubernetes 中 &lt;strong>Service Discovery(服务发现，简称 SD)&lt;/strong> 的重要实现方式，虽然 K8S SD 还可以通过其他协议和机制提供，但 DNS 是非常常用的、并且是强烈建议的附加组件。&lt;/p>
&lt;p>Kubernetes 集群中创建的每个 &lt;strong>service 对象&lt;/strong> 和 &lt;strong>pod 对象&lt;/strong> 都会被分配一个 &lt;strong>DNS 名称&lt;/strong>，Kubernetes 中实现 DNS 功能的程序需要自动创建 &lt;strong>DNS Resource Records(域名解析服务的资源记录)&lt;/strong>。基于此，我们可以通过 DNS 名称连接我们部署到集群中的服务，而不用通过 IP 地址。&lt;/p>
&lt;p>kubernetes 实现 DNS 的方式：新版本默认使用 &lt;a href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%20%E7%BD%91%E7%BB%9C/Kubernetes%20DNS/CoreDNS/CoreDNS.md">CoreDNS&lt;/a>，1.11.0 之前使用的是 kube-dns。Kubernetes DNS 的实现必须符合既定的规范，规范详见 &lt;a href="https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%20%E7%BD%91%E7%BB%9C/Kubernetes%20DNS/%E5%9F%BA%E4%BA%8E%20DNS%20%E7%9A%84%20Kubernetes%20%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E7%9A%84%E8%A7%84%E8%8C%83.md">基于 DNS 的 Kubernetes 服务发现的规范&lt;/a> 文章。&lt;/p>
&lt;p>也就是说，任何可以用于实现 Kubernetes DNS 功能的应用程序，至少需要满足规范中描述的 Resource Records 格式标准。&lt;/p>
&lt;h1 id="service-对象的-dns">Service 对象的 DNS&lt;a class="td-heading-self-link" href="#service-%e5%af%b9%e8%b1%a1%e7%9a%84-dns" aria-label="Heading self-link">&lt;/a>&lt;/h1>
&lt;h2 id="aaaaa-记录">A/AAAA 记录&lt;a class="td-heading-self-link" href="#aaaaa-%e8%ae%b0%e5%bd%95" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>Normal(正常) Service(除了 Headless 类型以外的所有 Service) 会以 &lt;code>my-svc.my-namespace.svc.cluster-domain.example&lt;/code> 这种名字的形式被分配一个 DNS A 或 AAAA 记录，取决于服务的 IP 协议族。 该名称会解析成对应 Service 对象的 CLUSTER-IP。&lt;/p>
&lt;p>Headless(无头) Service(没有 CLUSTER-IP) 也会以 &lt;code>my-svc.my-namespace.svc.cluster-domain.example&lt;/code> 这种名字的形式分配一个 DNS A 或 AAAA 记录。与 Normal Service 不同的是，这个记录会被解析成对应服务所选择的 Pod 的 IP 集合。&lt;/p>
&lt;h2 id="srv-记录">SRV 记录&lt;a class="td-heading-self-link" href="#srv-%e8%ae%b0%e5%bd%95" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>Kubernetes 会为命名端口创建 SRV 记录，这些端口是普通服务或 无头服务的一部分。&lt;/p>
&lt;p>对每个具有名称端口，SRV 记录具有 &lt;code>_my-port-name._my-port-protocol.my-svc.my-namespace.svc.cluster-domain.example&lt;/code> 这种形式。 对普通服务，该记录会被解析成端口号和域名：&lt;code>my-svc.my-namespace.svc.cluster-domain.example&lt;/code>。 对无头服务，该记录会被解析成多个结果，服务对应的每个后端 Pod 各一个； 其中包含 Pod 端口号和形为 &lt;code>auto-generated-name.my-svc.my-namespace.svc.cluster-domain.example&lt;/code> 的域名。&lt;/p>
&lt;h1 id="pod-对象的-dns">Pod 对象的 DNS&lt;a class="td-heading-self-link" href="#pod-%e5%af%b9%e8%b1%a1%e7%9a%84-dns" aria-label="Heading self-link">&lt;/a>&lt;/h1>
&lt;h2 id="aaaaa-记录-1">A/AAAA 记录&lt;a class="td-heading-self-link" href="#aaaaa-%e8%ae%b0%e5%bd%95-1" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>一般情况下，Pod 对象的域名格式如下：
&lt;code>Pod-IP-Address.NAMESPACE.pod.ClusterDomain&lt;/code>&lt;/p>
&lt;p>例如，如果有一个 Pod 对象，IP 为 172.17.0.3，在 default 名称空间，集群域名为默认的 cluster.local。则该 Pod 的域名为：
&lt;code>172-17-0-3.default.pod.cluster.local&lt;/code>&lt;/p>
&lt;h2 id="pod-的-hostname-和-subdomain-字段">Pod 的 hostname 和 subdomain 字段&lt;a class="td-heading-self-link" href="#pod-%e7%9a%84-hostname-%e5%92%8c-subdomain-%e5%ad%97%e6%ae%b5" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>当前，创建 Pod 时其主机名取自 Pod 的 &lt;code>metadata.name&lt;/code> 值。Pod 规约中包含一个可选的 &lt;code>hostname&lt;/code> 字段，可以用来指定 Pod 的主机名。 当这个字段被设置时，它将优先于 Pod 的名字成为该 Pod 的主机名。 举个例子，给定一个 &lt;code>hostname&lt;/code> 设置为 &amp;ldquo;&lt;code>my-host&lt;/code>&amp;rdquo; 的 Pod， 该 Pod 的主机名将被设置为 &amp;ldquo;&lt;code>my-host&lt;/code>&amp;quot;。Pod 规约还有一个可选的 &lt;code>subdomain&lt;/code> 字段，可以用来指定 Pod 的子域名。 举个例子，某 Pod 的 &lt;code>hostname&lt;/code> 设置为 “&lt;code>foo&lt;/code>”，&lt;code>subdomain&lt;/code> 设置为 “&lt;code>bar&lt;/code>”， 在名字空间 “&lt;code>my-namespace&lt;/code>” 中对应的完全限定域名（FQDN）为 “&lt;code>foo.bar.my-namespace.svc.cluster-domain.example&lt;/code>”。&lt;/p>
&lt;p>示例：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">default-subdomain&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">selector&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">clusterIP&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">None&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">ports&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">foo&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># 实际上不需要指定端口号&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">port&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1234&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">targetPort&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1234&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000">---&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">labels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">hostname&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox-1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">subdomain&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">default-subdomain&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox:1.28&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">command&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#000">sleep&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#4e9a06">&amp;#34;3600&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000">---&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">labels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">hostname&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox-2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">subdomain&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">default-subdomain&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox:1.28&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">command&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#000">sleep&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#4e9a06">&amp;#34;3600&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果某无头服务与某 Pod 在同一个名字空间中，且它们具有相同的子域名， 集群的 DNS 服务器也会为该 Pod 的全限定主机名返回 A 记录或 AAAA 记录。 例如，在同一个名字空间中，给定一个主机名为 “busybox-1”、 子域名设置为 “default-subdomain” 的 Pod，和一个名称为 “&lt;code>default-subdomain&lt;/code>” 的无头服务，Pod 将看到自己的 FQDN 为 &amp;ldquo;&lt;code>busybox-1.default-subdomain.my-namespace.svc.cluster-domain.example&lt;/code>&amp;quot;。 DNS 会为此名字提供一个 A 记录或 AAAA 记录，指向该 Pod 的 IP。 “&lt;code>busybox1&lt;/code>” 和 “&lt;code>busybox2&lt;/code>” 这两个 Pod 分别具有它们自己的 A 或 AAAA 记录。Endpoints 对象可以为任何端点地址及其 IP 指定 &lt;code>hostname&lt;/code>。&lt;/p>
&lt;blockquote>
&lt;p>**说明：**因为没有为 Pod 名称创建 A 记录或 AAAA 记录，所以要创建 Pod 的 A 记录 或 AAAA 记录需要 &lt;code>hostname&lt;/code>。没有设置 &lt;code>hostname&lt;/code> 但设置了 &lt;code>subdomain&lt;/code> 的 Pod 只会为 无头服务创建 A 或 AAAA 记录（&lt;code>default-subdomain.my-namespace.svc.cluster-domain.example&lt;/code>） 指向 Pod 的 IP 地址。 另外，除非在服务上设置了 &lt;code>publishNotReadyAddresses=True&lt;/code>，否则只有 Pod 进入就绪状态 才会有与之对应的记录。&lt;/p>
&lt;/blockquote>
&lt;h2 id="pod-的-sethostnameasfqdn-字段">Pod 的 setHostnameAsFQDN 字段&lt;a class="td-heading-self-link" href="#pod-%e7%9a%84-sethostnameasfqdn-%e5%ad%97%e6%ae%b5" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>&lt;strong>FEATURE STATE:&lt;/strong> &lt;code>Kubernetes v1.20 [beta]&lt;/code>
&lt;strong>前置条件&lt;/strong>：&lt;code>SetHostnameAsFQDN&lt;/code> 特性门控 必须在 API 服务器 上启用。当你在 Pod 规约中设置了 &lt;code>setHostnameAsFQDN: true&lt;/code> 时，kubelet 会将 Pod 的全限定域名（FQDN）作为该 Pod 的主机名记录到 Pod 所在名字空间。 在这种情况下，&lt;code>hostname&lt;/code> 和 &lt;code>hostname --fqdn&lt;/code> 都会返回 Pod 的全限定域名。&lt;/p>
&lt;blockquote>
&lt;p>**说明：**在 Linux 中，内核的主机名字段（&lt;code>struct utsname&lt;/code> 的 &lt;code>nodename&lt;/code> 字段）限定 最多 64 个字符。
如果 Pod 启用这一特性，而其 FQDN 超出 64 字符，Pod 的启动会失败。 Pod 会一直出于 &lt;code>Pending&lt;/code> 状态（通过 &lt;code>kubectl&lt;/code> 所看到的 &lt;code>ContainerCreating&lt;/code>）， 并产生错误事件，例如 &amp;ldquo;Failed to construct FQDN from pod hostname and cluster domain, FQDN &lt;code>long-FQDN&lt;/code> is too long (64 characters is the max, 70 characters requested).&amp;rdquo; （无法基于 Pod 主机名和集群域名构造 FQDN，FQDN &lt;code>long-FQDN&lt;/code> 过长，至多 64 字符，请求字符数为 70）。 对于这种场景而言，改善用户体验的一种方式是创建一个 准入 Webhook 控制器， 在用户创建顶层对象（如 Deployment）的时候控制 FQDN 的长度。&lt;/p>
&lt;/blockquote>
&lt;h2 id="pod-的-dns-策略">Pod 的 DNS 策略&lt;a class="td-heading-self-link" href="#pod-%e7%9a%84-dns-%e7%ad%96%e7%95%a5" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>DNS 策略可以逐个 Pod 来设定。目前 Kubernetes 支持以下特定 Pod 的 DNS 策略。 这些策略可以在 Pod 规约中的 &lt;code>dnsPolicy&lt;/code> 字段设置：&lt;/p>
&lt;ul>
&lt;li>&amp;ldquo;&lt;code>Default&lt;/code>&amp;rdquo;: Pod 从运行所在的节点继承名称解析配置。参考 相关讨论 获取更多信息。&lt;/li>
&lt;li>&amp;ldquo;&lt;code>ClusterFirst&lt;/code>&amp;rdquo;: 与配置的集群域后缀不匹配的任何 DNS 查询（例如 &amp;ldquo;&lt;a href="https://www.kubernetes.io">www.kubernetes.io&lt;/a>&amp;rdquo;） 都将转发到从节点继承的上游名称服务器。集群管理员可能配置了额外的存根域和上游 DNS 服务器。 参阅相关讨论 了解在这些场景中如何处理 DNS 查询的信息。&lt;/li>
&lt;li>&amp;ldquo;&lt;code>ClusterFirstWithHostNet&lt;/code>&amp;quot;：对于以 hostNetwork 方式运行的 Pod，应显式设置其 DNS 策略 &amp;ldquo;&lt;code>ClusterFirstWithHostNet&lt;/code>&amp;quot;。&lt;/li>
&lt;li>&amp;ldquo;&lt;code>None&lt;/code>&amp;rdquo;: 此设置允许 Pod 忽略 Kubernetes 环境中的 DNS 设置。Pod 会使用其 &lt;code>dnsConfig&lt;/code> 字段 所提供的 DNS 设置。 参见 Pod 的 DNS 配置节。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>说明：&lt;/strong> &amp;ldquo;Default&amp;rdquo; 不是默认的 DNS 策略。如果未明确指定 &lt;code>dnsPolicy&lt;/code>，则使用 &amp;ldquo;ClusterFirst&amp;rdquo;。&lt;/p>
&lt;/blockquote>
&lt;p>下面的示例显示了一个 Pod，其 DNS 策略设置为 &amp;ldquo;&lt;code>ClusterFirstWithHostNet&lt;/code>&amp;quot;， 因为它已将 &lt;code>hostNetwork&lt;/code> 设置为 &lt;code>true&lt;/code>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">namespace&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">default&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox:1.28&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">command&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#000">sleep&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#4e9a06">&amp;#34;3600&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">imagePullPolicy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">IfNotPresent&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">busybox&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">restartPolicy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Always&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">hostNetwork&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">dnsPolicy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ClusterFirstWithHostNet&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="pod-的-dns-配置">Pod 的 DNS 配置&lt;a class="td-heading-self-link" href="#pod-%e7%9a%84-dns-%e9%85%8d%e7%bd%ae" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>Pod 的 DNS 配置可让用户对 Pod 的 DNS 设置进行更多控制。&lt;/p>
&lt;p>&lt;code>dnsConfig&lt;/code> 字段是可选的，它可以与任何 &lt;code>dnsPolicy&lt;/code> 设置一起使用。 但是，当 Pod 的 &lt;code>dnsPolicy&lt;/code> 设置为 &amp;ldquo;&lt;code>None&lt;/code>&amp;rdquo; 时，必须指定 &lt;code>dnsConfig&lt;/code> 字段。用户可以在 &lt;code>dnsConfig&lt;/code> 字段中指定以下属性：&lt;/p>
&lt;ul>
&lt;li>&lt;code>nameservers&lt;/code>：将用作于 Pod 的 DNS 服务器的 IP 地址列表。 最多可以指定 3 个 IP 地址。当 Pod 的 &lt;code>dnsPolicy&lt;/code> 设置为 &amp;ldquo;&lt;code>None&lt;/code>&amp;rdquo; 时， 列表必须至少包含一个 IP 地址，否则此属性是可选的。 所列出的服务器将合并到从指定的 DNS 策略生成的基本名称服务器，并删除重复的地址。&lt;/li>
&lt;li>&lt;code>searches&lt;/code>：用于在 Pod 中查找主机名的 DNS 搜索域的列表。此属性是可选的。 指定此属性时，所提供的列表将合并到根据所选 DNS 策略生成的基本搜索域名中。 重复的域名将被删除。Kubernetes 最多允许 6 个搜索域。&lt;/li>
&lt;li>&lt;code>options&lt;/code>：可选的对象列表，其中每个对象可能具有 &lt;code>name&lt;/code> 属性（必需）和 &lt;code>value&lt;/code> 属性（可选）。 此属性中的内容将合并到从指定的 DNS 策略生成的选项。 重复的条目将被删除。&lt;/li>
&lt;/ul>
&lt;p>以下是具有自定义 DNS 设置的 Pod 示例：
&lt;code>service/networking/custom-dns.yaml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">namespace&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">default&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">dns-example&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">test&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">nginx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">dnsPolicy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;None&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">dnsConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">nameservers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#0000cf;font-weight:bold">1.2.3.4&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">searches&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#000">ns1.svc.cluster-domain.example&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#000">my.dns.search.suffix&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">options&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ndots&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">value&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">edns0&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建上面的 Pod 后，容器 &lt;code>test&lt;/code> 会在其 &lt;code>/etc/resolv.conf&lt;/code> 文件中获取以下内容：&lt;/p>
&lt;pre>&lt;code>nameserver 1.2.3.4
search ns1.svc.cluster-domain.example my.dns.search.suffix
options ndots:2 edns0
&lt;/code>&lt;/pre>
&lt;p>对于 IPv6 设置，搜索路径和名称服务器应按以下方式设置：&lt;/p>
&lt;pre>&lt;code>kubectl exec -it dns-example -- cat /etc/resolv.conf
&lt;/code>&lt;/pre>
&lt;p>输出类似于&lt;/p>
&lt;pre>&lt;code>nameserver fd00:79:30::a
search default.svc.cluster-domain.example svc.cluster-domain.example cluster-domain.example
options ndots:5
&lt;/code>&lt;/pre></description></item><item><title>Docs: 基于 DNS 的 Kubernetes 服务发现的规范</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/%E5%9F%BA%E4%BA%8E-DNS-%E7%9A%84-Kubernetes-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E7%9A%84%E8%A7%84%E8%8C%83/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/%E5%9F%BA%E4%BA%8E-DNS-%E7%9A%84-Kubernetes-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E7%9A%84%E8%A7%84%E8%8C%83/</guid><description>
&lt;h1 id="概述">概述&lt;a class="td-heading-self-link" href="#%e6%a6%82%e8%bf%b0" aria-label="Heading self-link">&lt;/a>&lt;/h1>
&lt;h1 id="概述-1">概述&lt;a class="td-heading-self-link" href="#%e6%a6%82%e8%bf%b0-1" aria-label="Heading self-link">&lt;/a>&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/dns/blob/master/docs/specification.md">官方文档&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>任何基于 DNS 的以实现 Kubernetes 服务发现的实现工具，必须提供本规范描述的 Resource Record&lt;/p>
&lt;p>DNS Records 类型包含以下几种：A/AAAA、SRV、PTR、CHAME。不同的 k8s 资源，其可用的 Record Type 也不相同。&lt;/p>
&lt;p>Resource Records 规范&lt;/p>
&lt;p>在下面的描述中，有几个占位符，表示如下含义：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>&amp;lt;service&amp;gt;&lt;/strong> # service 对象的名字&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&amp;lt;ns&amp;gt;&lt;/strong> # namesapce 的名字&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&amp;lt;zone&amp;gt;&lt;/strong> # 集群域名(默认为 cluster.local)。&lt;/p>
&lt;ul>
&lt;li>集群域名可以通过 kubelet 的配置文件 clusterDomain 字段定义。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>&amp;lt;ttl&amp;gt;&lt;/strong> # 一条 Record 的标准 DNS 存活时间&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="clusterip-类型-service-的-rr-格式">ClusterIP 类型 Service 的 RR 格式&lt;a class="td-heading-self-link" href="#clusterip-%e7%b1%bb%e5%9e%8b-service-%e7%9a%84-rr-%e6%a0%bc%e5%bc%8f" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;p>参考：&lt;a href="https://github.com/kubernetes/dns/blob/master/docs/specification.md#23---records-for-a-service-with-clusterip">官方文档&lt;/a>&lt;/p>
&lt;p>现在假定一个 Service 对象名为 &lt;code>&amp;lt;service&amp;gt;&lt;/code>，在名为 &lt;code>&amp;lt;ns&amp;gt;&lt;/code> 名称空间，该 Service 对象的 CLUSTER-IP 为 &lt;code>&amp;lt;cluster-ip&amp;gt;&lt;/code>。则 DNS 实现程序必须具有下列几种类型的 Records(记录)。&lt;/p>
&lt;h3 id="aaaaa-record">A/AAAA Record&lt;a class="td-heading-self-link" href="#aaaaa-record" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;p>如果 &amp;lt;service&amp;gt; 对象具有 &amp;lt;cluster-ip&amp;gt; 且为 IPv4 地址。&lt;/p>
&lt;p>&lt;strong>A 记录 格式&lt;/strong>：&lt;code>&amp;lt;service&amp;gt;.&amp;lt;ns&amp;gt;.svc.&amp;lt;zone&amp;gt;. &amp;lt;ttl&amp;gt; IN A &amp;lt;cluster-ip&amp;gt;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>请求样例：
&lt;ul>
&lt;li>kubernetes.default.svc.cluster.local. IN A&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>响应样例：
&lt;ul>
&lt;li>kubernetes.default.svc.cluster.local. 4 IN A 10.3.0.1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>如果 &amp;lt;service&amp;gt; 对象具有 &amp;lt;cluster-ip&amp;gt; 且为 IPv6 地址。&lt;/p>
&lt;p>&lt;strong>AAAA 记录 格式&lt;/strong>：&lt;code>&amp;lt;service&amp;gt;.&amp;lt;ns&amp;gt;.svc.&amp;lt;zone&amp;gt;. &amp;lt;ttl&amp;gt; IN AAAA &amp;lt;cluster-ip&amp;gt;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>请求样例：
&lt;ul>
&lt;li>kubernetes.default.svc.cluster.local. IN AAAA&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>响应样例：
&lt;ul>
&lt;li>kubernetes.default.svc.cluster.local. 4 IN AAAA 2001:db8::1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="srv-record">SRV Record&lt;a class="td-heading-self-link" href="#srv-record" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;h3 id="ptr-record">PTR Record&lt;a class="td-heading-self-link" href="#ptr-record" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;h3 id="总结">总结&lt;a class="td-heading-self-link" href="#%e6%80%bb%e7%bb%93" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;p>Service 域名与 Service 的 CLUSTER-IP 具有关联关系&lt;/p>
&lt;p>Headless 类型的 Service 的 RR 格式&lt;/p>
&lt;p>参考：&lt;a href="https://github.com/kubernetes/dns/blob/master/docs/specification.md#24---records-for-a-headless-service">官方文档&lt;/a>
现在假定一个 Headless 类型的 Service 对象名为 &lt;code>&amp;lt;service&amp;gt;&lt;/code>，在名为 &lt;code>&amp;lt;ns&amp;gt;&lt;/code> 名称空间，没有 CLUSTER-IP，Service 关联的每个 Pod 的主机名为 &lt;code>&amp;lt;hostname&amp;gt;&lt;/code>，每个 Pod 的 IP 地址为 &lt;code>&amp;lt;endpoint-ip&amp;gt;&lt;/code>。则 DNS 实现程序必须具有下列几种类型的 Records(记录)。&lt;/p>
&lt;h3 id="aaaaa-record-1">A/AAAA Record&lt;a class="td-heading-self-link" href="#aaaaa-record-1" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;p>对于 Headless 类型的 Service，Service 对应的每个 endpoint 的 &lt;code>&amp;lt;endpoint-ip&amp;gt;&lt;/code>(也就是 Pod 的 IP)，都必须有一个 A 记录。如果 endpoint 不存在，则 DNS-Rcode 应该是 NXDOMAIN。并且，&amp;lt;endpoint-ip&amp;gt; 会对应两种 A 记录&lt;/p>
&lt;ul>
&lt;li>
&lt;p>通过 Service 名称解析到 endpoint-ip 的 Record&lt;/p>
&lt;/li>
&lt;li>
&lt;p>通过 Pod 主机名解析到 endpoint-ip 的 Record。注意，该记录只有在 Statefulset 生成的 Pod 才有效果。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>针对 Service 名称的 A 记录格式&lt;/strong>：&lt;code>&amp;lt;service&amp;gt;.&amp;lt;ns&amp;gt;.svc.&amp;lt;zone&amp;gt;. &amp;lt;ttl&amp;gt; IN A &amp;lt;endpoint-ip&amp;gt;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>请求样例：
&lt;ul>
&lt;li>headless.default.svc.cluster.local. IN A&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>响应样例：
&lt;ul>
&lt;li>headless.default.svc.cluster.local. 4 IN A 10.3.0.1&lt;/li>
&lt;li>headless.default.svc.cluster.local. 4 IN A 10.3.0.2&lt;/li>
&lt;li>headless.default.svc.cluster.local. 4 IN A 10.3.0.3&lt;/li>
&lt;li>&amp;hellip;.. 有多少个 endpoint 就有多少个响应&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>注意：Headless 与 ClusterIP 类型的 Service 最大的不同在于下面的 Resource Record。说白了就是多了个子域名&lt;/p>
&lt;p>除了上面的 A 记录，还必须要有这样一种 A 记录。Service 对应的 endpoint 的 &lt;code>&amp;lt;endpoint-ip&amp;gt;&lt;/code>(也就是 Pod 的 IP)，还必须有另一个 A 记录，该记录是 &lt;code>&amp;lt;endpoint-ip&amp;gt;&lt;/code> 与 包含 &lt;code>&amp;lt;hostname&amp;gt;&lt;/code>(也就是 Pod 的主机名) 的域名的对应关系。如果一个给定的 hostname 具有多个 IPv4 地址，则每个 IP 都要有一个 A 记录。&lt;/p>
&lt;p>&lt;strong>针对 Pod 主机名的 A 记录格式&lt;/strong>：&lt;code>&amp;lt;hostname&amp;gt;.&amp;lt;service&amp;gt;.&amp;lt;ns&amp;gt;.svc.&amp;lt;zone&amp;gt;. &amp;lt;ttl&amp;gt; IN A &amp;lt;endpoint-ip&amp;gt;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>请求样例：
&lt;ul>
&lt;li>my-pet.headless.default.svc.cluster.local. IN A&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>响应样例：
&lt;ul>
&lt;li>my-pet.headless.default.svc.cluster.local. 4 IN A 10.3.0.100&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>AAAA 记录格式&lt;/strong>&lt;/p>
&lt;p>略，把 A 改为 AAAA，IPv4 改为 IPv6，与 ClusterIP 类型的 Service 的 A 和 AAAA 记录的对应关系一样。&lt;/p>
&lt;h3 id="srv-record-1">SRV Record&lt;a class="td-heading-self-link" href="#srv-record-1" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;h3 id="ptr-record-1">PTR Record&lt;a class="td-heading-self-link" href="#ptr-record-1" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;h3 id="总结-1">总结&lt;a class="td-heading-self-link" href="#%e6%80%bb%e7%bb%93-1" aria-label="Heading self-link">&lt;/a>&lt;/h3>
&lt;p>Service 域名 与 Service 关联的后端 Pod 的 IP 具有解析关系。&lt;/p>
&lt;p>带主机名的域名与 Service 关联的后端 Pod 的 IP 具有解析关系&lt;/p>
&lt;h2 id="externalname-类型的-service-的-rr-格式">ExternalName 类型的 Service 的 RR 格式&lt;a class="td-heading-self-link" href="#externalname-%e7%b1%bb%e5%9e%8b%e7%9a%84-service-%e7%9a%84-rr-%e6%a0%bc%e5%bc%8f" aria-label="Heading self-link">&lt;/a>&lt;/h2>
&lt;ul>
&lt;li>CNAME Record：&lt;code>&amp;lt;service&amp;gt;.&amp;lt;ns&amp;gt;.svc.&amp;lt;zone&amp;gt;. &amp;lt;ttl&amp;gt; IN CNAME &amp;lt;ExtName&amp;gt;.&lt;/code>
&lt;ul>
&lt;li>请求样例：foo.default.svc.cluster.local. IN A&lt;/li>
&lt;li>响应样例：
&lt;ul>
&lt;li>foo.default.svc.cluster.local. 10 IN CNAME &lt;a href="https://www.example.com">www.example.com&lt;/a>.&lt;/li>
&lt;li>&lt;a href="https://www.example.com">www.example.com&lt;/a>. 28715 IN A 192.0.2.53&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>示例：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 在default名称空间中有一个名为 myapp 的 servcie ，ip 为 10.108.255.155&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>root@master-1 ~&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>&lt;span style="color:#8f5902;font-style:italic"># kubectl get svc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>S&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 239d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>myapp NodePort 10.108.255.155 &amp;lt;none&amp;gt; 80:52202/TCP 6d10h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 这个 default 名称空间下的 myapp 的 service，在coredns中记录的域名为 myapp.default.svc.cluster.local ，对应的ip为 10.108.255.155&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>root@master-1 ~&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>&lt;span style="color:#8f5902;font-style:italic"># kubectl exec -it -n test myapp-5ccfc89896-zxljh -- /bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>root@myapp-5ccfc89896-zxljh /&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>&lt;span style="color:#8f5902;font-style:italic"># ping myapp.default&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PING myapp.default.svc.cluster.local &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>10.108.255.155&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> 56&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>84&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#0000cf;font-weight:bold">64&lt;/span> bytes from myapp.default.svc.cluster.local &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>10.108.255.155&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>: &lt;span style="color:#000">icmp_seq&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#000">ttl&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">64&lt;/span> &lt;span style="color:#000">time&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>0.030 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>有两种类型的控制器，各自有两种类型的 Service。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>root@desistdaydream:~# kubectl get svc -n logging
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>S&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log-bj-test-grafana ClusterIP 10.103.6.159 &amp;lt;none&amp;gt; 80/TCP 2d4h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log-bj-test-grafana-headless ClusterIP None &amp;lt;none&amp;gt; 80/TCP 4h37m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log-bj-test-loki ClusterIP 10.102.159.19 &amp;lt;none&amp;gt; 3100/TCP 2d4h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log-bj-test-loki-headless ClusterIP None &amp;lt;none&amp;gt; 3100/TCP 2d4h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@desistdaydream:~# kubectl get pod -n logging -o wide
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log-bj-test-grafana-7764f5b4d7-28ngk 2/2 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 2d4h 10.244.2.129 master-3.bj-test &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log-bj-test-loki-0 1/1 Running &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> 2d4h 10.244.1.211 master-2.bj-test &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>首先实验 ClusterIP 类型的 Service&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup log-bj-test-grafana.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: log-bj-test-grafana.logging.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address: 10.103.6.159
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup log-bj-test-loki.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: log-bj-test-loki.logging.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address: 10.102.159.19
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>实验 Headless 类型的 Service&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 解析 Service 名&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup log-bj-test-grafana-headless.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: log-bj-test-grafana-headless.logging.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address: 10.244.2.129
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup log-bj-test-loki-headless.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: log-bj-test-loki-headless.logging.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address: 10.244.1.211
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 解析主机名&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup log-bj-test-grafana-7764f5b4d7-28ngk.log-bj-test-grafana-headless.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>** server can&lt;span style="color:#4e9a06">&amp;#39;t find log-bj-test-grafana-7764f5b4d7-28ngk.log-bj-test-grafana-headless.logging.svc.cluster.local: NXDOMAIN
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">** server can&amp;#39;&lt;/span>t find log-bj-test-grafana-7764f5b4d7-28ngk.log-bj-test-grafana-headless.logging.svc.cluster.local: NXDOMAIN
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup log-bj-test-loki-0.log-bj-test-loki-headless.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: log-bj-test-loki-0.log-bj-test-loki-headless.logging.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address: 10.244.1.211
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>SRV 记录&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~ &lt;span style="color:#8f5902;font-style:italic"># nslookup _http-metrics._tcp.log-bj-test-loki-headless.logging.svc.cluster.local&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: _http-metrics._tcp.log-bj-test-loki-headless.logging.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address: 10.244.1.211
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: CoreDNS</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/CoreDNS/</guid><description/></item><item><title>Docs: DNS 管理与优化</title><link>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/DNS-%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/10.%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes-%E7%BD%91%E7%BB%9C/Kubernetes-DNS/DNS-%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96/</guid><description/></item></channel></rss>