<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>多用途模块的指令 on 断念梦的站点</title><link>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/</link><description>Recent content in 多用途模块的指令 on 断念梦的站点</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/index.xml" rel="self" type="application/rss+xml"/><item><title>log 相关模块</title><link>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/log-%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/log-%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97/</guid><description>概述 参考：
org 官方文档，http - ngx_http_log_module org 官方文档，stream - ngx_stream_log_modeule access_log log_format 日志格式示例 { &amp;#34;args&amp;#34;: &amp;#34;$args&amp;#34;, &amp;#34;body_bytes_sent&amp;#34;: &amp;#34;$body_bytes_sent&amp;#34;, &amp;#34;bytes_sent&amp;#34;: &amp;#34;$bytes_sent&amp;#34;, &amp;#34;connection_requests&amp;#34;: &amp;#34;$connection_requests&amp;#34;, &amp;#34;geoip2_city&amp;#34;: &amp;#34;$geoip2_city&amp;#34;, &amp;#34;geoip2_city_country_name&amp;#34;: &amp;#34;$geoip2_city_country_name&amp;#34;, &amp;#34;geoip2_latitude&amp;#34;: &amp;#34;$geoip2_latitude&amp;#34;, &amp;#34;geoip2_longitude&amp;#34;: &amp;#34;$geoip2_longitude&amp;#34;, &amp;#34;geoip2_region_name&amp;#34;: &amp;#34;$geoip2_region_name&amp;#34;, &amp;#34;http_host&amp;#34;: &amp;#34;$http_host&amp;#34;, &amp;#34;http_user_agent&amp;#34;: &amp;#34;$http_user_agent&amp;#34;, &amp;#34;http_x_forwarded_for&amp;#34;: &amp;#34;$http_x_forwarded_for&amp;#34;, &amp;#34;remote_addr&amp;#34;: &amp;#34;$remote_addr&amp;#34;, &amp;#34;remote_port&amp;#34;: &amp;#34;$remote_port&amp;#34;, &amp;#34;request&amp;#34;: &amp;#34;$request&amp;#34;, &amp;#34;request_uri&amp;#34;: &amp;#34;$request_uri&amp;#34;, &amp;#34;request_time&amp;#34;: &amp;#34;$request_time&amp;#34;, &amp;#34;request_method&amp;#34;: &amp;#34;$request_method&amp;#34;, &amp;#34;scheme&amp;#34;: &amp;#34;$scheme&amp;#34;, &amp;#34;server_name&amp;#34;: &amp;#34;$server_name&amp;#34;, &amp;#34;server_protocol&amp;#34;: &amp;#34;$server_protocol&amp;#34;, &amp;#34;ssl_protocol&amp;#34;: &amp;#34;$ssl_protocol&amp;#34;, &amp;#34;ssl_cipher&amp;#34;: &amp;#34;$ssl_cipher&amp;#34;, &amp;#34;status&amp;#34;: &amp;#34;$status&amp;#34;, &amp;#34;time_iso8601&amp;#34;: &amp;#34;$time_iso8601&amp;#34;, &amp;#34;upstream&amp;#34;: &amp;#34;$upstream_addr&amp;#34;, &amp;#34;upstream_connect_time&amp;#34;: &amp;#34;$upstream_connect_time&amp;#34;, &amp;#34;upstream_response_time&amp;#34;: &amp;#34;$upstream_response_time&amp;#34; } log_format promtail_json &amp;#39;{&amp;#34;@timestamp&amp;#34;:&amp;#34;$time_iso8601&amp;#34;,&amp;#39; &amp;#39;&amp;#34;@version&amp;#34;:&amp;#34;Promtail json&amp;#34;,&amp;#39; &amp;#39;&amp;#34;server_addr&amp;#34;:&amp;#34;$server_addr&amp;#34;,&amp;#39; &amp;#39;&amp;#34;remote_addr&amp;#34;:&amp;#34;$remote_addr&amp;#34;,&amp;#39; &amp;#39;&amp;#34;host&amp;#34;:&amp;#34;$host&amp;#34;,&amp;#39; &amp;#39;&amp;#34;uri&amp;#34;:&amp;#34;$uri&amp;#34;,&amp;#39; &amp;#39;&amp;#34;body_bytes_sent&amp;#34;:$body_bytes_sent,&amp;#39; &amp;#39;&amp;#34;bytes_sent&amp;#34;:$body_bytes_sent,&amp;#39; &amp;#39;&amp;#34;request&amp;#34;:&amp;#34;$request&amp;#34;,&amp;#39; &amp;#39;&amp;#34;request_length&amp;#34;:$request_length,&amp;#39; &amp;#39;&amp;#34;request_time&amp;#34;:$request_time,&amp;#39; &amp;#39;&amp;#34;status&amp;#34;:&amp;#34;$status&amp;#34;,&amp;#39; &amp;#39;&amp;#34;http_referer&amp;#34;:&amp;#34;$http_referer&amp;#34;,&amp;#39; &amp;#39;&amp;#34;http_user_agent&amp;#34;:&amp;#34;$http_user_agent&amp;#34;&amp;#39; &amp;#39;}&amp;#39;;</description></item><item><title>geo/geoip 模块指令</title><link>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/geo_geoip-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/geo_geoip-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</guid><description>概述 参考：
http 模块下的 geo 模块、geoip 模块 stream 模块下的 geo 模块、geoip 模块 geo 与 geoip 模块实现了 GeoIP 的能力，可以根据 客户端的 IP 地址 来创建新的变量。这些变量用来表示 IP 地址所属国际、所属城市、所在经/纬度 等等。
不同之处在于：
geo 手动设置变量及其值 geoip 根据 MaxMind 数据库中的信息，创建一系列的变量 通过 geo/geoip 模块，我们可以根据客户端的 IP 地址，获取这些 IP 的一些信息，比如 IP 所属城市、所属国家，所在经/纬度 等等。我们常常可以根据这些分类的信息，进行 IP 过滤、或日志记录。说白了，geo/geoip 模块就是为每个 IP 地址添加一系列的 Label(标签)，以便后续可以根据这些 标签 进行 记录 和 筛选。
v2ray 中的测试，有很多 geosite 相关的设置，就是这个道理，每个 IP 地址都可以具有很多标签、甚至连这个 IP 所属的公司都会记录，以便可以根据这些进行来决定一个请求是 直连 还是 代理。
http 模块下的 geo 模块指令 geo [ADDRESS] $VARIABLE {} # 根据 ADDRESS 定义新的变量</description></item><item><title>geoip2 模块</title><link>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/geoip2-%E6%A8%A1%E5%9D%97/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/geoip2-%E6%A8%A1%E5%9D%97/</guid><description>概述 参考：
GitHub 项目，leev/ngx_http_geoip2_module 从这个页面可以下载 GeoIP2 和 旧版的 GeoIP 数据库
geoip2 模块与 geo/geoip 模块的功能类似。geoip2 模块根据 客户端的 IP 信息，使用 MaxMind 的 geoip2 数据库中的值创建变量。只不过指令用法稍有不同。
用法示例 首先通过 mmdblookup 工具查看数据库中的内容 ~]# mmdblookup --file ./GeoLite2-City.mmdb --ip 59.46.138.226 { &amp;#34;city&amp;#34;: { &amp;#34;geoname_id&amp;#34;: 1814087 &amp;lt;uint32&amp;gt; &amp;#34;names&amp;#34;: { &amp;#34;en&amp;#34;: &amp;#34;Dalian&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;ja&amp;#34;: &amp;#34;大連市&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;ru&amp;#34;: &amp;#34;Далянь&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;zh-CN&amp;#34;: &amp;#34;大连&amp;#34; &amp;lt;utf8_string&amp;gt; } } &amp;#34;continent&amp;#34;: { &amp;#34;code&amp;#34;: &amp;#34;AS&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;geoname_id&amp;#34;: 6255147 &amp;lt;uint32&amp;gt; &amp;#34;names&amp;#34;: { &amp;#34;de&amp;#34;: &amp;#34;Asien&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;en&amp;#34;: &amp;#34;Asia&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;es&amp;#34;: &amp;#34;Asia&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;fr&amp;#34;: &amp;#34;Asie&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;ja&amp;#34;: &amp;#34;アジア&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;pt-BR&amp;#34;: &amp;#34;Ásia&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;ru&amp;#34;: &amp;#34;Азия&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;zh-CN&amp;#34;: &amp;#34;亚洲&amp;#34; &amp;lt;utf8_string&amp;gt; } } &amp;#34;country&amp;#34;: { &amp;#34;geoname_id&amp;#34;: 1814991 &amp;lt;uint32&amp;gt; &amp;#34;iso_code&amp;#34;: &amp;#34;CN&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;names&amp;#34;: { &amp;#34;de&amp;#34;: &amp;#34;China&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;en&amp;#34;: &amp;#34;China&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;es&amp;#34;: &amp;#34;China&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;fr&amp;#34;: &amp;#34;Chine&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;ja&amp;#34;: &amp;#34;中国&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;pt-BR&amp;#34;: &amp;#34;China&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;ru&amp;#34;: &amp;#34;Китай&amp;#34; &amp;lt;utf8_string&amp;gt; &amp;#34;zh-CN&amp;#34;: &amp;#34;中国&amp;#34; &amp;lt;utf8_string&amp;gt; } } &amp;#34;location&amp;#34;: { &amp;#34;accuracy_radius&amp;#34;: 1000 &amp;lt;uint16&amp;gt; &amp;#34;latitude&amp;#34;: 38.</description></item><item><title>ssl 模块</title><link>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/ssl-%E6%A8%A1%E5%9D%97/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/ssl-%E6%A8%A1%E5%9D%97/</guid><description>概述 参考：
http 模块下的 ssl 模块 mail 模块下的 ssl 模块 stream 模块下的 ssl 模块 ssl 模块可以作用在 http、mail、stream 模块下，称为 ngx_http_ssl_module、ngx_mail_ssl_module、ngx_stream_ssl_module。
ssl 模块提供了 SSL/TLS 的必要支持，可以通过 Nginx 来为后端提供 HTTP 的服务配置 SSL、也可以为普通的 4 层服务配置 SSL。
ngx_http_ssl_module 该模块需要 OpenSSL 库的支持才可以正常使用。
ssl 模块启用后，Nginx 将可以处理 TLS/SSL 请求。当客户端发起 TLS/SSL 请求时，Nginx 中启用了 ssl 模块的 Virtual Server 作为服务端将会用配置好的证书与客户端进行认证。然后 Nginx 再作为客户端，向被代理的后端 Server 发起 TLS/SSL 请求。
注意：
如果一个 Virtual Server 代理的后端服务器是 HTTPS 的，那么就必须为 Virtual Server 启用 ssl 模块。因为客户端发起的请求，总是会被该 Virtual Server 重定向到 443 端口。 SSL 指令 ssl on | off; # 启用 ssl 策略。</description></item><item><title>upstream 模块指令</title><link>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/upstream-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/Web/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/upstream-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</guid><description>概述 参考：
http 模块下的 upstream 模块 stream 模块下的 upstream 模块 http 和 stream 模块下的 upstream 模块都是用来定义一组可以处理流量的后端服务器，称为 Server Group(服务器组)。
Nginx 中有一个 Server Group(服务器组) 的概念，Server Group 表示一组可以处理流量的后端服务器，proxy_pass 等指令可以直接引用 服务器组的名称，以便将流量转发到这一组后端服务器上去。并且，可以根据规则，来决定给组内每个服务器分配多少流量，还可以根据规则如何判断 服务器是否掉线，掉线如何处理 等等。
Server Group 功能通过 upstream 模块实现。而 upstream NAME {} 指令是一个非常通用的指令，可以作用在顶级的 http{} 和 stream{} 配置环境中。因为 ServerGroup 就是定义一组服务器以便被 Nginx 的流量处理相关指令引用，故而属于通用配置，只不过定义在 http{} 配置环境中的 ServerGroup 不能被 stream{} 配置环境中的指令引用，反之亦然。
注意：虽然 upstream 比较通用，但也是逻辑意义上的通用，对于 http{} 与 stream{} 来说，它们都有各自的 upstream{} 模块
upstream NAME {} 定义的名为 NAME 的一组服务器，可以被 proxy_pass 、fastcgi_pass、uwsgi_pass、scgi_pass、memcached_pass、grpc_pass 这些指令直接引用，以便将流量直接代理到这组服务器上，并且可以根据一定的算法，轮流调度。</description></item></channel></rss>