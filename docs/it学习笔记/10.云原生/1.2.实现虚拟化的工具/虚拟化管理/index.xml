<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>断念梦 – 虚拟化管理</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/</link><description>Recent content in 虚拟化管理 on 断念梦</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Hyper-V</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/hyper-v/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/hyper-v/</guid><description/></item><item><title>Docs: Libvirt</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/libvirt/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/libvirt/</guid><description/></item><item><title>Docs: 克隆与批量创建虚拟机</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E5%85%8B%E9%9A%86%E4%B8%8E%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E5%85%8B%E9%9A%86%E4%B8%8E%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/cloning-a-vm">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/cloning-a-vm&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>注意：CentOS7 想要挂载 Ubuntu 20.04 虚拟机内的文件是不行的，内核不支持，报错如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># guestmount --rw -a /var/lib/libvirt/images/common-ubuntu-test.bj-test.qcow2 -m /dev/ubuntu-vg/lv-0 /mnt/test&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>libguestfs: error: mount_options: mount exited with status 32: mount: wrong fs type, bad option, bad superblock on /dev/mapper/ubuntu--vg-lv--0,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> missing codepage or helper program, or other error
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> In some cases useful info is found in syslog - try
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> dmesg | tail or so.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestmount: ‘/dev/ubuntu-vg/lv-0’ could not be mounted.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestmount: Did you mean to mount one of these filesystems?
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestmount: /dev/sda1 &lt;span style="color:#f92672">(&lt;/span>unknown&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestmount: /dev/sda2 &lt;span style="color:#f92672">(&lt;/span>xfs&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestmount: /dev/ubuntu-vg/lv-0 &lt;span style="color:#f92672">(&lt;/span>xfs&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其他依赖挂载的命令都是这种报错，比如 virt-sysprep、virt-edit 等等&lt;/p>
&lt;p>通过 virt-sysprep 传送网络设备的配置文件？&lt;/p>
&lt;h1 id="修改-vm-的-ip">修改 VM 的 IP&lt;/h1></description></item><item><title>Docs: 虚拟化调试和优化指南</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%B0%83%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%B0%83%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/</guid><description>
&lt;h1 id="虚拟化调试和优化指南">虚拟化调试和优化指南&lt;/h1>
&lt;p>红帽官方的推荐方案，中文：&lt;a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index&lt;/a>&lt;/p>
&lt;h2 id="配置网卡多队列">配置网卡多队列&lt;/h2>
&lt;p>&lt;a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-Networking-Multi-queue_virtio-net">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-Networking-Multi-queue_virtio-net&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://notes-learning.oss-cn-beijing.aliyuncs.com/un2vm8/1616123000773-caaef550-ee28-43b8-94eb-417936b2e088.jpeg" alt="">&lt;/p>
&lt;h2 id="配置磁盘缓存">配置磁盘缓存&lt;/h2>
&lt;p>&lt;a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-BlockIO-Caching">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index#sect-Virtualization_Tuning_Optimization_Guide-BlockIO-Caching&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://notes-learning.oss-cn-beijing.aliyuncs.com/un2vm8/1616123000746-e6a1ffde-9736-4cd9-a115-0449b16ef631.jpeg" alt="">&lt;/p>
&lt;p>经测试&lt;/p>
&lt;p>node 类型 dd 命令速度为 不到 500MB/s&lt;/p>
&lt;p>writeback 类型 de 命令速度为 不到 300MB/s&lt;/p>
&lt;h1 id="网卡软中断过高问题">网卡软中断过高问题&lt;/h1>
&lt;p>原文连接：&lt;a href="http://www.simlinux.com/archives/1798.html">http://www.simlinux.com/archives/1798.html&lt;/a>&lt;/p>
&lt;h2 id="问题背景">问题背景&lt;/h2>
&lt;p>游戏网关高峰期时出网络丢包,CPU0 软中断%sys 高达 90%。&lt;/p>
&lt;p>这意思就是说多个 CPU 中，只有 1 个来处理软中断信号&lt;/p>
&lt;h2 id="解决思路">解决思路：&lt;/h2>
&lt;p>让多个 CPU 平均处理中断的信号&lt;/p>
&lt;p>在虚拟机中，默认一个网卡收到的消息，只由 1 个 CPU 来处理，所以需要修改配置来让该网卡可以把数据交给多个 CPU 进行处理&lt;/p>
&lt;h2 id="解决方式">解决方式：&lt;/h2>
&lt;p>virsh edit &amp;lt;虚拟机名称&amp;gt; # 修改磁盘缓存策略&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;disk&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;file&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">device=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;disk&amp;#39;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;driver&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;qemu&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;qcow2&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">cache=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;none&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span> # 添加cache=&amp;#39;none&amp;#39;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;source&lt;/span> &lt;span style="color:#a6e22e">file=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;/var/lib/libvirt/images/iptv-unc-haproxy-1.qcow2&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;target&lt;/span> &lt;span style="color:#a6e22e">dev=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;vda&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">bus=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;virtio&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;address&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;pci&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">domain=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0000&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">bus=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x00&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">slot=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x07&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">function=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/disk&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>virsh edit &amp;lt;虚拟机名称&amp;gt; # 修改网卡队列&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;interface&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;bridge&amp;#39;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;mac&lt;/span> &lt;span style="color:#a6e22e">address=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;52:54:00:29:39:61&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;source&lt;/span> &lt;span style="color:#a6e22e">bridge=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;br0&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;model&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;virtio&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;driver&lt;/span> &lt;span style="color:#a6e22e">name=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;vhost&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">queues=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;8&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span> # 添加该行
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;address&lt;/span> &lt;span style="color:#a6e22e">type=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;pci&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">domain=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0000&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">bus=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x01&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">slot=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x00&amp;#39;&lt;/span> &lt;span style="color:#a6e22e">function=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;0x0&amp;#39;&lt;/span>&lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/interface&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ethtool -L eth0 combined 8 # 修改实际队列&lt;/p>
&lt;p>可以使用 ethtool -l eth0 来查看 eth0 网卡的队列数，收到的数据是由几个 cpu 进行处理的&lt;/p></description></item><item><title>Docs: 虚拟化管理</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;h2 id="创建虚拟机后常见操作">创建虚拟机后常见操作&lt;/h2>
&lt;p>根据&lt;a href="docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E4%BA%91%E5%8E%9F%E7%94%9F/1.2.%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%B0%83%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97.md">虚拟化调试和优化指南&lt;/a>调优，&lt;code>virsh edit XXX&lt;/code> 修改文件&lt;/p>
&lt;p>使用 &lt;code>systemctl enable serial-getty@ttyS0.service --now&lt;/code> 启动 serial-getty 服务，以便通过 &lt;code>virsh console&lt;/code> 命令连接虚拟机&lt;/p>
&lt;p>压缩 qcow2 文件，创建 backing file 的 qcow2 和 xml 文件当做模板以便批量创建虚拟机所用&lt;/p>
&lt;ul>
&lt;li>&lt;code>qemu-img convert -c -O qcow2 test.qcow2 test.qcow2.new&lt;/code>&lt;/li>
&lt;/ul>
&lt;h1 id="扩大-kvm-虚拟机-image-镜像">扩大 KVM 虚拟机 image 镜像&lt;/h1>
&lt;p>直接使用 qemu-img resize 的时候一定要先备份镜像。先使用 virsh shutdown VM 关闭镜像再进行如下操作：&lt;/p>
&lt;ul>
&lt;li>给原始系统文件添加磁盘空间
&lt;ul>
&lt;li>qemu-img resize centos7-baseImage-50G.qcow2 +500G&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>进入虚拟机操作新建硬盘分区
&lt;ul>
&lt;li>parted /dev/vda mkpart primary XXX 100%(XX 改为指定的最后一块扇区的容量)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>扩容 LVM，注意/dev/vda4 设备为真实情况的设备名称，注意修改
&lt;ul>
&lt;li>partprobe(可能还需要重启)&lt;/li>
&lt;li>pvcreate /dev/vda4&lt;/li>
&lt;li>vgextend vg0 /dev/vda4&lt;/li>
&lt;li>lvextend -l+100%FREE /dev/mapper/vg0-root
&lt;ul>
&lt;li>这里可以使用 lvextend -l +单元数量 /dev/mapper/vg0-lv101&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>扩展文件系统大小，注意/dev/mapper/vg0-root 修改为真实情况的分区路径
&lt;ul>
&lt;li>xfs_growfs /dev/mapper/vg0-root&lt;/li>
&lt;li>或者普通文件系统使用下面的命令&lt;/li>
&lt;li>resize2fs /dev/mapper/vg0-root (-f 强制扩展)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="通过-veth-设备查找对应的虚拟机">通过 veth 设备查找对应的虚拟机&lt;/h1>
&lt;p>通过 xml 文件查看虚拟机的 mac 地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># grep &amp;#34;mac addr&amp;#34; lchTest.xml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;mac address&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;52:54:00:6a:86:89&amp;#39;&lt;/span>/&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>筛选网络设备 mac&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># ip a | grep &amp;#34;86:89&amp;#34; -B 1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>127: vnet1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span style="color:#ae81ff">1500&lt;/span> qdisc pfifo_fast master br1 state UNKNOWN group default qlen &lt;span style="color:#ae81ff">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> link/ether fe:54:00:6a:86:89 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>由此可见，vnet 设备的 mac 与虚拟机的 mac 在后面几位是永远保持一致的，所以可以通过 vnet 设备的 mac ，从所有虚拟机中的 xml 进行筛选就行可以找到 vnet 设备对应的虚拟机了。&lt;/p>
&lt;h2 id="应用实例">应用实例&lt;/h2>
&lt;p>比如我现在能看到 4 个 vnet 设备。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># ip a&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>.....
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>62: vnet3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span style="color:#ae81ff">1500&lt;/span> qdisc pfifo_fast master br1 state UNKNOWN group default qlen &lt;span style="color:#ae81ff">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> link/ether fe:54:00:5c:11:85 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inet6 fe80::fc54:ff:fe5c:1185/64 scope link
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>79: vnet0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span style="color:#ae81ff">1500&lt;/span> qdisc mq master br1 state UNKNOWN group default qlen &lt;span style="color:#ae81ff">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> link/ether fe:54:00:68:20:51 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inet6 fe80::fc54:ff:fe68:2051/64 scope link
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>127: vnet1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span style="color:#ae81ff">1500&lt;/span> qdisc pfifo_fast master br1 state UNKNOWN group default qlen &lt;span style="color:#ae81ff">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> link/ether fe:54:00:6a:86:89 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inet6 fe80::fc54:ff:fe6a:8689/64 scope link
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>139: vnet2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span style="color:#ae81ff">1500&lt;/span> qdisc pfifo_fast master br1 state UNKNOWN group default qlen &lt;span style="color:#ae81ff">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> link/ether fe:54:00:3a:95:ef brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inet6 fe80::fc54:ff:fe3a:95ef/64 scope link
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我想看看 vnet3 是关联到哪个虚拟机上了，就可以进行如下操作：(首先看到 vnet3 的 mac 为 fe:54:00:5c:11:85)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># grep -r &amp;#34;5c:11:85&amp;#34; /etc/libvirt/qemu/*&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/etc/libvirt/qemu/cobbler.test.tjiptv.net.xml: &amp;lt;mac address&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;52:54:00:5c:11:85&amp;#39;&lt;/span>/&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这时候可以看到，是 cobbler.test.tjiptv.net.xml 这台虚拟机在使用 vnet3 。&lt;/p></description></item></channel></rss>