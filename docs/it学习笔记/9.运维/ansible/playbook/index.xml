<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Êñ≠ÂøµÊ¢¶ ‚Äì Playbook</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/</link><description>Recent content in Playbook on Êñ≠ÂøµÊ¢¶</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Conditionals Êù°‰ª∂Âà§Êñ≠</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/conditionals-%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/conditionals-%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html">ÂÆòÊñπÊñáÊ°£,Áî®Êà∑ÊåáÂçó-‰º†ÁªüÁõÆÂΩï-Êù°‰ª∂&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ÈÄöÂ∏∏Ôºåplay ÁöÑÁªìÊûúÂèØËÉΩÂèñÂÜ≥‰∫é variableÔºåfactÔºàÊúâÂÖ≥ËøúÁ®ãÁ≥ªÁªüÁöÑÁü•ËØÜÔºâÊàñÂÖàÂâçÁöÑ‰ªªÂä°ÁªìÊûú„ÄÇÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÂèòÈáèÁöÑÂÄºÂèØËÉΩÂèñÂÜ≥‰∫éÂÖ∂‰ªñÂèòÈáè„ÄÇÂèØ‰ª•Âü∫‰∫é‰∏ªÊú∫ÊòØÂê¶Á¨¶ÂêàÂÖ∂‰ªñÊù°‰ª∂Êù•ÂàõÂª∫ÂÖ∂‰ªñÁªÑÊù•ÁÆ°ÁêÜ‰∏ªÊú∫„ÄÇ&lt;/p>
&lt;p>Ansible Âú®Êù°‰ª∂‰∏≠‰ΩøÁî® Jinja ÁöÑ &lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html">ÊµãËØï&lt;/a> Âíå &lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html">ËøáÊª§Âô® &lt;/a>Êù•ÂÆûÁé∞Êù°‰ª∂Âà§Êñ≠„ÄÇËØ¶ËßÅ [Ansible Template ÊñáÁ´†‰∏≠„ÄäAnsible Êâ©Â±ïÊµãËØïÂáΩÊï∞„ÄãÁ´†ËäÇ](‚úèIT Â≠¶‰π†Á¨îËÆ∞/üõ†Ô∏è9.ËøêÁª¥/Ansible/Playbook/Templates%20 Ê®°Êùø(Jinja2).md Ê®°Êùø(Jinja2).md)&lt;/p>
&lt;h2 id="Êù°‰ª∂Âà§Êñ≠ÁöÑÁÆÄÂçïÊ†∑‰æã">Êù°‰ª∂Âà§Êñ≠ÁöÑÁÆÄÂçïÊ†∑‰æã&lt;/h2>
&lt;p>‰∏ãÈù¢ÁöÑÊ†∑‰æãË°®Á§∫ÔºöÂΩì ansible_facts[&amp;lsquo;os_family&amp;rsquo;] ÂèòÈáèÁöÑÂÄº‰∏∫ Debian ÁöÑÊó∂ÂÄôÔºåÂàôÊâßË°å‰∏äÈù¢ÁöÑ‰ªªÂä°Ôºå‰ªªÂä°ÂÜÖÂÆπÊòØÊâßË°å shutdown ÂëΩ‰ª§&lt;/p>
&lt;pre>&lt;code>tasks:
- name: &amp;quot;shut down Debian flavored systems&amp;quot;
command: /sbin/shutdown -t now
when: ansible_facts['os_family'] == &amp;quot;Debian&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>Âà§Êñ≠‰∏ªÊú∫ÊòØÂê¶Âú®Êüê‰∏™ÁªÑ‰∏≠
when: inventory_hostname is search(&amp;ldquo;master&amp;rdquo;) # ÂΩì inventory_hostname ÂèòÈáèÁöÑÂÄºÂê´Êúâ master Â≠óÁ¨¶‰∏≤Êó∂„ÄÇ
when: inventory_hostname == groups[&amp;lsquo;kube_master&amp;rsquo;][0] # ÂΩìÂΩìÂâç‰∏ªÊú∫ÁöÑ inventory_hostname ÂèòÈáèÂÄºÁ≠â‰∫é kube_master ‰∏ªÊú∫ÁªÑ‰∏≠ÁöÑÁ¨¨‰∏ÄÂè∞‰∏ªÊú∫Êó∂
when: inventory_hostname in groups[&amp;lsquo;kube_master&amp;rsquo;] # ÂΩìÂΩìÂâç‰∏ªÊú∫ÁöÑ inventory_hostname ÂèòÈáèÂÄºÂú® kube_master ‰∏ªÊú∫ÁªÑ‰∏≠Êó∂„ÄÇ&lt;/p>
&lt;p>when: testvar1 is none # ÂΩìÂèòÈáè testvar1 Â∑≤ÂÆö‰πâÔºå‰ΩÜÊòØÂÄº‰∏∫Á©∫Êó∂„ÄÇNoteÔºöÂÄº‰∏∫Á©∫Ë°®Á§∫ key ÂêéÈù¢ÁöÑÂÄº‰ªÄ‰πàÈÉΩ‰∏çÂÜôÔºåÂèåÂºïÂè∑ÈÉΩ‰∏çËÉΩÊúâ
when: ((groups[&amp;lsquo;kube_master&amp;rsquo;] | length) &amp;gt; 1) # ÂΩì kube_master ‰∏ªÊú∫ÁªÑÁöÑ‰∏ªÊú∫Êï∞ÈáèÂ§ß‰∫é 1 Êó∂„ÄÇ&lt;/p></description></item><item><title>Docs: Debugger</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/debugger/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/debugger/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_debugger.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-Debugging ‰ªªÂä°&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Ansible Êèê‰æõ‰∫Ü‰∏Ä‰∏™‰ªªÂä°Ë∞ÉËØïÂô®ÔºåÂõ†Ê≠§ÊÇ®ÂèØ‰ª•Âú®ÊâßË°åËøáÁ®ã‰∏≠‰øÆÂ§çÈîôËØØÔºåËÄå‰∏çÊòØÁºñËæë playbook Âπ∂ÂÜçÊ¨°ËøêË°åÂÆÉ‰ª•Êü•ÁúãÊõ¥ÊîπÊòØÂê¶ÊúâÊïà„ÄÇÊÇ®ÂèØ‰ª•Âú®‰ªªÂä°‰∏ä‰∏ãÊñá‰∏≠ËÆøÈóÆË∞ÉËØïÂô®ÁöÑÊâÄÊúâÂäüËÉΩ„ÄÇÊÇ®ÂèØ‰ª•Ê£ÄÊü•ÊàñËÆæÁΩÆÂèòÈáèÁöÑÂÄºÔºåÊõ¥Êñ∞Ê®°ÂùóÂèÇÊï∞ÔºåÂπ∂‰ΩøÁî®Êñ∞ÁöÑÂèòÈáèÂíåÂèÇÊï∞ÈáçÊñ∞ËøêË°å‰ªªÂä°„ÄÇË∞ÉËØïÂô®ÂèØËÆ©ÊÇ®Ëß£ÂÜ≥ÊïÖÈöúÂéüÂõ†Âπ∂ÁªßÁª≠ÊâßË°å playbook„ÄÇ&lt;/p>
&lt;h3 id="enabling-the-debugger-with-thedebuggerkeywordhttpsdocsansiblecomansiblelatestuser_guideplaybooks_debuggerhtmlid8">&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_debugger.html#id8">Enabling the debugger with thedebuggerkeyword&lt;/a>&lt;/h3>
&lt;p>You can use the &lt;code>debugger&lt;/code> keyword to enable (or disable) the debugger for a specific play, role, block, or task. This option is especially useful when developing or extending playbooks, plays, and roles. You can enable the debugger on new or updated tasks. If they fail, you can fix the errors efficiently. The &lt;code>debugger&lt;/code> keyword accepts five values:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Value&lt;/th>
&lt;th>Result&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>always&lt;/td>
&lt;td>Always invoke the debugger, regardless of the outcome&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>never&lt;/td>
&lt;td>Never invoke the debugger, regardless of the outcome&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>on_failed&lt;/td>
&lt;td>Only invoke the debugger if a task fails&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>on_unreachable&lt;/td>
&lt;td>Only invoke the debugger if a host is unreachable&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>on_skipped&lt;/td>
&lt;td>Only invoke the debugger if the task is skipped&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Docs: loop(Âæ™ÁéØ)</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/loop%E5%BE%AA%E7%8E%AF/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/loop%E5%BE%AA%E7%8E%AF/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-‰º†ÁªüÁõÆÂΩï-Loops&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ÊúâÊó∂ÈúÄË¶ÅÈáçÂ§çÊâßË°åÂ§öÊ¨°‰ªªÂä°„ÄÇÂú®ËÆ°ÁÆóÊú∫ÁºñÁ®ã‰∏≠ÔºåËøôÁß∞‰∏∫Âæ™ÁéØ„ÄÇÂ∏∏ËßÅÁöÑ Ansible Âæ™ÁéØÂåÖÊã¨‰ΩøÁî®Êñá‰ª∂Ê®°ÂùóÊõ¥ÊîπÂ§ö‰∏™Êñá‰ª∂Âíå/ÊàñÁõÆÂΩïÁöÑÊâÄÊúâÊùÉÔºå‰ΩøÁî®Áî®Êà∑Ê®°ÂùóÂàõÂª∫Â§ö‰∏™Áî®Êà∑‰ª•ÂèäÈáçÂ§çËΩÆËØ¢Ê≠•È™§Áõ¥Âà∞ËææÂà∞ÁâπÂÆöÁªìÊûú„ÄÇAnsible Êèê‰æõ‰∫Ü‰∏§‰∏™Áî®‰∫éÂàõÂª∫Âæ™ÁéØÁöÑÂÖ≥ÈîÆÂ≠óÔºö&lt;code>loop&lt;/code> Âíå &lt;code>with_XX&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>with_XX&lt;/code> ÂÖ≥ÈîÆÂ≠ó‰æùËµñ‰∫é &lt;a href="https://docs.ansible.com/ansible/latest/plugins/inventory.html">Lookup Plugins(Lookup Êèí‰ª∂)&lt;/a>„ÄÇÂÖ∂‰∏≠ Ê†πÊçÆÊèí‰ª∂ÁöÑ‰∏çÂêåÂäüËÉΩÔºå‰ΩøÁî®‰∏çÂêåÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇe.g.with_items ‰πüÊòØ Lookup Êèí‰ª∂„ÄÇ
&lt;ul>
&lt;li>Êèí‰ª∂ÁöÑ‰ªãÁªçËØ¶ËßÅÔºö&lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/Ansible/Playbook/Plugins(%E6%8F%92%E4%BB%B6).md">Plugins Êèí‰ª∂&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>loop&lt;/code> ÂÖ≥ÈîÆÂ≠ó‰∏é with_list Á≠âÊïàÔºåÊòØÁÆÄÂçïÂæ™ÁéØÁöÑÊúÄ‰Ω≥ÈÄâÊã©&lt;/li>
&lt;/ul>
&lt;h2 id="Âæ™ÁéØÁöÑÁÆÄÂçïÊ†∑‰æã">Âæ™ÁéØÁöÑÁÆÄÂçïÊ†∑‰æãÔºö&lt;/h2>
&lt;p>‰∏ãÈù¢Â±ïÁ§∫‰∫ÜÂæ™ÁéØÁöÑÂü∫Êú¨ÂäüËÉΩÔºöÈÄöËøá loop ÊàñËÄÖ with_*Êù•ÂØπ‰∏Ä‰∏™ÂàóË°®‰∏≠ÁöÑÂÄºÈÄê‰∏ÄÊìç‰Ωú&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Ê∑ªÂä†Âá†‰∏™Áî®Êà∑„ÄÇÂæ™ÁéØÁöÑÂü∫Êú¨‰ΩøÁî®ÊñπÂºè&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">user&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ item }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">state&lt;/span>: &lt;span style="color:#ae81ff">present&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">loop&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">testuser1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">testuser2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Á≠âÂêå‰∫é&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Ê∑ªÂä†Âá†‰∏™Áî®Êà∑„ÄÇÂÖàËµãÂÄºÁªô‰∏Ä‰∏™ÂèòÈáèÔºåÁÑ∂ÂêéÂú®loopÂÖ≥ÈîÆÂ≠ó‰∏≠ÂºïÁî®ÂèòÈáè„ÄÇ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">vars&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">users&lt;/span>: [&lt;span style="color:#ae81ff">testuser1, testuser2]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">user&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ item }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">state&lt;/span>: &lt;span style="color:#ae81ff">present&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">loop&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ users}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>‰∏äËø∞Á§∫‰æã‰∏é‰∏ãÈù¢ÁöÑ‰ªªÂä°Áõ∏Âêå„ÄÇËøôÂ∞±Áõ∏ÂΩì‰∫éÂ∞Ü‰∏§‰∏™‰ªªÂä°Ê®°ÂùóÁõ∏Âêå‰ΩÜÊòØÊìç‰ΩúÂÜÖÂÆπ‰∏çÂêåÁöÑ‰ªªÂä°ÂêàÂπ∂Êàê‰∏∫‰∏Ä‰∏™‰ªªÂä°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Ê∑ªÂä†testuser1Áî®Êà∑&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">user&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;testuser1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">state&lt;/span>: &lt;span style="color:#ae81ff">present&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Ê∑ªÂä†testuser2Áî®Êà∑&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">user&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;testuser2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">state&lt;/span>: &lt;span style="color:#ae81ff">present&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>‰ªéÁ§∫‰æãÂèØ‰ª•ÁúãÂá∫ÔºåÂæ™ÁéØÊòØ‰ΩøÁî®‰∏§‰∏™ÈÉ®ÂàÜÊù•ÁªÑÊàêÊï¥‰∏™Âæ™ÁéØÁöÑÂäüËÉΩ&lt;/p>
&lt;ol>
&lt;li>{{ item }}ÂèòÈáèÊù•ÂºïÁî® loop ÂÖ≥ÈîÆÂ≠óÂÆö‰πâÁöÑÂÜÖÂÆπ
&lt;ol>
&lt;li>NoteÔºöÂú®ÂÆö‰πâ‰ªª‰ΩïÂèòÈáèÊó∂Ôºå‰∏ÄÂÆöË¶ÅÈÅøÂÖç‰ΩøÁî® item ‰∏∫ÂèòÈáèÂêç&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>loop ÂÖ≥ÈîÆÂ≠óÊù•ÂÆö‰πâÂàóË°®ÂÜÖÂÆπ&lt;/li>
&lt;/ol>
&lt;h1 id="Âæ™ÁéØÊ†∑‰æã">Âæ™ÁéØÊ†∑‰æãÔºö&lt;/h1>
&lt;h2 id="ÈÄêË°åËØªÂèñÊñá‰ª∂">ÈÄêË°åËØªÂèñÊñá‰ª∂&lt;/h2>
&lt;p>ÂèÇËÄÉÈìæÊé•Ôºö&lt;a href="https://stackoverflow.com/questions/48403508/ansible-read-local-file-to-var-and-then-loop-read-line-by-line">https://stackoverflow.com/questions/48403508/ansible-read-local-file-to-var-and-then-loop-read-line-by-line&lt;/a>&lt;/p>
&lt;p>ÈÄöËøá lookup Êèí‰ª∂‰∏≠ÁöÑ file ÂäüËÉΩËØªÂèñ ip_vs.conf Êñá‰ª∂ÔºåÂπ∂ÈÄêË°åËØªÂèñÊñá‰ª∂ËµãÂÄºÁªôÂèòÈáè infoÔºåÁÑ∂ÂêéÊâßË°å modprobe ÂëΩ‰ª§Ë∞ÉÁî®ÂèòÈáèÔºåÈÄê‰∏ÄÂä†ËΩΩÊ®°Âùó&lt;/p>
&lt;p>NoteÔºö‰∏ÄÂÆöË¶ÅÂä† .splitlines() ÔºåÂê¶Âàô‰ºöÂ∞ÜÊñá‰ª∂ÈáåÁöÑÊç¢Ë°åÁ¨¶ÈÉΩËµãÂÄºÁªôÂèòÈáèÔºåËøôÊ†∑ÔºåÂèòÈáèÂè™Êúâ‰∏Ä‰∏™ÂÄºÔºåËÄå‰∏çÊòØ‰∏Ä‰∏™ÂàóË°®‰∫Ü&lt;/p>
&lt;pre>&lt;code>- name: Âä†ËΩΩÊ®°Âùó
vars:
info: &amp;quot;{{ lookup('file', 'ip_vs.conf').splitlines() }}&amp;quot;
loop: &amp;quot;{{ info }}&amp;quot;
shell: modprobe {{ item }}
&lt;/code>&lt;/pre>
&lt;h2 id="ÂåπÈÖçÁõÆÂΩï‰∏ãÊâÄÊúâÊñá‰ª∂">ÂåπÈÖçÁõÆÂΩï‰∏ãÊâÄÊúâÊñá‰ª∂&lt;/h2>
&lt;p>Ëøô‰∏™‰ªªÂä°ÈÄöËøá with_fieglob Êèí‰ª∂Êù•Ëé∑ÂèñËØ•ÂâßÊú¨ÁöÑ file ÁõÆÂΩï‰∏ã rpm ÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂ÔºåÂ∞ÜËøô‰∫õÊñá‰ª∂Â§çÂà∂Âà∞ËøúÁ®ãËÆæÂ§áÁöÑ /root/downloads/kubeadm-let-ctl/ ÁõÆÂΩï‰∏ã„ÄÇ&lt;/p>
&lt;pre>&lt;code>- name: Êã∑Ë¥ùrpmÂÆâË£ÖÂåÖ
copy:
src: &amp;quot;{{ item }}&amp;quot;
dest: /root/downloads/kubeadm-let-ctl/
with_fileglob:
- rpm/*
&lt;/code>&lt;/pre></description></item><item><title>Docs: Playbook Role(ËßíËâ≤)</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/playbook-role%E8%A7%92%E8%89%B2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/playbook-role%E8%A7%92%E8%89%B2/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-Roles&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://ansible-tran.readthedocs.io/en/latest/docs/playbooks_roles.html">Ansible ‰∏≠ÊñáÊùÉÂ®ÅÊåáÂçóÔºåPlaybooks-Playbook ËßíËâ≤Âíå Incluede ËØ≠Âè•&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ÂàöÂºÄÂßãÂ≠¶‰π†ËøêÁî® playbook Êó∂ÔºåÂèØËÉΩ‰ºöÊää playbook ÂÜôÊàê‰∏Ä‰∏™ÂÜÖÂÆπÂæàÂ§öÁöÑÊñá‰ª∂ÔºåËøôÁßçÊÉÖÂÜµ‰∏çÂà©‰∫éÊâ©Â±ïÂíåÂ§çÁî®„ÄÇËøôÊó∂ÂÄôÂèØ‰ª•‰ΩøÁî®‰∏ÄÁßçÊñπÂºèÔºåÂ∞ÜËøô‰∏™Â§çÊùÇÁöÑ playbook Ê®°ÂùóÂåñÔºåÂç≥ÊãÜÂàÜ‰∏Ä‰∏™Â§çÊùÇÁöÑ playbook Êñá‰ª∂ÊàêÂ§ö‰∏™Èõ∂Êï£ÁöÑÂ∞èÊñá‰ª∂ÔºåÂ∞ÜÂÖ∂ÁªÑÂêàÊàê‰∏Ä‰∏™‰∏Ä‰∏™ÂÖ∑Êúâ‰∏çÂêåÂäüËÉΩÁöÑ playbook„ÄÇ&lt;/p>
&lt;p>ËøôÊó∂ÂÄôÂ∞±ÈúÄË¶ÅÁî®Âà∞ ansible playbook ÁöÑ roles Ê¶ÇÂøµ‰∫Ü„ÄÇroles ÂÆûÈôÖ‰∏äÊòØÂØπ playbook ËøõË°åÈÄªËæë‰∏äÁöÑÂàíÂàÜÔºå‰∏ªË¶Å‰æùËµñ‰∫éÁõÆÂΩïÁöÑÂëΩÂêçÂíåÊëÜÊîæÔºå‰∏Ä‰∏™ Role Â∞±ÊòØ‰∏Ä‰∏™ÁõÆÂΩïÔºåRole Âêç‰∏éÁõÆÂΩïÂêçÁõ∏Âêå„ÄÇ&lt;/p>
&lt;p>ÂΩìÊàë‰ª¨ÂºÄÂßãÊÄùËÄÉËøô‰∫õÊ¶ÇÂøµÔºötasks, handlers, variables Á≠âÁ≠âÔºåÊòØÂê¶ÂèØ‰ª•Â∞ÜÂÆÉ‰ª¨ÊäΩË±°‰∏∫‰∏Ä‰∏™Êõ¥Â§ßÁöÑÊ¶ÇÂøµÂë¢„ÄÇÊàë‰ª¨ËÄÉËôëÁöÑ‰∏çÂÜçÊòØ‚ÄùÂ∞ÜËøô‰∫õ tasksÔºåhandlersÔºåvariables Á≠âÁ≠âÂ∫îÁî®Âà∞Ëøô‰∫õ hosts ‰∏≠‚ÄùÔºåËÄåÊòØÊúâ‰∫ÜÊõ¥ÊäΩË±°ÁöÑÊ¶ÇÂøµÔºåÊØîÂ¶ÇÔºö‚ÄùËøô‰∫õ hosts ÊòØ dbservers‚Äù ÊàñËÄÖ ‚ÄúÈÇ£‰∫õ hosts ÊòØ webservers‚ÄùÔºàÊ≥®ÔºödbserverÔºåwebservers Âç≥ÊòØ‚ÄùËßíËâ≤‚ÄùÔºâ„ÄÇËøôÁßçÊÄùËÄÉÊñπÂºèÂú®ÁºñÁ®ã‰∏≠Ë¢´Áß∞‰∏∫‚ÄùÂ∞ÅË£Ö‚ÄùÔºåÂ∞ÜÂÖ∂‰∏≠ÂÖ∑‰ΩìÁöÑÂäüËÉΩÂ∞ÅË£Ö‰∫ÜËµ∑Êù•„ÄÇ‰∏æ‰∏™‰æãÂ≠êÔºå‰Ω†‰ºöÂºÄËΩ¶‰ΩÜÂπ∂‰∏çÈúÄË¶ÅÁü•ÈÅìÂºïÊìéÁöÑÂ∑•‰ΩúÂéüÁêÜÔºàÊ≥®ÔºöÂêåÊ†∑ÁöÑÈÅìÁêÜÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÁü•ÈÅì‚ÄùËøô‰∫õ hosts ÊòØ dbservers‚ÄùÔºåËÄå‰∏çÈúÄË¶ÅÁü•ÈÅìÂÖ∂‰∏≠ÊúâÂì™‰∫õ taskÔºåhandlers Á≠âÔºâ„ÄÇ&lt;/p>
&lt;h1 id="roles-ÁõÆÂΩïÁªìÊûÑ">roles ÁõÆÂΩïÁªìÊûÑ&lt;/h1>
&lt;p>‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÊúÄÂü∫Êú¨ÁöÑ roles ÁõÆÂΩïÁªìÊûÑ„ÄÇÂú®Ëøô‰∏™ÁõÆÂΩïÁªìÊûÑÈáåÔºåÊúâ‰∏§‰∏™ rolesÔºå‰∏Ä‰∏™Âêç‰∏∫ commonÔºåÂè¶‰∏Ä‰∏™Âêç‰∏∫ webservers&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>site.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webservers.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fooservers.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>roles/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> common/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tasks/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handlers/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> files/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> templates/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vars/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaults/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> meta/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webservers/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tasks/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaults/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> meta/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÊØè‰∏™ÁõÆÂΩïÁöÑ‰ΩúÁî®Â¶Ç‰∏ã&lt;/p>
&lt;ul>
&lt;li>&lt;strong>tasks&lt;/strong> # ÂåÖÂê´ËßíËâ≤Ë¶ÅÊâßË°å‰ªªÂä°ÁöÑ‰∏ªË¶ÅÂàóË°®&lt;/li>
&lt;li>&lt;strong>handlers&lt;/strong> # ÂåÖÂê´ handlersÔºåËØ• role ÁîöËá≥ËØ• role ‰πãÂ§ñÁöÑ‰ªª‰ΩïÂú∞ÊñπÈÉΩÂèØ‰ª•‰ΩøÁî®Ëøô‰∫õ handlers&lt;/li>
&lt;li>&lt;strong>defaults&lt;/strong> # ÂåÖÂê´ËØ• role ÁöÑÂèòÈáèÁöÑÈªòËÆ§ÂÄº (see Using Variables for more information).&lt;/li>
&lt;li>&lt;strong>vars&lt;/strong> # ÂåÖÂê´ËØ• role ÁöÑÂèòÈáèÁöÑËá™ÂÆö‰πâÂÄº (see Using Variables for more information).&lt;/li>
&lt;li>&lt;strong>files&lt;/strong> # ÂåÖÂê´ÂèØ‰ª•ÈÄöËøáËØ• role ÈÉ®ÁΩ≤ÁöÑÊñá‰ª∂„ÄÇÊØîÂ¶ÇÈÄöËøá script Ê®°Âùó‰ΩøÁî®ÁöÑËÑöÊú¨„ÄÇ&lt;/li>
&lt;li>&lt;strong>templates&lt;/strong> # ÂåÖÂê´ÂèØ‰ª•ÈÄöËøáËØ• role ÈÉ®ÁΩ≤ÁöÑÊ®°Êùø&lt;/li>
&lt;li>&lt;strong>meta&lt;/strong> # ‰∏∫ËØ• role ÂÆö‰πâÁöÑ‰∏Ä‰∫õÂÖÉÊï∞ÊçÆ&lt;/li>
&lt;/ul>
&lt;p>NoteÔºöÂ¶ÇÊûúÊÉ≥ËÆ©Ëøô‰∫õÁõÆÂΩïÁîüÊïàÔºåÈúÄË¶ÅÂú® tasks„ÄÅhandlers„ÄÅvars„ÄÅdefaults„ÄÅmeta ÁõÆÂΩï‰∏≠‰øùÂ≠òÂêç‰∏∫ main.yml ÁöÑÊñá‰ª∂Ôºåmain.yml ÁöÑ‰ΩúÁî®ËØ¶ËßÅ‰∏ãÊñá„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÊñá‰ª∂ÊàñÁõÆÂΩï‰∏çÂ≠òÂú®ÔºåÂàô‰ºöÂøΩÁï•&lt;/p>
&lt;h2 id="‰ΩøÁî®-roles">‰ΩøÁî® roles&lt;/h2>
&lt;p>Âú® playbook.yaml Êñá‰ª∂‰∏≠Ôºå‰ΩøÁî®ÂÖ≥ÈîÆÂ≠ó roles Âç≥ÂèØË∞ÉÁî®ÊåáÂÆöÁöÑ roles ÂÜÖÁöÑÂ∑•‰ΩúÂÜÖÂÆπ&lt;/p>
&lt;pre>&lt;code>- hosts: webservers
roles:
- common
- webservers
&lt;/code>&lt;/pre>
&lt;p>roles ‰∏ãÊåáÂÆöÁöÑÊØè‰∏™ÂÄº(roles Âêç)Ôºåansbile ÈÉΩ‰ºöÂéª‰∏éËØ•ÂÄºÂêåÂêçÁöÑÁõÆÂΩï‰∏≠Ëé∑ÂèñÂÖ∂‰∏≠ÊâÄÊúâÊñá‰ª∂ÔºåËøôÂÖ∂‰∏≠ÈÅµÂæ™Â¶Ç‰∏ãËßÑÂàôÔºö&lt;/p>
&lt;ul>
&lt;li>Â¶ÇÊûú roles/X/tasks/main.yml Â≠òÂú®, ÂàôÂÖ∂‰∏≠ÂàóÂá∫ÁöÑ task Â∞ÜÊ∑ªÂä†Âà∞ play ‰∏≠„ÄÇ&lt;/li>
&lt;li>Â¶ÇÊûú roles/X/handlers/main.yml Â≠òÂú®, ÂàôÂÖ∂‰∏≠ÂàóÂá∫ÁöÑ handler ÈÉΩÂ∞ÜÊ∑ªÂä†Âà∞ play ‰∏≠&lt;/li>
&lt;li>Â¶ÇÊûú roles/X/vars/main.yml Â≠òÂú®, ÂàôÂÖ∂‰∏≠ÂàóÂá∫ÁöÑ variables ÈÉΩÂ∞ÜÊ∑ªÂä†Âà∞ play ‰∏≠&lt;/li>
&lt;li>Â¶ÇÊûú roles/X/defaults/main.yml Â≠òÂú®, ÂàôÂÖ∂‰∏≠ÂàóÂá∫ÁöÑÈªòËÆ§ÂèòÈáèÂÄº‰ºöË¢´Ê∑ªÂä†Âà∞ play ‰∏≠ÔºåÂ¶ÇÊûúÂú®ÂÖ∂‰ªñÂú∞ÊñπÊ≤°ÊúâÊåáÂÆöÂÖ∂‰∏≠ÂàóÂá∫ÁöÑÂèòÈáèÁöÑÂÄºÔºåÂàô‰ºöÁî®Âà∞ÈªòËÆ§ÂÄº&lt;/li>
&lt;li>Â¶ÇÊûú roles/X/meta/main.yml Â≠òÂú®,ÂàôÂÖ∂‰∏≠ÂàóÂá∫ÁöÑÊâÄÊúâËßíËâ≤‰æùËµñÈ°πÈÉΩÂ∞ÜÊ∑ªÂä†Âà∞ËßíËâ≤ÂàóË°®‰∏≠&lt;/li>
&lt;li>task ‰∏≠ copyÔºåscriptÔºåtemplate Êàñ include task Ê®°ÂùóÈÉΩ‰ºöËá™Âä®ÂºïÁî® role/X/{files,templates,tasks} ÁõÆÂΩï‰∏≠Êñá‰ª∂ÔºåËÄå‰∏çÂøÖ‰ΩøÁî®ÁªùÂØπË∑ØÂæÑËÆæÁΩÆ„ÄÇ&lt;/li>
&lt;/ul>
&lt;p>NoteÔºö&lt;/p>
&lt;ul>
&lt;li>ÂÖ∂‰∏≠ X ‰∏∫ Role ÂêçÂ≠ó&lt;/li>
&lt;li>ansible ‰ºö‰ªé‰ª•‰∏ãÂá†‰∏™ÁõÆÂΩï‰∏≠ÂØªÊâæ‰∏é roles ÂêåÂêçÁöÑÁõÆÂΩïÊù•Ëé∑ÂèñÂÖ∂‰∏≠ÁöÑÂÜÖÂÆπ
&lt;ul>
&lt;li>./roles # playbook.yaml Êñá‰ª∂ÊâÄÂú®ÁöÑÁõÆÂΩïÂØªÊâæ roles ÁõÆÂΩï&lt;/li>
&lt;li>/etc/ansbile/roles # ÈªòËÆ§ÁöÑÁ≥ªÁªüÁ∫ßÂà´ÁöÑ roles ÁõÆÂΩï&lt;/li>
&lt;li>/root/.ansible/roles&lt;/li>
&lt;li>/usr/share/ansible/roles&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>‰πüÂèØ‰ª•Âú® ansible ÁöÑÈÖçÁΩÆÊñá‰ª∂ ansbile.cfg ‰∏≠‰øÆÊîπ roles_path Â≠óÊÆµÊù•ÊåáÂÆöÈªòËÆ§Á≥ªÁªüÁ∫ßÂà´ role ÁöÑ‰ΩçÁΩÆ&lt;/li>
&lt;/ul>
&lt;h1 id="roles-ÁõÆÂΩïÁªìÊûÑÁöÑÊúÄ‰Ω≥Á§∫‰æã">roles ÁõÆÂΩïÁªìÊûÑÁöÑÊúÄ‰Ω≥Á§∫‰æã&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/sample_setup.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-ÈÖçÁΩÆÊ†∑‰æã&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>production &lt;span style="color:#75715e"># ÈÄÇÁî®‰∫é production ÁöÑ Inventory Êñá‰ª∂&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>staging &lt;span style="color:#75715e"># ÈÄÇÁî®‰∫é staging ÁöÑ Inventory Êñá‰ª∂&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group_vars/ &lt;span style="color:#75715e"># Âú®ËøôÈáåÂÆö‰πâÁªÑÁöÑÂèòÈáè&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group1.yml &lt;span style="color:#75715e"># Êñá‰ª∂Âêç‰ª•ÁªÑÂêçÂëΩÂêçÔºågroup1.yml ÊòØÈÄÇÁî®‰∫é group1 ÁªÑÁöÑÂèòÈáè&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group2.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>host_vars/ &lt;span style="color:#75715e"># Âú®ËøôÈáåÂÆö‰πâ‰∏ªÊú∫ÂèòÈáè&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hostname1.yml &lt;span style="color:#75715e"># Êñá‰ª∂Âêç‰ª•‰∏ªÊú∫ÂêçÂëΩÂêçÔºåhostname1.yml ÊòØÈÄÇÁî®‰∫é hostname1 ‰∏ªÊú∫ÁöÑÂèòÈáè&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hostname2.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>library/ &lt;span style="color:#75715e"># if any custom modules, put them here (optional)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>module_utils/ &lt;span style="color:#75715e"># if any custom module_utils to support modules, put them here (optional)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>filter_plugins/ &lt;span style="color:#75715e"># if any custom filter plugins, put them here (optional)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>site.yml &lt;span style="color:#75715e"># master playbook&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webservers.yml &lt;span style="color:#75715e"># playbook for webserver tier&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dbservers.yml &lt;span style="color:#75715e"># playbook for dbserver tier&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ÂΩìÈúÄË¶ÅÁÆ°ÁêÜÂ§ö‰∏™ Role Êó∂ÔºåÂèØ‰ª•Âú® roles/ ÁõÆÂΩï‰∏≠&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>roles/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> common/ &lt;span style="color:#75715e"># Âêç‰∏∫ common ÁöÑËßíËâ≤&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> tasks/ &lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> main.yml &lt;span style="color:#75715e"># &amp;lt;-- tasks file can include smaller files if warranted&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handlers/ &lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> main.yml &lt;span style="color:#75715e"># &amp;lt;-- handlers file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> templates/ &lt;span style="color:#75715e"># &amp;lt;-- files for use with the template resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ntp.conf.j2 &lt;span style="color:#75715e"># &amp;lt;------- templates end in .j2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> files/ &lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bar.txt &lt;span style="color:#75715e"># &amp;lt;-- files for use with the copy resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> foo.sh &lt;span style="color:#75715e"># &amp;lt;-- script files for use with the script resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> vars/ &lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> main.yml &lt;span style="color:#75715e"># &amp;lt;-- variables associated with this role&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> defaults/ &lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> main.yml &lt;span style="color:#75715e"># &amp;lt;-- default lower priority variables for this role&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> meta/ &lt;span style="color:#75715e">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> main.yml &lt;span style="color:#75715e"># &amp;lt;-- role dependencies&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> library/ &lt;span style="color:#75715e"># roles can also include custom modules&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> module_utils/ &lt;span style="color:#75715e"># roles can also include custom module_utils&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lookup_plugins/ &lt;span style="color:#75715e"># or other types of plugins, like lookup in this case&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webtier/ &lt;span style="color:#75715e"># Âêç‰∏∫ webtier ÁöÑËßíËâ≤ÔºåÂÖ∂ÂÜÖÁöÑÊú∫ÊûÑ‰∏é common Áõ∏Âêå&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> monitoring/ &lt;span style="color:#75715e"># Âêå‰∏ä&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fooapp/ &lt;span style="color:#75715e"># Âêå‰∏ä&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ......
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="group_vars-‰∏é-host_vars-ÁõÆÂΩï">group_vars ‰∏é host_vars ÁõÆÂΩï&lt;/h2>
&lt;p>ÁªÑÂèòÈáè‰∏é‰∏ªÊú∫ÂèòÈáèÁöÑÊñá‰ª∂Èô§‰∫ÜÂèØ‰ª•ÊîæÂú® Palybook ÁöÑÊ†πÁõÆÂΩïÔºåËøòÂèØ‰ª•ÊîæÂú®Â≠òÊîæ Inventory Êñá‰ª∂ÁöÑÁõÆÂΩï‰∏≠ÔºåÊØîÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>inventories/ &lt;span style="color:#75715e"># ËøôÈáåÂ≠òÊîæ Inventory ÁõÆÂΩïÔºåÈÄöËøáÂú®ÂëΩ‰ª§Ë°å‰∏≠‰ΩøÁî® -i ÈÄâÈ°π‰ª•ÊåáÂÆö Inventory Êñá‰ª∂&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> production/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hosts &lt;span style="color:#75715e"># inventory file for production servers&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group_vars/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group1.yml &lt;span style="color:#75715e"># here we assign variables to particular groups&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group2.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> host_vars/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hostname1.yml &lt;span style="color:#75715e"># here we assign variables to particular systems&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hostname2.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> staging/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hosts &lt;span style="color:#75715e"># inventory file for staging environment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group_vars/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group1.yml &lt;span style="color:#75715e"># here we assign variables to particular groups&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> group2.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> host_vars/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stagehost1.yml &lt;span style="color:#75715e"># here we assign variables to particular systems&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stagehost2.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>library/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>module_utils/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>filter_plugins/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>site.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>webservers.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>dbservers.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>roles/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> common/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webtier/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> monitoring/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fooapp/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Ëá≥‰∫é group_vars ‰∏é host_vars Âú®‰∏çÂêåÁõÆÂΩïÁöÑ‰ºòÂÖàÁ∫ßÂèØ‰ª•ÂèÇËÄÉ [Ansible ÂèòÈáè-‰ºòÂÖàÁ∫ß](‚úèIT Â≠¶‰π†Á¨îËÆ∞/üõ†Ô∏è9.ËøêÁª¥/Ansible/Ansible%20Variables(ÂèòÈáè).md Variables(ÂèòÈáè).md) ÈÉ®ÂàÜ&lt;/p></description></item><item><title>Docs: Playbook ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/playbook-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/playbook-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/cli/ansible-playbook.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-‰º†ÁªüÁõÆÂΩï-‰ΩøÁî®ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑-ansible-playbook&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ansible-playbook Áî®Êù•ËøêË°åËøêË°å Ansible playbookÔºå‰ª•‰æøÂú®ÁõÆÊ†á‰∏ªÊú∫‰∏äÊâßË°åÂÆö‰πâÁöÑ‰ªªÂä°„ÄÇ&lt;/p>
&lt;h1 id="ansible-playbook--ËøêË°å-ansible-playbooksÂπ∂Âú®ÁõÆÊ†á‰∏ªÊú∫‰∏äÊâßË°åÂâßÊú¨‰∏≠ÂÆö‰πâÁöÑ‰ªªÂä°">ansible-playbook # ËøêË°å Ansible playbooksÔºåÂπ∂Âú®ÁõÆÊ†á‰∏ªÊú∫‰∏äÊâßË°åÂâßÊú¨‰∏≠ÂÆö‰πâÁöÑ‰ªªÂä°&lt;/h1>
&lt;h2 id="syntaxËØ≠Ê≥ï">Syntax(ËØ≠Ê≥ï)&lt;/h2>
&lt;p>&lt;strong>ansible-playbook [OPTIONS] PLAYBOOK&lt;/strong>&lt;/p>
&lt;h3 id="options">OPTIONS&lt;/h3>
&lt;ul>
&lt;li>--ask-vault-pass # ask for vault password&lt;/li>
&lt;li>--become-method # privilege escalation method to use (default=%(default)s), use ansible-doc -t become -l to list valid choices.&lt;/li>
&lt;li>--become-user # run operations as this user (default=root)&lt;/li>
&lt;li>&lt;strong>-C, &amp;ndash;check&lt;/strong> # ‰∏çÂú®ÁõÆÊ†á‰∏ªÊú∫‰∏äÊâßË°å‰ªªÂä°Ôºå‰ªÖÊ£ÄÊü•‰ªªÂä°ÊòØÂê¶ÂèØ‰ª•ÂÆåÊàê&lt;/li>
&lt;li>--flush-cache # clear the fact cache for every host in inventory&lt;/li>
&lt;li>--force-handlers # run handlers even if a task fails&lt;/li>
&lt;li>&lt;strong>-i, &amp;ndash;inventory, &amp;ndash;inventory-file&lt;/strong> # ÊåáÂÆö inventory Êñá‰ª∂Ë∑ØÂæÑÊàñËÄÖ‰ª•ÈÄóÂè∑ÂàÜÈöîÁöÑ‰∏ªÊú∫ÂàóË°®„ÄÇ(‰∏çÊé®Ëçê‰ΩøÁî®ËØ•ÈÄâÈ°π)&lt;/li>
&lt;li>&lt;strong>-l , &amp;ndash;limit &lt;!-- raw HTML omitted -->&lt;/strong> # ÈôêÂÆöÊâßË°åÁöÑ‰∏ªÊú∫ËåÉÂõ¥„ÄÇÂèØ‰ª•ÂØπ‰∏ÄÊâπ‰∏ªÊú∫ÁöÑÂÖ∂‰∏≠‰∏ÄÂè∞ÊâßË°åÊìç‰ΩúÔºå‰ΩÜÊòØ‰æùÁÑ∂ÂèØ‰ª•‰ΩøÁî®ÂÖ∂‰ªñ‰∏ªÊú∫ÁöÑÂèòÈáè„ÄÇfurther limit selected hosts to an additional pattern&lt;/li>
&lt;li>&lt;strong>&amp;ndash;list-hosts&lt;/strong> # ÂàóÂá∫ÊâßË°åËØ•ÂâßÊú¨ÊâÄËÉΩÂåπÈÖçÂà∞ÁöÑ‰∏ªÊú∫Ôºå‰ΩÜÂπ∂‰∏ç‰ºöÊâßË°å&lt;/li>
&lt;li>&lt;strong>&amp;ndash;list-tags&lt;/strong> # ÂàóÂá∫ÊâÄÊúâÂèØÁî®ÁöÑ tags&lt;/li>
&lt;li>&lt;strong>&amp;ndash;list-tasks&lt;/strong> # ÂàóÂá∫ÊâÄÊúâÂç≥Â∞ÜË¢´ÊâßË°åÁöÑ‰ªªÂä°&lt;/li>
&lt;li>--private-key , &amp;ndash;key-file # use this file to authenticate the connection&lt;/li>
&lt;li>--scp-extra-args # specify extra arguments to pass to scp only (e.g. -l)&lt;/li>
&lt;li>--sftp-extra-args # specify extra arguments to pass to sftp only (e.g. -f, -l)&lt;/li>
&lt;li>--skip-tags # only run plays and tasks whose tags do not match these values&lt;/li>
&lt;li>--ssh-common-args # specify common arguments to pass to sftp/scp/ssh (e.g. ProxyCommand)&lt;/li>
&lt;li>--ssh-extra-args # specify extra arguments to pass to ssh only (e.g. -R)&lt;/li>
&lt;li>&lt;strong>&amp;ndash;start-at-task&lt;/strong> # start the playbook at the task matching this name&lt;/li>
&lt;li>&lt;strong>&amp;ndash;step&lt;/strong> # ‰∏ÄÊ≠•‰∏ÄÊ≠•ËøêË°å,‰πüÂ∞±ÊòØËØ¥Âú®ËøêË°åÊØè‰∏™‰ªªÂä°Âíå‰πãÂâçÔºå‰ºöÂºπÂá∫Á°ÆËÆ§‰ø°ÊÅØÔºåÁ°ÆËÆ§ÊâßË°åÔºåÊâç‰ºöÊâßË°åËØ•‰ªªÂä°„ÄÇÊúâ 3 ‰∏™ÈÄâÈ°πÔºåÊâßË°å„ÄÅ‰∏çÊâßË°å„ÄÅÁªßÁª≠(ÁªßÁª≠Â∞±ÊòØÊåáÂêéÁª≠‰ªªÂä°‰∏çÂÜçÁ°ÆËÆ§Ôºå‰ªéÂΩìÂâç‰ªªÂä°ÂºÄÂßãÊâßË°åÂÆåÂâ©‰∏ãÁöÑ‰ªªÂä°)&lt;/li>
&lt;li>--syntax-check # perform a syntax check on the playbook, but do not execute it&lt;/li>
&lt;li>&lt;strong>-t, &amp;ndash;tags&lt;/strong> # ‰ªÖËøêË°åÂ∏¶ÊúâÂêç‰∏∫ TAG Ê†áÁ≠æÁöÑ tasks ÊàñËÄÖ plays&lt;/li>
&lt;li>--vault-id # the vault identity to use&lt;/li>
&lt;li>--vault-password-file # vault password file&lt;/li>
&lt;li>--version # show program‚Äôs version number, config file location, configured module search path, module location, executable location and exit&lt;/li>
&lt;li>&lt;strong>-D, &amp;ndash;diff&lt;/strong> # ÂΩì‰ΩøÁî® template„ÄÅfile„ÄÅÁ≠âÊåá‰ª§Êõ¥ÊîπÊñá‰ª∂Êó∂ÔºåÊòæÁ§∫Ëøô‰∫õÊñá‰ª∂Êõ¥ÊîπÂâçÂêéÁöÑÂ∑ÆÂºÇ„ÄÇÈÄöÂ∏∏‰∏é &amp;ndash;check ÈÄâÈ°π‰∏ÄËµ∑‰ΩøÁî®„ÄÇ&lt;/li>
&lt;li>-K, &amp;ndash;ask-become-pass # ask for privilege escalation password&lt;/li>
&lt;li>-M, &amp;ndash;module-path # prepend colon-separated path(s) to module library (default=~/.ansible/plugins/modules:/usr/share/ansible/plugins/modules)&lt;/li>
&lt;li>-T , &amp;ndash;timeout # override the connection timeout in seconds (default=10)&lt;/li>
&lt;li>-b, &amp;ndash;become # run operations with become (does not imply password prompting)&lt;/li>
&lt;li>-c , &amp;ndash;connection # connection type to use (default=smart)&lt;/li>
&lt;li>&lt;strong>-e, &amp;ndash;extra-vars &amp;lt;@FILE | KEY=VALUE&amp;gt;&lt;/strong> # Ê∑ªÂä†È¢ùÂ§ñÁöÑÂèòÈáèÔºåÂèØ‰ª•ÊòØ &lt;code>KEY=VALUE&lt;/code> Ê†ºÂºè(Ëã•ÊòØ yaml ÁöÑËØùÂàôÊòØ &lt;code>KEY: VALUE&lt;/code> Ê†ºÂºè)Ôºå‰πüÂèØ‰ª•Áõ¥Êé•ÊåáÂÆö yaml Êàñ json Ê†ºÂºèÁöÑÊñá‰ª∂ÔºåÂ¶ÇÊûúÊåáÂÆöÊñá‰ª∂Ôºå‰ª• &lt;code>@&lt;/code> ÂºÄÂ§¥ÔºåÊØîÂ¶ÇÔºö
&lt;ul>
&lt;li>&lt;code>--extra-vars @~/ansible/defaults/main.yaml&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>-f , &amp;ndash;forks # specify number of parallel processes to use (default=5)&lt;/li>
&lt;li>-k, &amp;ndash;ask-pass # ask for connection password&lt;/li>
&lt;li>-u , &amp;ndash;user # connect as this user (default=None)&lt;/li>
&lt;li>&lt;strong>-v, &amp;ndash;verbose&lt;/strong> # ËØ¶ÁªÜÊ®°Âºè(-vvv ‰ºöËæìÂá∫Êõ¥Â§ö‰ø°ÊÅØ, -vvvv Â∞Ü‰ºöÂêØÁî® DEBUG Ê®°Âºè)&lt;/li>
&lt;/ul>
&lt;h2 id="example">EXAMPLE&lt;/h2>
&lt;ul>
&lt;li>‰ªé install packages Ëøô‰∏™‰ªªÂä°ÂºÄÂßãÊâßË°å playbook
&lt;ul>
&lt;li>ansible-playbook playbook.yml &amp;ndash;start-at=&amp;ldquo;install packages&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Âè™ÂØπ HLJHEB-PSC-SCORE-PM-OS04-EBRS-HA02 ‰∏ªÊú∫ÊâßË°å playbook
&lt;ul>
&lt;li>ansible-playbook -i inventory/ssc-pool-unicom-ha &amp;ndash;limit HLJHEB-PSC-SCORE-PM-OS04-EBRS-HA02 ha-gdas-proxy.yaml&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Docs: Plugins(Êèí‰ª∂)</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/plugins%E6%8F%92%E4%BB%B6/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/plugins%E6%8F%92%E4%BB%B6/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>ÂÆòÊñπÊñáÊ°£Ôºö&lt;a href="https://docs.ansible.com/ansible/latest/plugins/plugins.html">https://docs.ansible.com/ansible/latest/plugins/plugins.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Êèí‰ª∂ÊòØÂ¢ûÂº∫ Ansible Ê†∏ÂøÉÂäüËÉΩÁöÑ‰ª£Á†ÅÊÆµ„ÄÇAnsible ‰ΩøÁî®Êèí‰ª∂Êû∂ÊûÑÊù•ÂêØÁî®‰∏∞ÂØåÔºåÁÅµÊ¥ªÂíåÂèØÊâ©Â±ïÁöÑÂäüËÉΩÈõÜ„ÄÇ&lt;/p>
&lt;p>ÊúóËØª Ansible ÈôÑÂ∏¶‰∫ÜËÆ∏Â§öÊñπ‰æøÁöÑÊèí‰ª∂ÔºåÊÇ®ÂèØ‰ª•ËΩªÊùæÁºñÂÜôËá™Â∑±ÁöÑÊèí‰ª∂„ÄÇ&lt;/p>
&lt;p>Êú¨ËäÇ‰ªãÁªç Ansible ÈöèÈôÑÁöÑÂêÑÁßçÁ±ªÂûãÁöÑÊèí‰ª∂Ôºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/action.html">Action Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/become.html">Become Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/cache.html">Cache Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/callback.html">Callback Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/cliconf.html">Cliconf Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/connection.html">Connection Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/httpapi.html">Httpapi Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/inventory.html">Inventory Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/lookup.html">Lookup Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/netconf.html">Netconf Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/shell.html">Shell Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/strategy.html">Strategy Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/plugins/vars.html">Vars Plugins&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html">Filters&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html">Tests&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/plugin_filtering_config.html">Plugin Filter Configuration&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Docs: Plugins(Êèí‰ª∂)</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/plugins%E6%8F%92%E4%BB%B6/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/plugins%E6%8F%92%E4%BB%B6/</guid><description/></item><item><title>Docs: Templates Ê®°Êùø(Jinja2)</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/templates-%E6%A8%A1%E6%9D%BFjinja2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/templates-%E6%A8%A1%E6%9D%BFjinja2/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_templating.html">ÂÆòÊñπÊñáÊ°£,Áî®Êà∑ÊåáÂçó-‰º†ÁªüÁõÆÂΩï-‰ΩøÁî®ÂâßÊú¨-Ê®°Êùø(Jinja2)&lt;/a>&lt;/li>
&lt;li>Êú±ÂèåÂç∞ÂçöÂÆ¢,jinja2 Ê®°Êùø
&lt;ul>
&lt;li>&lt;a href="https://www.zsythink.net/archives/2999">https://www.zsythink.net/archives/2999&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.zsythink.net/archives/3021">https://www.zsythink.net/archives/3021&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.zsythink.net/archives/3037">https://www.zsythink.net/archives/3037&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.zsythink.net/archives/3051">https://www.zsythink.net/archives/3051&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://www.junmajinlong.com/ansible/9_power_of_jinja2/">https://www.junmajinlong.com/ansible/9_power_of_jinja2/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Jinja2 ÁöÑÂÜÖÂÆπËæÉÂ§öÔºå‰ΩÜÂØπ‰∫éÂ≠¶‰π† Ansible Êù•ËØ¥ÔºåÂè™ÈúÄË¶ÅÂ≠¶‰π†ÂÖ∂‰∏≠Âíå template Áõ∏ÂÖ≥ÁöÑ‰∏ÄÈÉ®ÂàÜ (ÂÖ∂ÂÆÉÁöÑÈÉΩÂíåÂºÄÂèëÊúâÂÖ≥Êàñ Ansible ‰∏≠Áî®‰∏ç‰∏ä) ‰ª•Âèä Ansible ÂØπ Jinja2 ÁöÑÊâ©Â±ïÂäüËÉΩÂç≥ÂèØ„ÄÇ
Jinja ËØ≠Ê≥ïËØ¶ËßÅ Python ÁºñÁ®ãËØ≠Ë®ÄÁ´†ËäÇ&lt;/p>
&lt;p>&lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.%E7%BC%96%E7%A8%8B/%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Python/Jinja.md">Jinja&lt;/a>&lt;/p>
&lt;p>Â∞ΩÁÆ°Âú®ÁºñÂÜô playbook Êó∂ÂèØ‰ª•‰∏çÁî®Âú®ÊÑèÊòØÂê¶Ë¶ÅÁî® Jinja2Ôºå‰ΩÜ Ansible ÁöÑËøêË°åÁ¶ª‰∏çÂºÄ Jinja2ÔºåÂΩì Ansible ÂºÄÂßãÊâßË°å playbook Êàñ‰ªªÂä°Êó∂ÔºåÊÄªÊòØ‰ºöÂÖà‰ΩøÁî® Jinja2 ÂéªËß£ÊûêÊâÄÊúâÊåá‰ª§ÁöÑÂÄºÔºåÁÑ∂ÂêéÂÜçÊâßË°å‰ªªÂä°„ÄÇÂè¶‰∏ÄÊñπÈù¢ÔºåÂú®ÁºñÂÜô‰ªªÂä°ÁöÑËøáÁ®ã‰∏≠‰πü‰ºöÁªèÂ∏∏Áî®Âà∞ Jinja2 Êù•ÂÆûÁé∞‰∏Ä‰∫õÈúÄÊ±Ç„ÄÇÊâÄ‰ª•ÔºåJinja2 ÂèØ‰ª•ÈáçË¶ÅÂà∞Êàê‰∏∫ Ansible ÁöÑÂëΩËÑâ„ÄÇ&lt;/p>
&lt;p>‰∏•Ê†ºÂú∞ËØ¥Ôºåplaybook ‰∏≠ÊâÄÊúâÂú∞ÊñπÈÉΩ‰ΩøÁî®‰∫Ü Jinja2ÔºåÂåÖÊã¨Âá†‰πéÊâÄÊúâÊåá‰ª§ÁöÑÂÄº„ÄÅtemplate Ê®°ÊùøÊñá‰ª∂„ÄÅcopy Ê®°ÂùóÁöÑ content Êåá‰ª§ÁöÑÂÄº„ÄÅlookup ÁöÑ template Êèí‰ª∂„ÄÅÁ≠âÁ≠â„ÄÇÂÆÉ‰ª¨‰ºöÂÖàÁªèËøá Jinja2 Ê∏≤ÊüìÔºåÁÑ∂ÂêéÂÜçÊâßË°åÁõ∏ÂÖ≥‰ªªÂä°„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºå‰∏ãÈù¢ÁöÑ playbook ‰∏≠ÂàÜÂà´‰ΩøÁî®‰∫Ü‰∏âÁßç Jinja2 ÁâπÊÆäÁ¨¶Âè∑„ÄÇ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">hosts&lt;/span>: &lt;span style="color:#ae81ff">localhost&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gather_facts&lt;/span>: &lt;span style="color:#66d9ef">no&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tasks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;hello world, {{inventory_hostname}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;hello world{# comment #}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{% if True %}hello world{% endif %}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Ê≥®Ôºöjinja2 ÂéüÁîüÁöÑÂ∏ÉÂ∞îÂÄºÂ∫îÂΩìÊòØÂ∞èÂÜôÁöÑ true Âíå falseÔºå‰ΩÜ‰πüÊîØÊåÅÈ¶ñÂ≠óÊØçÂ§ßÂÜôÂΩ¢ÂºèÁöÑ True Âíå False„ÄÇ&lt;/p>
&lt;/blockquote>
&lt;p>ÊâßË°åÁªìÊûúÔºö&lt;/p>
&lt;pre>&lt;code>TASK [debug] ************************
ok: [localhost] =&amp;gt; {
&amp;quot;msg&amp;quot;: &amp;quot;hello world, localhost&amp;quot;
}
TASK [debug] ************************
ok: [localhost] =&amp;gt; {
&amp;quot;msg&amp;quot;: &amp;quot;hello world&amp;quot;
}
TASK [debug] ************************
ok: [localhost] =&amp;gt; {
&amp;quot;msg&amp;quot;: &amp;quot;hello world&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;p>ÂÜçÊØîÂ¶ÇÊ®°ÊùøÊñá‰ª∂ a.conf.j2 ‰∏≠‰ΩøÁî®Ëøô‰∏âÁßçÁâπÊÆäËØ≠Ê≥ïÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>{&lt;span style="color:#75715e"># Comment this line #}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">variable value&lt;/span>: {{&lt;span style="color:#ae81ff">inventory_hostname}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{&lt;span style="color:#ae81ff">% if True %}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">in if tag code&lt;/span>: {{&lt;span style="color:#ae81ff">inventory_hostname}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{&lt;span style="color:#ae81ff">% endif %}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÂØπÂ∫îÁöÑÊ®°ÊùøÊ∏≤Êüì‰ªªÂä°Ôºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">src&lt;/span>: &lt;span style="color:#ae81ff">a.conf.j2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dest&lt;/span>: &lt;span style="color:#ae81ff">/tmp/a.conf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÊâßË°åÂêéÔºåÂ∞ÜÂú® / tmp/a.conf ‰∏≠ÁîüÊàêÂ¶Ç‰∏ãÂÜÖÂÆπÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">variable value&lt;/span>: &lt;span style="color:#ae81ff">localhost&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">in if tag code&lt;/span>: &lt;span style="color:#ae81ff">localhost&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Êúâ‰∫õÊåá‰ª§ÊØîËæÉÁâπÊÆäÔºåÂÆÉ‰ª¨Â∑≤Áªè‰ΩøÁî®ÈöêÂºèÁöÑ {{}} ËøõË°å‰∫ÜÈ¢ÑÂåÖÂõ¥Ôºå‰æãÂ¶Ç debug Ê®°ÂùóÁöÑ var ÂèÇÊï∞„ÄÅÊù°‰ª∂Âà§Êñ≠&lt;code>when&lt;/code>Êåá‰ª§ÔºåÊâÄ‰ª•ËøôÊó∂Â∞±‰∏çË¶ÅÊâãÂä®‰ΩøÁî® {{}} ÂÜçÂåÖÂõ¥Êåá‰ª§ÁöÑÂÄº„ÄÇ‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">var&lt;/span>: &lt;span style="color:#ae81ff">inventory_hostname&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>‰ΩÜÊúâÊó∂ÂÄô‰πüÁ°ÆÂÆûÊòØÈúÄË¶ÅÂú® var Êàñ when ‰∏≠ÁöÑ‰∏ÄÈÉ®ÂàÜ‰ΩøÁî® {{}} Êù•ÂåÖÂõ¥Ë°®Á§∫ËøôÊòØ‰∏Ä‰∏™ÂèòÈáèÊàñÊòØ‰∏Ä‰∏™Ë°®ËææÂºèÔºåËÄåÈùûÂ≠óÁ¨¶‰∏≤ÁöÑ„ÄÇ‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">var&lt;/span>: &lt;span style="color:#ae81ff">hostvars[&amp;#39;{{php}}&amp;#39;]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">vars&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">php&lt;/span>: &lt;span style="color:#ae81ff">192.168.200.143&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ansible-Êâ©Â±ïÁöÑÊµãËØïÂáΩÊï∞">Ansible Êâ©Â±ïÁöÑÊµãËØïÂáΩÊï∞&lt;/h1>
&lt;p>Ê®°ÊùøÂºïÊìéÊòØÂ§öÂäüËÉΩÁöÑÔºåÂèØ‰ª•Áî®Âú®ÂæàÂ§öÊñπÈù¢ÔºåÊâÄ‰ª• Jinja2 Ëá™Ë∫´ÁΩÆÁöÑÂ§ßÂ§öÊï∞ÂäüËÉΩÈÉΩÊòØÈÄöÁî®ÂäüËÉΩ„ÄÇ‰ΩøÁî® Jinja2 ÁöÑÂ∑•ÂÖ∑ÂèØËÉΩ‰ºöÂØπ Jinja2 ËøõË°åÂäüËÉΩÊâ©Â±ïÔºåÊØîÂ¶Ç Flask Êâ©Â±ï‰∫Ü‰∏Ä‰∫õÂäüËÉΩÔºåAnsible ‰πüÂØπ Jinja2 Êâ©Â±ï‰∫Ü‰∏Ä‰∫õÂäüËÉΩ„ÄÇ&lt;/p>
&lt;p>Ansible Êâ©Â±ïÁöÑÊµãËØïÂáΩÊï∞ÂÆòÊñπÊâãÂÜåÔºö&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html&lt;/a>„ÄÇ&lt;/p>
&lt;h3 id="ÊµãËØïÂ≠óÁ¨¶‰∏≤">ÊµãËØïÂ≠óÁ¨¶‰∏≤&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫Ü‰∏â‰∏™Ê≠£ÂàôÊµãËØïÂáΩÊï∞Ôºö&lt;/p>
&lt;ul>
&lt;li>match()&lt;/li>
&lt;li>search()&lt;/li>
&lt;li>regex()&lt;/li>
&lt;/ul>
&lt;p>ÂÆÉ‰ª¨ÈÉΩËøîÂõûÂ∏ÉÂ∞îÂÄºÔºåÂåπÈÖçÊàêÂäüÊó∂ËøîÂõû true„ÄÇ&lt;/p>
&lt;p>ÂÖ∂‰∏≠Ôºåmatch() Ë¶ÅÊ±Ç‰ªéÂ≠óÁ¨¶‰∏≤ÁöÑÈ¶ñÂ≠óÁ¨¶ÂºÄÂßãÂåπÈÖçÊàêÂäü„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>&amp;quot;hello123world&amp;quot; is match(&amp;quot;\d+&amp;quot;) -&amp;gt; False
&amp;quot;hello123world&amp;quot; is match(&amp;quot;.*\d+&amp;quot;) -&amp;gt; True
&amp;quot;hello123world&amp;quot; is search(&amp;quot;\d+&amp;quot;) -&amp;gt; True
&amp;quot;hello123world&amp;quot; is regex(&amp;quot;\d+&amp;quot;) -&amp;gt; True
&lt;/code>&lt;/pre>
&lt;h3 id="ÁâàÊú¨Âè∑Â§ßÂ∞èÊØîËæÉ">ÁâàÊú¨Âè∑Â§ßÂ∞èÊØîËæÉ&lt;/h3>
&lt;p>Ansible ‰Ωú‰∏∫ÈÖçÁΩÆÊúçÂä°„ÄÅÁ®ãÂ∫èÁöÑÈÖçÁΩÆÁÆ°ÁêÜÂ∑•ÂÖ∑ÔºåÁªèÂ∏∏ÈúÄË¶ÅÊØîËæÉÁâàÊú¨Âè∑ÁöÑÂ§ßÂ∞èÊòØÂê¶Á¨¶ÂêàË¶ÅÊ±Ç„ÄÇAnsible Êèê‰æõ‰∫Ü‰∏Ä‰∏™&lt;code>version&lt;/code>ÊµãËØïÂáΩÊï∞ÂèØ‰ª•Áî®Êù•ÊµãËØïÁâàÊú¨Âè∑ÊòØÂê¶Â§ß‰∫é„ÄÅÂ∞è‰∫é„ÄÅÁ≠â‰∫é„ÄÅ‰∏çÁ≠â‰∫éÁªôÂÆöÁöÑÁâàÊú¨Âè∑„ÄÇ&lt;/p>
&lt;p>ËØ≠Ê≥ïÔºö&lt;/p>
&lt;pre>&lt;code>version('VERSION',CMP)
&lt;/code>&lt;/pre>
&lt;p>ÂÖ∂‰∏≠ CMP ÂèØ‰ª•ÊòØÂ¶Ç‰∏ãÂá†ÁßçÔºö&lt;/p>
&lt;pre>&lt;code>&amp;lt;, lt, &amp;lt;=, le, &amp;gt;, gt, &amp;gt;=, ge, ==, =, eq, !=, &amp;lt;&amp;gt;, ne
&lt;/code>&lt;/pre>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>{{ ansible_facts[&amp;quot;distribution_version&amp;quot;] is version(&amp;quot;7.5&amp;quot;,&amp;quot;&amp;lt;=&amp;quot;) }}
&lt;/code>&lt;/pre>
&lt;p>Âà§Êñ≠Êìç‰ΩúÁ≥ªÁªüÁâàÊú¨Âè∑ÊòØÂê¶Â∞è‰∫éÁ≠â‰∫é 7.5„ÄÇ&lt;/p>
&lt;h3 id="Â≠êÈõÜÁà∂ÈõÜÊµãËØï">Â≠êÈõÜ„ÄÅÁà∂ÈõÜÊµãËØï&lt;/h3>
&lt;ul>
&lt;li>&lt;code>A is subset(B)&lt;/code>ÊµãËØï A ÊòØÂê¶ÊòØ B ÁöÑÂ≠êÈõÜ&lt;/li>
&lt;li>&lt;code>A is superset(B)&lt;/code>ÊµãËØï A ÊòØÂê¶ÊòØ B ÁöÑÁà∂ÈõÜ&lt;/li>
&lt;/ul>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>- debug:
msg: '{{[1,2,3] is subset([1,2,3,4])}}'
&lt;/code>&lt;/pre>
&lt;h3 id="ÊàêÂëòÊµãËØï">ÊàêÂëòÊµãËØï&lt;/h3>
&lt;p>Jinja2 Ëá™Â∑±Êúâ‰∏Ä‰∏™&lt;code>in&lt;/code>Êìç‰ΩúÁ¨¶ÂèØ‰ª•ÂÅöÊàêÂëòÊµãËØïÔºåAnsible Âè¶Â§ñËøòÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ contains ÊµãËØïÂáΩÊï∞Ôºå‰∏ªË¶ÅÁõÆÁöÑÊòØ‰∏∫‰∫ÜÁªìÂêà select„ÄÅreject„ÄÅselectattr Âíå rejectattr Á≠õÈÄâÂô®„ÄÇ&lt;/p>
&lt;p>ÂÆòÊñπÁªô‰∫Ü‰∏Ä‰∏™Á§∫‰æãÔºö&lt;/p>
&lt;pre>&lt;code>vars:
lacp_groups:
- master: lacp0
network: 10.65.100.0/24
gateway: 10.65.100.1
dns4:
- 10.65.100.10
- 10.65.100.11
interfaces:
- em1
- em2
- master: lacp1
network: 10.65.120.0/24
gateway: 10.65.120.1
dns4:
- 10.65.100.10
- 10.65.100.11
interfaces:
- em3
- em4
tasks:
- debug:
msg: &amp;quot;{{ (lacp_groups|selectattr('interfaces', 'contains', 'em1')|first).master }}&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>Ê≠§Â§ñÔºåAnsible ËøòÂÆûÁé∞‰∫Ü&lt;code>all&lt;/code>Âíå&lt;code>any&lt;/code>ÊµãËØïÂáΩÊï∞Ôºå&lt;code>all()&lt;/code>ÊµãËØïË°®Á§∫ÂΩìÂ∫èÂàó‰∏≠ÊâÄÊúâÂÖÉÁ¥†ÈÉΩËøîÂõû true Êó∂Ôºåall() ËøîÂõû trueÔºå&lt;code>any()&lt;/code>ÊµãËØïË°®Á§∫ÂΩìÂ∫èÂàó‰∏≠Âè™Ë¶ÅÊúâÂÖÉÁ¥†ËøîÂõû trueÔºåany() Â∞±ËøîÂõû true„ÄÇ&lt;/p>
&lt;p>‰ªçÁÑ∂ÊòØÂÆòÊñπÁªôÁöÑÁ§∫‰æãÔºö&lt;/p>
&lt;pre>&lt;code> mylist:
- 1
- &amp;quot;{{ 3 == 3 }}&amp;quot;
- True
myotherlist:
- False
- True
tasks:
- debug:
msg: &amp;quot;all are true!&amp;quot;
when: mylist is all
- debug:
msg: &amp;quot;at least one is true&amp;quot;
when: myotherlist is any
&lt;/code>&lt;/pre>
&lt;h3 id="ÊµãËØïÊñá‰ª∂">ÊµãËØïÊñá‰ª∂&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫ÜÊµãËØïÊñá‰ª∂ÁöÑÁõ∏ÂÖ≥ÂáΩÊï∞Ôºö&lt;/p>
&lt;ul>
&lt;li>is existsÔºöÊòØÂê¶Â≠òÂú®&lt;/li>
&lt;li>is directoryÔºöÊòØÂê¶ÊòØÁõÆÂΩï&lt;/li>
&lt;li>is fileÔºöÊòØÂê¶ÊòØÊôÆÈÄöÊñá‰ª∂&lt;/li>
&lt;li>is linkÔºöÊòØÂê¶ÊòØËΩØÈìæÊé•&lt;/li>
&lt;li>is absÔºöÊòØÂê¶ÊòØÁªùÂØπË∑ØÂæÑ&lt;/li>
&lt;li>is same_file(F)ÔºöÊòØÂê¶Âíå F ÊòØÁ°¨ÈìæÊé•ÂÖ≥Á≥ª&lt;/li>
&lt;li>is mountÔºöÊòØÂê¶ÊòØÊåÇËΩΩÁÇπ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;path is a directory&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">mypath is directory&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;path is {{ (mypath is abs)|ternary(&amp;#39;absolute&amp;#39;,&amp;#39;relative&amp;#39;)}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;path is the same file as path2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">mypath is same_file(path2)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;path is a mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">mypath is mount&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ÊµãËØï‰ªªÂä°ÁöÑÊâßË°åÁä∂ÊÄÅ">ÊµãËØï‰ªªÂä°ÁöÑÊâßË°åÁä∂ÊÄÅ&lt;/h3>
&lt;p>ÊØè‰∏™‰ªªÂä°ÁöÑÊâßË°åÁªìÊûúÈÉΩÊúâ 4 ÁßçÁä∂ÊÄÅÔºöÊàêÂäü„ÄÅÂ§±Ë¥•„ÄÅchanged„ÄÅË∑≥Ëøá„ÄÇ&lt;/p>
&lt;p>Ansible Êèê‰æõ‰∫ÜÁõ∏ÂÖ≥ÁöÑÊµãËØïÂáΩÊï∞Ôºö&lt;/p>
&lt;ul>
&lt;li>succeeded„ÄÅsuccess&lt;/li>
&lt;li>failed„ÄÅfailure&lt;/li>
&lt;li>changed„ÄÅchange&lt;/li>
&lt;li>skipped„ÄÅskip&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">shell&lt;/span>: &lt;span style="color:#ae81ff">/usr/bin/foo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">register&lt;/span>: &lt;span style="color:#ae81ff">result&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ignore_errors&lt;/span>: &lt;span style="color:#66d9ef">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;it failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">result is failed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;it changed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">result is changed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;it succeeded in Ansible &amp;gt;= 2.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">result is succeeded&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;it succeeded&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">result is success&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;it was skipped&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">when&lt;/span>: &lt;span style="color:#ae81ff">result is skipped&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="ansible-Êâ©Â±ïÁöÑ-filter">Ansible Êâ©Â±ïÁöÑ Filter&lt;/h1>
&lt;p>Ansible Êâ©Â±ï‰∫ÜÈùûÂ∏∏Â§öÁöÑ FilterÔºåÈùûÂ∏∏ÈùûÂ∏∏Â§öÔºåÊú¨Êù•ÊàëÂè™ÊÉ≥‰ªãÁªç‰∏ÄÈÉ®ÂàÜ„ÄÇ‰ΩÜÊòØÊÉ≥Âà∞Êúâ‰∫õ‰∫∫‰∏çÊÑøÁúãËã±ÊñáÔºåÊàëËøòÊòØÂ∞ÜÂÆÉ‰ª¨ÂÖ®ÈÉΩÂÜôÂá∫Êù•ÔºåÂêÑ‰ΩçÊùÉÂΩìÁúã‰∏≠ÊñáÊâãÂÜåÂ•Ω‰∫Ü„ÄÇÂÆûÈôÖ‰∏äÂÆÉ‰ª¨‰πüÈÉΩÈùûÂ∏∏ÂÆπÊòìÔºåÁªùÂ§ßÂ§öÊï∞Á≠õÈÄâÂô®Áî®Ê≥ïÂá†‰πéÈÉΩ‰∏çÁî®Âä®ËÑëÔºå‰∏ÄÁúã‰æøÊáÇ„ÄÇ&lt;/p>
&lt;h3 id="Á±ªÂûãËΩ¨Êç¢Á±ªÁ≠õÈÄâÂô®">Á±ªÂûãËΩ¨Êç¢Á±ªÁ≠õÈÄâÂô®&lt;/h3>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>{{&amp;quot;123&amp;quot;|int}}
{{&amp;quot;123&amp;quot;|float}}
{{123|string}}
{{range(1,6)|list}}
{{123|bool}}
&lt;/code>&lt;/pre>
&lt;p>Ê≥®ÊÑèÔºåÊ≤°Êúâ dict Á≠õÈÄâÂô®ËΩ¨Êç¢ÊàêÂ≠óÂÖ∏Á±ªÂûã„ÄÇ&lt;/p>
&lt;h3 id="Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥ÁÇπ">Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥ÁÇπ&lt;/h3>
&lt;p>Ansible Êèê‰æõÁöÑ now() ÂèØ‰ª•Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥ÁÇπ„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{now()}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÂæóÂà∞ÁªìÊûúÔºö&lt;/p>
&lt;pre>&lt;code>ok: [localhost] =&amp;gt; {
&amp;quot;msg&amp;quot;: &amp;quot;2020-01-25 00:27:17.563627&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;p>ÂèØ‰ª•ÊåáÂÆöËæìÂá∫ÁöÑÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÔºåÊîØÊåÅÁöÑÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÂèÇËÄÉ python ÂÆòÊñπÊâãÂÜåÔºö&lt;a href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior">https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior&lt;/a>„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;{{now().strftime(&amp;#34;%Y-%m-%d %H:%M:%S.%f&amp;#34;)}}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="yamljson-Ê†ºÂºèÂåñ">YAML„ÄÅJSON Ê†ºÂºèÂåñ&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫ÜÂá†‰∏™Âíå YAML„ÄÅJSON Ê†ºÂºèÂåñÁõ∏ÂÖ≥ÁöÑ FilterÔºö&lt;/p>
&lt;pre>&lt;code>to_yaml
to_json
to_nice_yaml
to_nice_json
&lt;/code>&lt;/pre>
&lt;p>ÂÆÉ‰ª¨ÈÉΩÂèØ‰ΩøÁî® indent ÂèÇÊï∞ÊåáÂÆöÁº©ËøõÁöÑÂ±ÇÊ¨°„ÄÇ&lt;/p>
&lt;p>&lt;code>to_yaml&lt;/code>Âíå&lt;code>to_json&lt;/code>ÈÄÇÁî®‰∫éË∞ÉËØïÔºå&lt;code>to_nice_yaml&lt;/code>Âíå&lt;code>to_nice_json&lt;/code>ÈÄÇÁî®‰∫éÁî®Êà∑Êü•Áúã„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>- debug:
msg: '{{f1|to_nice_json(indent=2)}}'
vars:
f1:
father: &amp;quot;Bob&amp;quot;
mother: &amp;quot;Alice&amp;quot;
Children:
- Judy
- Tedy
&lt;/code>&lt;/pre>
&lt;h3 id="ÂèÇÊï∞ÂøΩÁï•">ÂèÇÊï∞ÂøΩÁï•&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÁâπÊÆäÂèòÈáè omitÔºåÂèØ‰ª•Áî®Êù•ÂøΩÁï•Ê®°ÂùóÁöÑÂèÇÊï∞ÊïàÊûú„ÄÇ&lt;/p>
&lt;p>ÂÆòÊñπÊâãÂÜåÁªô‰∫Ü‰∏Ä‰∏™ÈùûÂ∏∏Êúâ‰ª£Ë°®ÊÄßÁöÑÁ§∫‰æãÔºåÂ¶Ç‰∏ãÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">touch files with an optional mode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">file&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dest&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ item.path }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">state&lt;/span>: &lt;span style="color:#ae81ff">touch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mode&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ item.mode | default(omit) }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">loop&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">path&lt;/span>: &lt;span style="color:#ae81ff">/tmp/foo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">path&lt;/span>: &lt;span style="color:#ae81ff">/tmp/bar&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">path&lt;/span>: &lt;span style="color:#ae81ff">/tmp/baz&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mode&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;0444&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÂΩìÊâÄËø≠‰ª£ÁöÑÂÖÉÁ¥†‰∏≠‰∏çÂ≠òÂú® mode È°πÔºåÂàô‰ΩøÁî®ÈªòËÆ§ÂÄºÔºåÈªòËÆ§ÂÄºËÆæÁΩÆ‰∏∫ÁâπÊÆäÂèòÈáè omitÔºå‰ΩøÂæó file Ê®°ÂùóÁöÑ mode ÂèÇÊï∞Ë¢´ÂøΩÁï•ÔºåÁõ∏ÂΩì‰∫éÊú™‰π¶ÂÜôËØ•ÂèÇÊï∞„ÄÇÂè™ÊúâÁªôÂÆö‰∫Ü mode È°πÊó∂Ôºåmode ÂèÇÊï∞ÊâçÁîüÊïà„ÄÇ&lt;/p>
&lt;h3 id="ÂàóË°®ÂÖÉÁ¥†ËøûÊé•">ÂàóË°®ÂÖÉÁ¥†ËøûÊé•&lt;/h3>
&lt;p>&lt;code>join&lt;/code>ÂèØ‰ª•Â∞ÜÂàóË°®ÂêÑ‰∏™ÂÖÉÁ¥†Ê†πÊçÆÊåáÂÆöÁöÑËøûÊé•Á¨¶ËøûÊé•Ëµ∑Êù•Ôºö&lt;/p>
&lt;pre>&lt;code>{{ [1,2,3] | join(&amp;quot;-&amp;quot;) }}
&lt;/code>&lt;/pre>
&lt;h3 id="ÂàóË°®ÂéãÂπ≥">ÂàóË°®ÂéãÂπ≥&lt;/h3>
&lt;p>ÂâçÈù¢ÁöÑÊñáÁ´†Êõæ‰ªãÁªçËøá flatten Á≠õÈÄâÂô®ÔºåÂÆÉÂèØ‰ª•Â∞ÜÂµåÂ•óÂàóË°®ÂéãÂπ≥„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ [3, [4, 2] ] | flatten }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ [3, [4, [2]] ] | flatten(levels=1) }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="Âπ∂ÈõÜ‰∫§ÈõÜÂ∑ÆÈõÜ">Âπ∂ÈõÜ„ÄÅ‰∫§ÈõÜ„ÄÅÂ∑ÆÈõÜ&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫ÜÈõÜÂêàÁêÜËÆ∫Á±ªÁöÑÊ±ÇÂÄºÊìç‰ΩúÔºö&lt;/p>
&lt;ul>
&lt;li>uniqueÔºöÂéªÈáç&lt;/li>
&lt;li>unionÔºöÂπ∂ÈõÜÔºåÂç≥‰∏§‰∏™ÈõÜÂêà‰∏≠ÊâÄÊúâÂÖÉÁ¥†&lt;/li>
&lt;li>intersectÔºö‰∫§ÈõÜÔºåÂç≥‰∏§‰∏™ÈõÜÂêà‰∏≠ÈÉΩÂ≠òÂú®ÁöÑÂÖÉÁ¥†&lt;/li>
&lt;li>differenceÔºöÂ∑ÆÈõÜÔºåÂç≥ËøîÂõûÂè™Âú®Á¨¨‰∏Ä‰∏™ÈõÜÂêà‰∏≠Ôºå‰∏çÂú®Á¨¨‰∫å‰∏™ÈõÜÂêà‰∏≠ÁöÑÂÖÉÁ¥†&lt;/li>
&lt;li>symmetric_differenceÔºöÂØπÁß∞Â∑ÆÈõÜÔºåÂç≥ËøîÂõû‰∏§‰∏™ÈõÜÂêà‰∏≠‰∏çÈáçÂ§çÁöÑÂÖÉÁ¥†&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;pre>&lt;code>- name: return [1,2,3]
debug:
msg: &amp;quot;{{ [1,2,3,2,1] | unique }}&amp;quot;
- name: return [1,2,3,4]
debug:
msg: &amp;quot;{{ [1,2,3] | union([2,3,4]) }}&amp;quot;
- name: return [2,3]
debug:
msg: &amp;quot;{{ [1,2,3] | intersect([2,3,4]) }}&amp;quot;
- name: return [1]
debug:
msg: &amp;quot;{{ [1,2,3] | difference([2,3,4]) }}&amp;quot;
- name: return [1,4]
debug:
msg: &amp;quot;{{ [1,2,3] | symmetric_difference([2,3,4]) }}&amp;quot;
&lt;/code>&lt;/pre>
&lt;h3 id="dict-Âíå-list-ËΩ¨Êç¢">dict Âíå list ËΩ¨Êç¢&lt;/h3>
&lt;ul>
&lt;li>&lt;code>dict2items()&lt;/code>ÔºöÂ∞ÜÂ≠óÂÖ∏ËΩ¨Êç¢‰∏∫ÂàóË°®&lt;/li>
&lt;li>&lt;code>items2dict()&lt;/code>ÔºöÂ∞ÜÂàóË°®ËΩ¨Êç¢‰∏∫Â≠óÂÖ∏&lt;/li>
&lt;/ul>
&lt;p>ÂØπ‰∫é&lt;code>dict2items&lt;/code>Ôºå‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>- debug:
msg: &amp;quot;{{ p | dict2items }}&amp;quot;
vars:
p:
name: junmajinlong
age: 28
&lt;/code>&lt;/pre>
&lt;p>ÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>[
{
&amp;quot;key&amp;quot;: &amp;quot;name&amp;quot;,
&amp;quot;value&amp;quot;: &amp;quot;junmajinlong&amp;quot;
},
{
&amp;quot;key&amp;quot;: &amp;quot;age&amp;quot;,
&amp;quot;value&amp;quot;: 28
}
]
&lt;/code>&lt;/pre>
&lt;p>ÂØπ‰∫é&lt;code>items2dict&lt;/code>Ôºå‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>- debug:
msg: &amp;quot;{{ p | items2dict }}&amp;quot;
vars:
p:
- key: name
value: junmajinlong
- key: age
value: 28
&lt;/code>&lt;/pre>
&lt;p>ÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>{
&amp;quot;age&amp;quot;: 28,
&amp;quot;name&amp;quot;: &amp;quot;junmajinlong&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºå&lt;code>dict2items&lt;/code>Âíå&lt;code>items2dict&lt;/code>ÈÉΩ‰ΩøÁî®&lt;code>key&lt;/code>Âíå&lt;code>value&lt;/code>Êù•ËΩ¨Êç¢Ôºå‰ΩÜÂÆÉ‰ª¨ÈÉΩÂÖÅËÆ∏‰ΩøÁî®&lt;code>key_name&lt;/code>Âíå&lt;code>value_name&lt;/code>Ëá™ÂÆö‰πâËΩ¨Êç¢ÁöÑÂêçÁß∞„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ files | dict2items(key_name=&amp;#39;file&amp;#39;, value_name=&amp;#39;path&amp;#39;) }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">vars&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">files&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">users&lt;/span>: &lt;span style="color:#ae81ff">/etc/passwd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">groups&lt;/span>: &lt;span style="color:#ae81ff">/etc/group&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>[
{
&amp;quot;file&amp;quot;: &amp;quot;users&amp;quot;,
&amp;quot;path&amp;quot;: &amp;quot;/etc/passwd&amp;quot;
},
{
&amp;quot;file&amp;quot;: &amp;quot;groups&amp;quot;,
&amp;quot;path&amp;quot;: &amp;quot;/etc/group&amp;quot;
}
]
&lt;/code>&lt;/pre>
&lt;h3 id="zip-Âíå-zip_longest">zip Âíå zip_longest&lt;/h3>
&lt;p>&lt;code>zip&lt;/code>Âíå&lt;code>zip_longest&lt;/code>ÂèØ‰ª•Â∞ÜÂ§ö‰∏™ÂàóË°®ÁöÑÂÖÉÁ¥†‰∏Ä‰∏ÄÂØπÂ∫îÂπ∂ÁªÑÂêàËµ∑Êù•„ÄÇÂÆÉ‰ª¨ÁöÑÂå∫Âà´ÊòØÔºåzip ‰ª•Áü≠Â∫èÂàó‰∏∫‰∏ªÔºå&lt;code>zip_longest&lt;/code>‰ª•ÊúÄÈïøÂ∫èÂàó‰∏∫‰∏ªÔºåÁº∫Â§±ÁöÑÈÉ®ÂàÜ‰ΩøÁî® null Â°´ÂÖÖ„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">return [[1,&amp;#34;a&amp;#34;], [2,&amp;#34;b&amp;#34;]]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ [1,2] | zip([&amp;#39;a&amp;#39;,&amp;#39;b&amp;#39;]) | list }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">return [[1,&amp;#34;a&amp;#34;], [2,&amp;#34;b&amp;#34;]]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ [1,2] | zip([&amp;#39;a&amp;#39;,&amp;#39;b&amp;#39;,&amp;#39;c&amp;#39;]) | list }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">return [[1,&amp;#34;a&amp;#34;], [2,&amp;#34;b&amp;#34;], [null, &amp;#34;c&amp;#34;]]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ [1,2] | zip_longest([&amp;#39;a&amp;#39;,&amp;#39;b&amp;#39;,&amp;#39;c&amp;#39;]) | list }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">return [[1,&amp;#34;a&amp;#34;,&amp;#34;aa&amp;#34;], [2,&amp;#34;b&amp;#34;,&amp;#34;bb&amp;#34;]]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;{{ [1,2] | zip([&amp;#39;a&amp;#39;,&amp;#39;b&amp;#39;], [&amp;#39;aa&amp;#39;,&amp;#39;bb&amp;#39;]) | list }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Âú® Python ‰∏≠ÁªèÂ∏∏‰ºöÂ∞Ü zip ÁöÑËøêÁÆóÁªìÊûú‰ΩøÁî® dict() ÊûÑÈÄ†ÊàêÂ≠óÂÖ∏ÔºåJinja2 ‰∏≠‰πüÂèØ‰ª•Ôºö&lt;/p>
&lt;pre>&lt;code>- name: !unsafe 'return {&amp;quot;a&amp;quot;: 1, &amp;quot;b&amp;quot;: 2}'
debug:
msg: &amp;quot;{{ dict(['a','b'] | zip([1,2])) }}&amp;quot;
&lt;/code>&lt;/pre>
&lt;h3 id="Â≠êÂÖÉÁ¥†-subelements">Â≠êÂÖÉÁ¥† subelements&lt;/h3>
&lt;p>subelements Á≠õÈÄâÂô®Âú®Ââç‰∏ÄÁ´†ËäÇËØ¶ÁªÜËß£ÈáäËøáÔºåËøôÈáå‰∏çÂÜç‰ªãÁªç„ÄÇ&lt;/p>
&lt;h3 id="random-ÁîüÊàêÈöèÊú∫Êï∞">random ÁîüÊàêÈöèÊú∫Êï∞&lt;/h3>
&lt;p>Jinja2 Ëá™Ë∫´ÂÜÖÁΩÆ‰∫Ü‰∏Ä‰∏™ random Á≠õÈÄâÂô®ÔºåAnsible ‰πüÊúâ‰∏Ä‰∏™ random Á≠õÈÄâÂô®ÔºåÊØî Jinja2 ÂÜÖÁΩÆÁöÑÂÆöÂà∂ÊÄßË¶ÅÊõ¥Âº∫‰∏ÄÁÇπ„ÄÇ&lt;/p>
&lt;pre>&lt;code>&amp;quot;{{ ['a','b','c'] | random }}&amp;quot;
# =&amp;gt; 'c'
# ÁîüÊàê[0,60)ÁöÑÈöèÊú∫Êï∞
&amp;quot;{{ 60 | random }} * * * * root /script/from/cron&amp;quot;
# =&amp;gt; '21 * * * * root /script/from/cron'
# ÁîüÊàê[0,100)ÁöÑÈöèÊú∫Êï∞ÔºåÊ≠•Ëøõ‰∏∫10
{{ 101 | random(step=10) }}
# =&amp;gt; 70
# ÁîüÊàê[1,100)ÁöÑÈöèÊú∫Êï∞ÔºåÊ≠•Ëøõ‰∏∫10
{{ 101 | random(1, 10) }}
# =&amp;gt; 31
{{ 101 | random(start=1, step=10) }}
# =&amp;gt; 51
# ÊåáÂÆöÈöèÊú∫Êï∞ÁßçÂ≠ê„ÄÇ
# ‰∏ãÈù¢ÊåáÂÆö‰∏∫‰∏ªÊú∫ÂêçÔºåÊâÄ‰ª•Âêå‰∏ªÊú∫ÁîüÊàêÁöÑÈöèÊú∫Êï∞Áõ∏ÂêåÔºå‰ΩÜ‰∏çÂêå‰∏ªÊú∫ÁöÑÈöèÊú∫Êï∞‰∏çÂêå
&amp;quot;{{ 60 | random(seed=inventory_hostname) }} * * * * root /script/from/cron&amp;quot;
&lt;/code>&lt;/pre>
&lt;h3 id="shuffle-Êâì‰π±È°∫Â∫è">shuffle Êâì‰π±È°∫Â∫è&lt;/h3>
&lt;h3 id="imagepnghttpsnotes-learningoss-cn-beijingaliyuncscomlmdoi21638717920341-716b62fb-5d66-43db-a26d-9a14afaa42fapng">&lt;img src="https://notes-learning.oss-cn-beijing.aliyuncs.com/lmdoi2/1638717920341-716b62fb-5d66-43db-a26d-9a14afaa42fa.png" alt="image.png">&lt;/h3>
&lt;h3 id="json_query">json_query&lt;/h3>
&lt;p>ÂèØÊü•ËØ¢ Json Ê†ºÂºèÁöÑÊï∞ÊçÆÔºå&lt;code>json_query&lt;/code>Âú® Ansible ‰∏≠ÈùûÂ∏∏ÂÆûÁî®ÔºåÊòØÂøÖÂ≠¶ Filter ‰πã‰∏Ä„ÄÇ&lt;/p>
&lt;p>Ansible ÁöÑ&lt;code>json_query&lt;/code>Âü∫‰∫é jmespathÔºåÊâÄ‰ª•ÈúÄË¶ÅÂÖàÂÆâË£Ö jmespathÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ pip3 install jmespath
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>jmespath ÁöÑÊü•ËØ¢ËØ≠Ê≥ïÁõ∏ÂÖ≥Á§∫‰æãÂèØÂèÇËßÅÂÖ∂ÂÆòÊñπÊâãÂÜåÔºö&lt;/p>
&lt;ul>
&lt;li>ÂÖ•Èó®ÊâãÂÜåÔºö &lt;a href="http://jmespath.org/tutorial.html">http://jmespath.org/tutorial.html&lt;/a>&lt;/li>
&lt;li>Á§∫‰æãÔºö&lt;a href="http://jmespath.org/examples.html">http://jmespath.org/examples.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>‰∏ãÈù¢ÊàëÂàóÂá∫ Ansible ‰∏≠ÁªôÂá∫ÁöÑÁ§∫‰æã„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºåÂØπ‰∫é‰∏ãÈù¢ÁöÑÊï∞ÊçÆÁªìÊûÑÔºö&lt;/p>
&lt;pre>&lt;code>{
&amp;quot;domain_definition&amp;quot;: {
&amp;quot;domain&amp;quot;: {
&amp;quot;cluster&amp;quot;: [
{&amp;quot;name&amp;quot;: &amp;quot;cluster1&amp;quot;},
{&amp;quot;name&amp;quot;: &amp;quot;cluster2&amp;quot;}
],
&amp;quot;server&amp;quot;: [
{
&amp;quot;name&amp;quot;: &amp;quot;server11&amp;quot;,
&amp;quot;cluster&amp;quot;: &amp;quot;cluster1&amp;quot;,
&amp;quot;port&amp;quot;: &amp;quot;8080&amp;quot;
},
{
&amp;quot;name&amp;quot;: &amp;quot;server12&amp;quot;,
&amp;quot;cluster&amp;quot;: &amp;quot;cluster1&amp;quot;,
&amp;quot;port&amp;quot;: &amp;quot;8090&amp;quot;
},
{
&amp;quot;name&amp;quot;: &amp;quot;server21&amp;quot;,
&amp;quot;cluster&amp;quot;: &amp;quot;cluster2&amp;quot;,
&amp;quot;port&amp;quot;: &amp;quot;9080&amp;quot;
},
{
&amp;quot;name&amp;quot;: &amp;quot;server22&amp;quot;,
&amp;quot;cluster&amp;quot;: &amp;quot;cluster2&amp;quot;,
&amp;quot;port&amp;quot;: &amp;quot;9090&amp;quot;
}
],
&amp;quot;library&amp;quot;: [
{
&amp;quot;name&amp;quot;: &amp;quot;lib1&amp;quot;,
&amp;quot;target&amp;quot;: &amp;quot;cluster1&amp;quot;
},
{
&amp;quot;name&amp;quot;: &amp;quot;lib2&amp;quot;,
&amp;quot;target&amp;quot;: &amp;quot;cluster2&amp;quot;
}
]
}
}
}
&lt;/code>&lt;/pre>
&lt;p>‰ΩøÁî®&lt;/p>
&lt;pre>&lt;code>{{ domain_definition | json_query('domain.cluster[*].name') }}
&lt;/code>&lt;/pre>
&lt;p>ÂèØ‰ª•Ëé∑ÂèñÂà∞ÂêçÁß∞ cluster1 Âíå cluster2„ÄÇ&lt;/p>
&lt;p>‰ΩøÁî®&lt;/p>
&lt;pre>&lt;code>{{ domain_definition | json_query('domain.server[*].name') }}
&lt;/code>&lt;/pre>
&lt;p>ÂèØ‰ª•Ëé∑ÂèñÂà∞ server11„ÄÅserver12„ÄÅserver21 Âíå server22„ÄÇ&lt;/p>
&lt;p>‰ΩøÁî®&lt;/p>
&lt;pre>&lt;code>- debug:
var: item
loop: &amp;quot;{{ domain_definition | json_query(server_name_cluster1_query) }}&amp;quot;
vars:
server_name_cluster1_query: &amp;quot;domain.server[?cluster=='cluster1'].port&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>ÂèØ‰ª•Ëø≠‰ª£ 8080 Âíå 8090 ‰∏§‰∏™Á´ØÂè£„ÄÇ&lt;/p>
&lt;p>Ê≥®ÊÑè‰∏äÈù¢‰ΩøÁî®‰∫ÜÈóÆÂè∑&lt;code>?&lt;/code>ÔºåËøôË°®Á§∫ÂêéÈù¢ÁöÑÊòØ‰∏Ä‰∏™Ë°®ËææÂºè„ÄÇ&lt;/p>
&lt;p>‰ΩøÁî®&lt;/p>
&lt;pre>&lt;code>&amp;quot;{{domain_definition | json_query('domain.server[?cluster==`cluster2`].{name1: name, port1: port}')}}&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>ÂèØÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>[
{
&amp;quot;name1&amp;quot;: &amp;quot;server21&amp;quot;,
&amp;quot;port1&amp;quot;: &amp;quot;9080&amp;quot;
},
{
&amp;quot;name1&amp;quot;: &amp;quot;server22&amp;quot;,
&amp;quot;port1&amp;quot;: &amp;quot;9090&amp;quot;
}
]
&lt;/code>&lt;/pre>
&lt;p>Ê≥®ÊÑè‰∏äÈù¢‰ΩøÁî®‰∫ÜÂèçÂºïÂè∑&lt;code> &lt;/code>ËÄå‰∏çÊòØÂçïÂèåÂºïÂè∑ÔºåÂõ†‰∏∫ÂçïÂèåÂºïÂè∑ÈÉΩË¢´‰ΩøÁî®Ëøá‰∫ÜÔºåÂÜç‰ΩøÁî®Â∞±‰∏çÊñπ‰æøÔºåÂèØËØªÊÄß‰πüÂ∑Æ„ÄÇ&lt;/p>
&lt;h3 id="ip-Âú∞ÂùÄÁ≠õÈÄâ">ip Âú∞ÂùÄÁ≠õÈÄâ&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫ÜÈùûÂ∏∏‰∏∞ÂØåÁöÑÂäüËÉΩÊù•ÂÆåÊàê IP Âú∞ÂùÄÁöÑÁ≠õÈÄâÔºåÁî®Ê≥ïÈùûÂ∏∏Â§öÔºåÁªùÂ§ßÂ§öÊï∞ÂÖ≥‰∫é IP„ÄÅÁΩëÁªúÂú∞ÂùÄÁ±ªÁöÑËÆ°ÁÆó„ÄÅÊü•ËØ¢ÈúÄÊ±ÇÈÉΩËÉΩËß£ÂÜ≥„ÄÇ&lt;/p>
&lt;p>‰ΩøÁî®ÂÆÉÈúÄË¶ÅÂÖàÂÆâË£Ö python ÁöÑ netaddr ÂåÖÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ pip3 install netaddr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÂÆåÊï¥Áî®Ê≥ïÂèÇËÄÉÂÆòÊñπÊâãÂÜåÔºö&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters_ipaddr.html#playbooks-filters-ipaddr">https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters_ipaddr.html#playbooks-filters-ipaddr&lt;/a>„ÄÇ&lt;/p>
&lt;p>‰∏ãÈù¢ÊòØÊàëÊï¥ÁêÜÁöÑ‰∏ÄÈÉ®ÂàÜÁî®Ê≥ï„ÄÇ&lt;/p>
&lt;p>Ê£ÄÊµãÊòØÂê¶ÊòØÂêàÁêÜÁöÑ IP Âú∞ÂùÄÔºö&lt;/p>
&lt;pre>&lt;code>{{ myvar | ipaddr }}
&lt;/code>&lt;/pre>
&lt;p>Ê£ÄÊµãÊòØÂê¶ÊòØÂêàÁêÜÁöÑ ipv4 Âú∞ÂùÄ„ÄÅipv6 Âú∞ÂùÄÔºö&lt;/p>
&lt;pre>&lt;code>{{ myvar | ipv4 }}
{{ myvar | ipv6 }}
&lt;/code>&lt;/pre>
&lt;p>‰ªéÂàóË°®‰∏≠Á≠õÈÄâÂá∫ÂêàÁêÜÁöÑ IP Âú∞ÂùÄÔºö&lt;/p>
&lt;pre>&lt;code>test_list = ['192.24.2.1', 'host.fqdn', '::1', '192.168.32.0/24', 'fe80::100/10', True, '']
# {{ test_list | ipaddr }}
['192.24.2.1', '::1', '192.168.32.0/24', 'fe80::100/10']
# {{ test_list | ipv4 }}
['192.24.2.1', '192.168.32.0/24']
# {{ test_list | ipv6 }}
['::1', 'fe80::100/10']
&lt;/code>&lt;/pre>
&lt;p>Ëé∑Âèñ IP Âú∞ÂùÄÈÉ®ÂàÜÔºö&lt;/p>
&lt;pre>&lt;code>{{ '192.0.2.1/24' | ipaddr('address') }}
{{ ipvar | ipv4('address') }}
{{ ipvar | ipv6('address') }}
&lt;/code>&lt;/pre>
&lt;p>Ê£ÄÊµãÊàñÊâæÂá∫ÂÖ¨ÁΩë IP ÂíåÁßÅÁΩë IPÔºö&lt;/p>
&lt;pre>&lt;code># {{ test_list | ipaddr('public') }}
['192.24.2.1']
# {{ test_list | ipaddr('private') }}
['192.168.32.0/24', 'fe80::100/10']
&lt;/code>&lt;/pre>
&lt;h3 id="Ê≠£ÂàôË°®ËææÂºèÁ≠õÈÄâÂô®">Ê≠£ÂàôË°®ËææÂºèÁ≠õÈÄâÂô®&lt;/h3>
&lt;p>Ansible Êèê‰æõ‰∫ÜÂá†‰∏™Ê≠£ÂàôÁ±ªÁöÑ FilterÔºå‰∏ªË¶ÅÊúâÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;code>regex_search&lt;/code>ÔºöÊôÆÈÄöÊ≠£ÂàôÂåπÈÖç&lt;/li>
&lt;li>&lt;code>regex_findall&lt;/code>ÔºöÂÖ®Â±ÄÂåπÈÖç&lt;/li>
&lt;li>&lt;code>regex_replace&lt;/code>ÔºöÊ≠£ÂàôÊõøÊç¢&lt;/li>
&lt;/ul>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>{{ 'foobar' | regex_search('(foo)') }}
# ÂåπÈÖçÂ§±Ë¥•Êó∂ËøîÂõûÁ©∫
{{ 'ansible' | regex_search('(foobar)') }}
# Â§öË°åÊ®°Âºè„ÄÅÂøΩÁï•Â§ßÂ∞èÂÜôÁöÑÂåπÈÖç
{{ 'foo\nBAR' | regex_search(&amp;quot;^bar&amp;quot;, multiline=True, ignorecase=True) }}
# ÂÖ®Â±ÄÂåπÈÖç
# ÊØèÊ¨°ÂåπÈÖçÂà∞ÁöÑÂÜÖÂÆπÂ∞ÜÂ≠òÊîæÂú®‰∏Ä‰∏™ÂàóË°®‰∏≠
{{ 'DNS servers 8.8.8.8 and 8.8.4.4' | regex_findall('\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b') }}
# Ê≠£ÂàôÊõøÊç¢
# &amp;quot;ansible&amp;quot; ÊõøÊç¢‰∏∫ &amp;quot;able&amp;quot;
{{ 'ansible' | regex_replace('^a.*i(.*)$', 'a\\1') }}
# &amp;quot;foobar&amp;quot; ÊõøÊç¢‰∏∫ &amp;quot;bar&amp;quot;
{{ 'foobar' | regex_replace('^f.*o(.*)$', '\\1') }}
# ‰ΩøÁî®ÂëΩÂêçÊçïËé∑Ôºå&amp;quot;localhost:80&amp;quot; ÊõøÊç¢‰∏∫ &amp;quot;localhost, 80&amp;quot;
{{ 'localhost:80' | regex_replace('^(?P&amp;lt;host&amp;gt;.+):(?P&amp;lt;port&amp;gt;\\d+)$', '\\g&amp;lt;host&amp;gt;, \\g&amp;lt;port&amp;gt;') }}
# &amp;quot;localhost:80&amp;quot; ÊõøÊç¢‰∏∫ &amp;quot;localhost&amp;quot;
{{ 'localhost:80' | regex_replace(':80') }}
&lt;/code>&lt;/pre>
&lt;h3 id="url-Â§ÑÁêÜÁ≠õÈÄâÂô®">URL Â§ÑÁêÜÁ≠õÈÄâÂô®&lt;/h3>
&lt;p>&lt;code>urlsplit&lt;/code>Á≠õÈÄâÂô®ÂèØ‰ª•‰ªé‰∏Ä‰∏™ URL ‰∏≠ÊèêÂèñ fragment„ÄÅhostname„ÄÅnetloc„ÄÅpassword„ÄÅpath„ÄÅport„ÄÅquery„ÄÅscheme„ÄÅ‰ª•Âèä username„ÄÇÂ¶ÇÊûú‰∏ç‰º†ÈÄí‰ªª‰ΩïÂèÇÊï∞ÔºåÂàôÁõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂåÖÂê´‰∫ÜÊâÄÊúâÂ≠óÊÆµÁöÑÂ≠óÂÖ∏„ÄÇ&lt;/p>
&lt;pre>&lt;code>{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('hostname') }}
# =&amp;gt; 'www.acme.com'
{{ &amp;quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('netloc') }}
# =&amp;gt; 'user:passwd@www.acme.com:9000'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('username') }}
# =&amp;gt; 'user'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('password') }}
# =&amp;gt; 'passwd'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('path') }}
# =&amp;gt; '/dir/index.html'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('port') }}
# =&amp;gt; '9000'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('scheme') }}
# =&amp;gt; 'http'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('query') }}
# =&amp;gt; 'query=term'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit('fragment') }}
# =&amp;gt; 'fragment'
{{ &amp;quot;http://user:passwd@www.acme.com:9000/dir/index.html?query=term#fragment&amp;quot; | urlsplit }}
# =&amp;gt;
# {
# &amp;quot;fragment&amp;quot;: &amp;quot;fragment&amp;quot;,
# &amp;quot;hostname&amp;quot;: &amp;quot;www.acme.com&amp;quot;,
# &amp;quot;netloc&amp;quot;: &amp;quot;user:password@www.acme.com:9000&amp;quot;,
# &amp;quot;password&amp;quot;: &amp;quot;passwd&amp;quot;,
# &amp;quot;path&amp;quot;: &amp;quot;/dir/index.html&amp;quot;,
# &amp;quot;port&amp;quot;: 9000,
# &amp;quot;query&amp;quot;: &amp;quot;query=term&amp;quot;,
# &amp;quot;scheme&amp;quot;: &amp;quot;http&amp;quot;,
# &amp;quot;username&amp;quot;: &amp;quot;user&amp;quot;
# }
&lt;/code>&lt;/pre>
&lt;h3 id="ÁºñÂÜôÊ≥®ÈáäÁöÑÁ≠õÈÄâÂô®">ÁºñÂÜôÊ≥®ÈáäÁöÑÁ≠õÈÄâÂô®&lt;/h3>
&lt;p>Âú®Ê®°ÊùøÊ∏≤Êüì‰∏≠ÔºåÊúâÂèØËÉΩÈúÄË¶ÅÂú®ÁõÆÊ†áÊñá‰ª∂‰∏≠ÁîüÊàê‰∏Ä‰∫õÊ≥®Èáä‰ø°ÊÅØ„ÄÇAnsible Êèê‰æõ‰∫Ü&lt;code>comment&lt;/code>Á≠õÈÄâÂô®Êù•ÂÆåÊàêËØ•‰ªªÂä°„ÄÇ&lt;/p>
&lt;pre>&lt;code>{{ &amp;quot;Plain style (default)&amp;quot; | comment }}
&lt;/code>&lt;/pre>
&lt;p>‰ºöÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>#
# Plain style (default)
#
&lt;/code>&lt;/pre>
&lt;p>ÂèØ‰ª•Ëá™ÂÆö‰πâÊ≥®ÈáäËØ≠Ê≥ïÔºö&lt;/p>
&lt;pre>&lt;code>{{ &amp;quot;My Special Case&amp;quot; | comment(decoration=&amp;quot;! &amp;quot;) }}
&lt;/code>&lt;/pre>
&lt;p>ÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>!
! My Special Case
!
&lt;/code>&lt;/pre>
&lt;p>extract ÁªìÂêà map ‰ΩøÁî®Êó∂ÔºåÂèØ‰ª•Ê†πÊçÆÁ¥¢Âºï (ÂàóË°®Á¥¢ÂºïÊàñÂ≠óÂÖ∏Á¥¢Âºï) ‰ªéÂàóË°®ÊàñÂ≠óÂÖ∏‰∏≠ÊèêÂèñÂØπÂ∫îÂÖÉÁ¥†ÁöÑÂÄº„ÄÇ&lt;/p>
&lt;pre>&lt;code>{{ [0,2] | map('extract', ['x','y','z']) | list }}
{{ ['x','y'] | map('extract', {'x': 42, 'y': 31}) | list }}
&lt;/code>&lt;/pre>
&lt;p>ÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>['x', 'z']
[42, 31]
&lt;/code>&lt;/pre>
&lt;h3 id="dict-ÂêàÂπ∂">dict ÂêàÂπ∂&lt;/h3>
&lt;p>combine Á≠õÈÄâÂô®ÂèØ‰ª•Â∞ÜÂ§ö‰∏™ dict ‰∏≠ÂêåÂêç key ËøõË°åÂêàÂπ∂ (‰ª•Ë¶ÜÁõñÁöÑÊñπÂºèÂêàÂπ∂)„ÄÇ&lt;/p>
&lt;pre>&lt;code>{{ {'a':1, 'b':2} | combine({'b':3}) }}
&lt;/code>&lt;/pre>
&lt;p>ÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>{'a':1, 'b':3}
&lt;/code>&lt;/pre>
&lt;p>‰ΩøÁî®&lt;code>recursive=True&lt;/code>ÂèÇÊï∞ÔºåÂèØ‰ª•ÈÄíÂΩíÂà∞ÂµåÂ•ó dict ‰∏≠ËøõË°åË¶ÜÁõñÂêàÂπ∂Ôºö&lt;/p>
&lt;pre>&lt;code>{{ {'a':{'foo':1, 'bar':2}, 'b':2} | combine({'a':{'bar':3, 'baz':4}}, recursive=True) }}
&lt;/code>&lt;/pre>
&lt;p>Â∞ÜÂæóÂà∞Ôºö&lt;/p>
&lt;pre>&lt;code>{'a':{'foo':1, 'bar':3, 'baz':4}, 'b':2}
&lt;/code>&lt;/pre>
&lt;p>ÂèØ‰ª•ÂêàÂπ∂Â§ö‰∏™ dictÔºåÂ¶Ç‰∏ãÔºö&lt;/p>
&lt;pre>&lt;code>{{ a | combine(b, c, d) }}
&lt;/code>&lt;/pre>
&lt;p>d ‰∏≠ÂêåÂêç key ‰ºöË¶ÜÁõñ cÔºåc ‰ºöË¶ÜÁõñ bÔºåb ‰ºöË¶ÜÁõñ a„ÄÇ&lt;/p>
&lt;h3 id="hash-ÂÄºËÆ°ÁÆó">hash ÂÄºËÆ°ÁÆó&lt;/h3>
&lt;p>ËÆ°ÁÆóÂ≠óÁ¨¶‰∏≤ÁöÑ sha1Ôºö&lt;/p>
&lt;pre>&lt;code>{{ 'test1' | hash('sha1') }}
&lt;/code>&lt;/pre>
&lt;p>ËÆ°ÁÆóÂ≠óÁ¨¶‰∏≤ÁöÑ md5Ôºö&lt;/p>
&lt;pre>&lt;code>{{ 'test1' | hash('md5') }}
&lt;/code>&lt;/pre>
&lt;p>ËÆ°ÁÆóÂ≠óÁ¨¶‰∏≤ÁöÑ checksumÔºåÈªòËÆ§Âç≥&lt;code>hash('sha1')&lt;/code>ÂÄºÔºö&lt;/p>
&lt;pre>&lt;code>{{ 'test2' | checksum }}
&lt;/code>&lt;/pre>
&lt;p>ËÆ°ÁÆó sha512 ÂØÜÁ†Å (ÈöèÊú∫ salt):&lt;/p>
&lt;pre>&lt;code>{{ 'passwd' | password_hash('sha512') }}
&lt;/code>&lt;/pre>
&lt;p>ËÆ°ÁÆó sha256 ÂØÜÁ†Å (ÊåáÂÆö salt):&lt;/p>
&lt;pre>&lt;code>{{ passwd' | password_hash('sha256', 'mysalt') }}
&lt;/code>&lt;/pre>
&lt;p>Âêå‰∏Ä‰∏ªÊú∫ÁîüÊàêÁöÑÂØÜÁ†ÅÁõ∏ÂêåÔºö&lt;/p>
&lt;pre>&lt;code>{{ 'passwd' | password_hash('sha512', 65534 | random(seed=inventory_hostname) | string) }}
&lt;/code>&lt;/pre>
&lt;p>Ê†πÊçÆÂ≠óÁ¨¶‰∏≤ÁîüÊàê UUID ÂÄºÔºö&lt;/p>
&lt;pre>&lt;code>{{ hostname | to_uuid }}
&lt;/code>&lt;/pre>
&lt;h3 id="base64-ÁºñËß£Á†ÅÁ≠õÈÄâÂô®">base64 ÁºñËß£Á†ÅÁ≠õÈÄâÂô®&lt;/h3>
&lt;pre>&lt;code>{{ encoded_str | b64decode }}
{{ decoded_str | b64encode }}
&lt;/code>&lt;/pre>
&lt;p>‰æãÂ¶ÇÔºåAnsible Êúâ‰∏Ä‰∏™&lt;code>slurp&lt;/code>Ê®°ÂùóÔºåÂÆÉÁöÑ‰ΩúÁî®Á±ª‰ºº‰∫é fetch Ê®°ÂùóÔºåÂÆÉÂèØ‰ª•‰ªéÁõÆÊ†áËäÇÁÇπ‰∏≠ËØªÂèñÊåáÂÆöÊñá‰ª∂ÁöÑÂÜÖÂÆπÔºåÁÑ∂Âêé‰ª• base64 ÊñπÂºèÁºñÁ†ÅËøîÂõûÔºåÊâÄ‰ª•Ë¶ÅËé∑ÂèñÂÖ∂ÂéüÂßãÂÜÖÂÆπÔºåÈúÄË¶Å base64 Ëß£Á†Å„ÄÇ&lt;/p>
&lt;p>‰æãÂ¶ÇÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">slurp&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">src&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/var/run/sshd.pid&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">register&lt;/span>: &lt;span style="color:#ae81ff">sshd_pid&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;base64_pid: {{sshd_pid.content}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">debug&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">msg&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;sshd_pid: {{sshd_pid.content|b64decode}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÁªìÊûúÔºö&lt;/p>
&lt;pre>&lt;code>TASK [slurp] ***************
ok: [localhost]
TASK [debug] ******************
ok: [localhost] =&amp;gt; {
&amp;quot;msg&amp;quot;: &amp;quot;base64_pid: MTE4OAo=&amp;quot;
}
TASK [debug] *****************
ok: [localhost] =&amp;gt; {
&amp;quot;msg&amp;quot;: &amp;quot;base64_pid: 1188\n&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;h3 id="Êñá‰ª∂ÂêçÂ§ÑÁêÜ">Êñá‰ª∂ÂêçÂ§ÑÁêÜ&lt;/h3>
&lt;ul>
&lt;li>&lt;code>basename&lt;/code>ÔºöËé∑ÂèñÂ≠óÁ¨¶‰∏≤‰∏≠ÁöÑÊñá‰ª∂ÂêçÈÉ®ÂàÜ&lt;/li>
&lt;li>&lt;code>dirname&lt;/code>ÔºöËé∑ÂèñÂ≠óÁ¨¶‰∏≤‰∏≠ÁõÆÂΩïÂêçÈÉ®ÂàÜ&lt;/li>
&lt;li>&lt;code>expanduser&lt;/code>ÔºöÊâ©Â±ïÂÆ∂ÁõÆÂΩïÔºåÂç≥Â∞Ü&lt;code>~&lt;/code>ÊõøÊç¢‰∏∫ÂÆ∂ÁõÆÂΩï&lt;/li>
&lt;li>&lt;code>realpath&lt;/code>ÔºöËé∑ÂèñËΩØÈìæÊé•ÁöÑÂéüÂßãË∑ØÂæÑ&lt;/li>
&lt;li>&lt;code>splitext&lt;/code>ÔºöÊâ©Â±ïÂêçÂàÜÁ¶ª&lt;/li>
&lt;/ul>
&lt;p>ÂØπ‰∫é splitext Á≠õÈÄâÂô®Ôºå‰æãÂ¶ÇÔºö&lt;/p>
&lt;pre>&lt;code>{{&amp;quot;nginx.conf&amp;quot;|splitext}}
#=&amp;gt; (&amp;quot;nginx&amp;quot;,&amp;quot;.conf&amp;quot;)
{{'/etc/my.cnf'|splitext}}
#=&amp;gt; (&amp;quot;/etc/my&amp;quot;,&amp;quot;.cnf&amp;quot;)
&lt;/code>&lt;/pre>
&lt;h3 id="Êó•ÊúüÊó∂Èó¥Á±ªÂ§ÑÁêÜ">Êó•ÊúüÊó∂Èó¥Á±ªÂ§ÑÁêÜ&lt;/h3>
&lt;p>Áõ∏ÂØπÊù•ËØ¥ÔºåAnsible ‰∏≠Â§ÑÁêÜÊó•ÊúüÊó∂Èó¥ÁöÑÊú∫‰ºöÊòØÊØîËæÉÂ∞ëÁöÑ„ÄÇ‰ΩÜÊòØ Ansible ‰πüÊèê‰æõ‰∫ÜÊØîËæÉÊñπ‰æøÁöÑÂ§ÑÁêÜÊó•ÊúüÊó∂Èó¥ÁöÑÊñπÂºè„ÄÇ&lt;/p>
&lt;p>‰ΩøÁî®&lt;code>strftime&lt;/code>Â∞ÜÂΩìÂâçÊó∂Èó¥ÊàñÁªôÂÆöÊó∂Èó¥ (Âè™ËÉΩ‰ª• epoch Êï∞ÂÄºÊåáÂÆö) ÊåâÁÖßÁªôÂÆöÁöÑÊ†ºÂºèËæìÂá∫Ôºö&lt;/p>
&lt;pre>&lt;code># Â∞ÜÂΩìÂâçÊó∂Èó¥ÁÇπ‰ª•year-month-day hour:min:secÊ†ºÂºèËæìÂá∫
{{ '%Y-%m-%d %H:%M:%S' | strftime }}
# Â∞ÜÊåáÂÆöÁöÑÊó∂Èó¥ÊåâÁÖßÊåáÂÆöÊ†ºÂºèËæìÂá∫
{{ '%Y-%m-%d' | strftime(0) }} # =&amp;gt; 1970-01-01
{{ '%Y-%m-%d' | strftime(1441357287) }} # =&amp;gt; 2015-09-04
&lt;/code>&lt;/pre>
&lt;p>‰ΩøÁî®&lt;code>to_datetime&lt;/code>ÂèØ‰ª•Â∞ÜÊó•ÊúüÊó∂Èó¥Â≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫ Python Êó•ÊúüÊó∂Èó¥ÂØπË±°ÔºåÊó¢ÁÑ∂ÂæóÂà∞‰∫ÜÂØπË±°ÔºåÂ∞±ÂèØ‰ª•ËøõË°åÊó∂Èó¥ÊØîËæÉ„ÄÅÊó∂Èó¥ËøêÁÆóÁ≠âÊìç‰Ωú„ÄÇ&lt;/p>
&lt;pre>&lt;code># ËÆ°ÁÆóÊó∂Èó¥Â∑Æ(Âçï‰ΩçÁßí)
# ÈªòËÆ§Ëß£ÊûêÁöÑÊó•ÊúüÊó∂Èó¥Â≠óÁ¨¶‰∏≤Ê†ºÂºè‰∏∫%Y-%m-%d %H:%M:%SÔºå‰ΩÜÂèØ‰ª•Ëá™ÂÆö‰πâÊ†ºÂºè
{{ ((&amp;quot;2016-08-14 20:00:12&amp;quot; | to_datetime) - (&amp;quot;2015-12-25&amp;quot; | to_datetime(&amp;quot;%Y-%m-%d&amp;quot;))).total_seconds() }}
#=&amp;gt;20203212.0
# ËÆ°ÁÆóÁõ∏Â∑ÆÂ§öÂ∞ëÂ§©„ÄÇÂè™ËÄÉËôëÂ§©Êï∞Ôºå‰∏çËÄÉËôëÊó∂ÂàÜÁßíÁ≠â
{{ ((&amp;quot;2016-08-14 20:00:12&amp;quot; | to_datetime) - (&amp;quot;2015-12-25&amp;quot; | to_datetime('%Y-%m-%d'))).days }}
&lt;/code>&lt;/pre>
&lt;h3 id="human_to_bytes-Âíå-human_readable">human_to_bytes Âíå human_readable&lt;/h3>
&lt;p>&lt;code>human_readable&lt;/code>Â∞ÜÊï∞ÂÄºËΩ¨Êç¢‰∏∫‰∫∫Á±ªÂèØËØªÁöÑÊï∞ÊçÆÈáèÂ§ßÂ∞èÂçï‰ΩçÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>{{&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#ae81ff">|human_readable}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#ae81ff">|human_readable(isbits=True)}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{&lt;span style="color:#ae81ff">10240&lt;/span>&lt;span style="color:#ae81ff">|human_readable}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{&lt;span style="color:#ae81ff">102400000&lt;/span>&lt;span style="color:#ae81ff">|human_readable}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{&lt;span style="color:#ae81ff">102400000&lt;/span>&lt;span style="color:#ae81ff">|human_readable(unit=&amp;#34;G&amp;#34;)}}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{&lt;span style="color:#ae81ff">102400000&lt;/span>&lt;span style="color:#ae81ff">|human_readable(isbits=True, unit=&amp;#34;G&amp;#34;)}}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>human_to_bytes&lt;/code>Â∞Ü‰∫∫Á±ªÂèØËØªÁöÑÂçï‰ΩçËΩ¨Êç¢‰∏∫Êï∞ÂÄºÔºö&lt;/p>
&lt;pre>&lt;code>{{'0'|human_to_bytes}} #= 0
{{'0.1'|human_to_bytes}} #= 0
{{'0.9'|human_to_bytes}} #= 1
{{'1'|human_to_bytes}} #= 1
{{'10.00 KB'|human_to_bytes}} #= 10240
{{ '11 MB'|human_to_bytes}} #= 11534336
{{ '1.1 GB'|human_to_bytes}} #= 1181116006
{{'10.00 Kb'|human_to_bytes(isbits=True)}} #= 10240
&lt;/code>&lt;/pre>
&lt;h3 id="ÂÖ∂ÂÆÉÁ≠õÈÄâÂô®">ÂÖ∂ÂÆÉÁ≠õÈÄâÂô®&lt;/h3>
&lt;p>&lt;code>quote&lt;/code>‰∏∫Â≠óÁ¨¶‰∏≤Âä†ÂºïÂè∑ÔºåÊØîÂ¶ÇÊñπ‰æøÁºñÂÜô shell Ê®°ÂùóÁöÑÂëΩ‰ª§Ôºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">shell&lt;/span>: &lt;span style="color:#ae81ff">echo {{ string_value | quote }}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ternary&lt;/code>Ê†πÊçÆ true„ÄÅfalse Êù•ÂÜ≥ÂÆöËøîÂõûÂì™‰∏™ÂÄºÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{ &lt;span style="color:#ae81ff">(gender == &amp;#34;male&amp;#34;) | ternary(&amp;#39;Mr&amp;#39;,&amp;#39;Ms&amp;#39;) }}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{ &lt;span style="color:#ae81ff">enabled | ternary(&amp;#39;no shutdown&amp;#39;, &amp;#39;shutdown&amp;#39;, omit) }}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>product&lt;/code>ÁîüÊàêÁ¨õÂç°Â∞îÁßØÔºö&lt;/p>
&lt;pre>&lt;code>{{['foo', 'bar'] | product(['com'])|list}}
#=&amp;gt;[[&amp;quot;foo&amp;quot;,&amp;quot;com&amp;quot;], [&amp;quot;bar&amp;quot;,&amp;quot;com&amp;quot;]]
&lt;/code>&lt;/pre>
&lt;h1 id="‰ΩøÁî®Á§∫‰æã">‰ΩøÁî®Á§∫‰æã&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Â∞Üfoo.j2Êñá‰ª∂ËæìÂá∫Âà∞ÊåáÂÆö‰∏ªÊú∫ÁöÑ/etc/file.con&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">src&lt;/span>: &lt;span style="color:#ae81ff">/mytemplates/foo.j2&lt;/span> &lt;span style="color:#75715e">#ÊåáÂÆöÊ∫êÊñá‰ª∂ÔºåÊòØ‰∏Ä‰∏™Áî®jinja2ËØ≠Ë®ÄÂÜôÁöÑÊñá‰ª∂&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dest&lt;/span>: &lt;span style="color:#ae81ff">/etc/file.conf&lt;/span> &lt;span style="color:#75715e">#ÊåáÂÆöË¶ÅÁîüÊàêÁöÑÁõÆÁöÑÊñá‰ª∂&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mode&lt;/span>: &lt;span style="color:#ae81ff">0744&lt;/span> &lt;span style="color:#75715e">#ÂøÖÈ°ªÊ∑ªÂä†‰∏Ä‰∏™ÂâçÂØºÈõ∂Ôºå‰ª•‰æøAnsibleÁöÑYAMLËß£ÊûêÂô®Áü•ÈÅìÂÆÉÊòØ‰∏Ä‰∏™ÂÖ´ËøõÂà∂Êï∞Ôºà‰æãÂ¶Ç0644Êàñ01777ÔºâÊàñÂ∞ÜÂÖ∂ÂºïÂè∑Ôºà‰æãÂ¶Ç&amp;#39;644&amp;#39;Êàñ&amp;#39;1777&amp;#39;ÔºâÔºå‰ª•‰æøAnsibleÊé•Êî∂Â≠óÁ¨¶‰∏≤Âπ∂ÂèØ‰ª•‰ªéÂ≠óÁ¨¶‰∏≤ËøõË°åËá™Â∑±ÁöÑËΩ¨Êç¢ÊàêÊï∞Â≠ó„ÄÇ&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Ê®°ÊùøÊñá‰ª∂Á§∫‰æãÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">{&lt;/span>% &lt;span style="color:#66d9ef">if&lt;/span> docker.registryMirrors is defined %&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#75715e">#Â¶ÇÊûúdocker.registryMirrorsÂèòÈáèÂ≠òÂú®ÔºåÂàôÊâßË°åÊúÄÂêé‰∏ÄË°å‰πãÂâçÁöÑËØ≠Âè•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;registry-mirrors&amp;#34;&lt;/span>: &lt;span style="color:#f92672">[{&lt;/span>% &lt;span style="color:#66d9ef">for&lt;/span> mirror in docker.registryMirrors %&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#75715e">#ËæìÂá∫ &amp;#34;registry-mirrors&amp;#34;: ÂêéÊâßË°åforÂæ™ÁéØÔºåÂ∞Üdocker.registryMirrorsÂèòÈáèÁöÑÂ§ö‰∏™ÂÄºÈÄê‰∏Ä‰º†ÈÄíÁªômirrorÂèòÈáèÔºåÁõ¥Âà∞docker.registryMirrosÂèòÈáèÈáåÁöÑÂÄºÂÖ®ÈÉ®ÂºïÁî®ÂÆåÊàê&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;{{ mirror}}&amp;#34;&lt;/span>&lt;span style="color:#f92672">{&lt;/span>% &lt;span style="color:#66d9ef">if&lt;/span> not loop.last %&lt;span style="color:#f92672">}&lt;/span>,&lt;span style="color:#f92672">{&lt;/span>% endif %&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#75715e">#ËæìÂá∫ mirror ÂèòÈáèÁöÑÂÄº„ÄÇÂ¶ÇÊûúÂæ™ÁéØÊ≤°ÊúâÁªìÊùüÔºåÂàôËæìÂá∫‰∏Ä‰∏™ÈÄóÂè∑&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">{&lt;/span>%- endfor %&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#75715e">#ÁªìÊùüforÂæ™ÁéØ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">{&lt;/span>% endif %&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#75715e">#ÁªìÊùüifÁªìÊûÑ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ËæìÂá∫ÁªìÊûúÁ§∫‰æãÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;registry-mirrors&amp;#34;&lt;/span>: [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;https://ac1rmo5p.mirror.aliyuncs.com&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;https://123.123.123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ÂÆåÂÖ®Ëá™ÂÆö‰πâÁöÑ-nginx-ËôöÊãü‰∏ªÊú∫ÈÖçÁΩÆ">ÂÆåÂÖ®Ëá™ÂÆö‰πâÁöÑ nginx ËôöÊãü‰∏ªÊú∫ÈÖçÁΩÆ&lt;/h2>
&lt;p>Âú®Áîü‰∫ß‰∏≠Ôºå‰∏Ä‰∏™ÂºÄÂèë‰∏çÂ§™ÂÆåÂñÑÁöÑÁ≥ªÁªüÂèØËÉΩÊó∂‰∏çÊó∂Â∞±Ë¶ÅÂéª nginx ËôöÊãü‰∏ªÊú∫‰∏≠Ê∑ªÂä†‰∏Ä‰∏™ location ÈÖçÁΩÆÊÆµËêΩÔºåÂ¶ÇÊûúÊúâÂ§ö‰∏™ nginx ËäÇÁÇπË¶ÅÈÖçÁΩÆÔºåÊó†ÁñëËøôÊòØ‰∏Ä‰ª∂ËÆ©‰∫∫ÊÇ≤‰º§ÁöÑ‰∫ãÊÉÖ„ÄÇ&lt;/p>
&lt;p>ÂÄºÂæóÂ∫ÜÂπ∏ÔºåAnsible ÈÄöËøá Jinja2 Ê®°ÊùøÂèØ‰ª•ÂæàÂÆπÊòìÂú∞Ëß£ÂÜ≥Ëøô‰∏™Áúã‰∏äÂéªÂ§çÊùÇÁöÑ‰∫ãÊÉÖ„ÄÇ&lt;/p>
&lt;p>È¶ñÂÖàÊèê‰æõÁõ∏ÂÖ≥ÁöÑÂèòÈáèÊñá‰ª∂&lt;code>vhost_vars.yml&lt;/code>ÔºåÂÜÖÂÆπÂ¶Ç‰∏ãÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">servers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">server_name&lt;/span>: &lt;span style="color:#ae81ff">www.abc.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">locations&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">match_method&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uri&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/usr/share/nginx/html/abc/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;index.html index.htm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gzip_types&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">css&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">js&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">plain&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">match_method&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;=&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uri&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/blogs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/usr/share/nginx/html/abc/blogs/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;index.html index.htm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">match_method&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;~&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uri&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;\\.php$&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fastcgi_pass&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;127.0.0.1:9000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fastcgi_index&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;index.php&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fastcgi_param&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;SCRIPT_FILENAME /usr/share/www/php$fastcgi_script_name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">include&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fastcgi_params&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">server_name&lt;/span>: &lt;span style="color:#ae81ff">www.def.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span>: &lt;span style="color:#ae81ff">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">locations&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">match_method&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uri&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/usr/share/nginx/html/def/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;index.html index.htm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">match_method&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;~&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uri&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/imgs/.*\\.(png|jpg|jpeg|gif)$&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;/usr/share/nginx/html/def/imgs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">index&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;index.html index.htm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>‰ªé‰∏äÈù¢Êèê‰æõÁöÑÂèòÈáèÊñá‰ª∂Êù•ÁúãÔºåÂ∫îËØ•ËÉΩÁúãÂá∫Êù•ÂÆÉÁöÑÁõÆÁöÑÊòØ‰∏∫‰∫ÜËÉΩÂ§üËá™Âä®ÁîüÊàê‰∏Ä‰∏™ÊàñÂ§ö‰∏™ server ÊÆµÔºåËÄå‰∏îÂÖÅËÆ∏ÈöèÊÑèÂ¢ûÂà†ÊîπÊØè‰∏™ server ÊÆµ‰∏≠ÁöÑ location ÂèäÂÖ∂ÂÆÉÊåá‰ª§„ÄÇËøôÊ†∑‰∏ÄÊù•ÔºåÁºñÂÜô nginx ËôöÊãü‰∏ªÊú∫ÈÖçÁΩÆÁöÑ‰ªªÂä°Â∞±ÂèòÊàê‰∫ÜÁºñÂÜôËøô‰∏™ÂèòÈáèÊñá‰ª∂„ÄÇ&lt;/p>
&lt;p>ÈúÄÊ≥®ÊÑèÔºåÊØè‰∏™ location ÊÆµÊúâ‰∏§‰∏™ÂèòÈáèÂêç&lt;code>match_method&lt;/code>Âíå&lt;code>uri&lt;/code>Ôºå‰ΩúÁî®ÊòØÁîüÊàê nginx location ÈÖçÁΩÆÈ°πÁöÑÂâç‰∏ÄÈÉ®ÂàÜÔºåÂç≥&lt;code>location METHOD URI {}&lt;/code>„ÄÇÈô§Ëøô‰∏§‰∏™ÂèòÈáèÂêçÂ§ñÔºåÂâ©‰ΩôÁöÑÂèòÈáèÂêçÈÉΩ‰ºöÁõ¥Êé•ÂΩì‰Ωú nginx ÈÖçÁΩÆÊåá‰ª§Ê∏≤ÊüìÂà∞ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÔºåÊâÄ‰ª•ÂÆÉ‰ª¨ÈÉΩÈúÄÂíå nginx Êåá‰ª§ÂêçÁõ∏ÂêåÔºåÊØîÂ¶Ç index ÂèòÈáèÂêçÊ∏≤ÊüìÂêé‰ºöÂæóÂà∞ nginx ÁöÑ index Êåá‰ª§„ÄÇ&lt;/p>
&lt;p>Ââ©‰∏ãÁöÑÂ∞±ÊòØÂÜô‰∏Ä‰∏™ Jinja2 Ê®°ÊùøÊñá‰ª∂ÔºåÊ®°Êùø‰∏≠ Jinja2 ËØ≠Âè•ÂùóÊ†áÁ≠æÈÉ®ÂàÜÊàëÊ≤°Êúâ‰ΩøÁî®Áº©ËøõÔºåËøôÊ†∑ÊØîËæÉÂÆπÊòìÊéßÂà∂Ê†ºÂºè„ÄÇÊñá‰ª∂ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö&lt;/p>
&lt;pre>&lt;code>{# Ë¥üË¥£Ê∏≤ÊüìÊØè‰∏™Êåá‰ª§ #}
{% macro config(key,value) %}
{% if (value is sequence) and (value is not string) and (value is not mapping) %}
{# Â¶ÇÊûúÊåá‰ª§ÊòØÂàóË°® #}
{% for item in value -%}
{# Â¶ÇÁîüÊàêÁöÑÁªìÊûúÊòØÔºögzip_types css js plain; #}
{{ key ~ ' ' ~ item if loop.first else item}}{{' ' if not loop.last else ';'}}
{%- endfor %}
{% else %}
{# Â¶ÇÊûúÊåá‰ª§‰∏çÊòØÂàóË°® #}
{{key}} {{value}};
{% endif %}
{% endmacro %}
{# Ë¥üË¥£Ê∏≤ÊüìlocationÊåá‰ª§ #}
{% macro location(d) %}
location {{d.match_method}} {{d.uri}} {
{% for item in d|dict2items if item.key != &amp;quot;match_method&amp;quot; and item.key != &amp;quot;uri&amp;quot; %}
{{ config(item.key, item.value) }}
{%- endfor %}
}
{% endmacro %}
{% for server in servers %}
server {
{% for item in server|dict2items %}
{# ÈùûlocationÊåá‰ª§ÈÉ®ÂàÜ #}
{% if item.key != &amp;quot;locations&amp;quot; %}
{{ config(item.key,item.value) }}
{%- else %}
{# ÂêÑ‰∏™locationÊåá‰ª§ÈÉ®ÂàÜ #}
{% for l in item.value|default([],true) %}
{{ location(l) }}
{% endfor %}
{% endif %}
{%- endfor %}
}
{% endfor %}
&lt;/code>&lt;/pre>
&lt;p>ÁÑ∂Âêé‰ΩøÁî® template Ê®°ÂùóÂéªÊ∏≤ÊüìÂç≥ÂèØÔºö&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">hosts&lt;/span>: &lt;span style="color:#ae81ff">localhost&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gather_facts&lt;/span>: &lt;span style="color:#66d9ef">no&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">vars_files&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">vhost_vars.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tasks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">src&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;vhost.conf.j2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">dest&lt;/span>: &lt;span style="color:#ae81ff">/tmp/vhost.conf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Ê∏≤ÊüìÂæóÂà∞ÁöÑÁªìÊûúÔºö&lt;/p>
&lt;pre>&lt;code>server {
server_name www.abc.com;
listen 80;
location / {
root /usr/share/nginx/html/abc/;
index index.html index.htm;
gzip_types css js plain; }
location = /blogs {
root /usr/share/nginx/html/abc/blogs/;
index index.html index.htm;
}
location ~ \.php$ {
fastcgi_pass 127.0.0.1:9000;
fastcgi_index index.php;
fastcgi_param SCRIPT_FILENAME /usr/share/www/php$fastcgi_script_name;
include fastcgi_params;
}
}
server {
server_name www.def.com;
listen 8080;
location / {
root /usr/share/nginx/html/def/;
index index.html index.htm;
}
location ~ /imgs/.*\.(png|jpg|jpeg|gif)$ {
root /usr/share/nginx/html/def/imgs;
index index.html index.htm;
}
}
&lt;/code>&lt;/pre></description></item><item><title>Docs: Variables(ÂèòÈáè)</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/variables%E5%8F%98%E9%87%8F/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/variables%E5%8F%98%E9%87%8F/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-ÁõÆÂΩï-‰ΩøÁî®ÂèòÈáè&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="ÂèòÈáèÂü∫Êú¨ÁöÑÂÆö‰πâ‰∏éÂºïÁî®ÊñπÂºè">ÂèòÈáèÂü∫Êú¨ÁöÑÂÆö‰πâ‰∏éÂºïÁî®ÊñπÂºè&lt;/h1>
&lt;p>ÂèòÈáèÂêçÂ∫î‰∏∫Â≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅ‰∏ãÂàíÁ∫ø„ÄÇÂπ∂‰∏îÂßãÁªàÂ∫îËØ•‰ª•Â≠óÊØçÂºÄÂ§¥„ÄÇ&lt;/p>
&lt;p>Âü∫Á°ÄÁöÑÂÆö‰πâÊñπÂºèÊòØÂú®‰∏Ä‰∏™ play ‰∏≠‰ΩøÁî® vars ÂÖ≥ÈîÆÂ≠óÂÆö‰πâÂèòÈáèÔºåÁ§∫‰æãÂ¶Ç‰∏ã&lt;/p>
&lt;pre>&lt;code>- host: webservers
vars:
http_port: 80 # ÂÆö‰πâ‰∏Ä‰∏™Âêç‰∏∫http_portÁöÑÂèòÈáèÔºåÂÄº‰∏∫80
tasks:
- debug
&lt;/code>&lt;/pre>
&lt;p>Note: vars ÂÖ≥ÈîÆÂ≠óÂèØ‰ª•Áî®Âú® host ÁéØÂ¢É‰∏≠Ôºå‰πüÂèØ‰ª•Áî®Âú® tasks ÁéØÂ¢É‰∏≠ÔºåÁî®Âú® tasks ÁéØÂ¢ÉÊó∂ÔºåÂàôÂèòÈáè‰ªÖÂØπÂΩìÂâç‰ªªÂä°ÁîüÊïà&lt;/p>
&lt;p>‰∏ãÈù¢ÊòØ‰∏Ä‰∏™Âú®ËßíËâ≤‰∏≠ÂÆö‰πâÂ≠óÂÖ∏Á±ªÂûãÂèòÈáèÁöÑÊ†∑‰æãÔºö&lt;/p>
&lt;pre>&lt;code>~]# cat roles/test/defaults/main.yml
docker:
version: 18.06.2
dataDir: /var/lib/docker
registryMirrors:
- https://ac1rmo5p.mirror.aliyuncs.com
execOpts:
- 'native.cgroupdriver=systemd'
insecureRegistries:
- 100.64.2.52:9999
- 100.64.1.31:9999
&lt;/code>&lt;/pre>
&lt;h3 id="ÂèòÈáèÁöÑÂºïÁî®ÊñπÂºè">ÂèòÈáèÁöÑÂºïÁî®ÊñπÂºè&lt;/h3>
&lt;p>‰∏ÄËà¨ÊÉÖÂÜµ‰ΩøÁî® &lt;code>{{ VarName }}&lt;/code> Êù•ÂºïÁî®ÂèòÈáèÔºåÁâπÊÆäÊÉÖÂÜµ‰∏çÁî®Âä† &lt;code>{{ }}&lt;/code> ËÄåÂèØ‰ª•Áõ¥Êé•ÂºïÁî®ÔºåÊØîÂ¶ÇÂú®Êüê‰∫õÊéßÂà∂ÁªìÊûÑ(ÊØîÂ¶Ç when)ÁöÑËØ≠Âè•‰∏≠„ÄÇ&lt;/p>
&lt;p>ÂèòÈáèÂèØ‰ª•ÈÄöËøá‰∏§ÁßçÊñπÂºèÂºïÁî®Â≠óÂÖ∏ÂÜÖÁâπÂÆöÂ≠óÊÆµÁöÑÂèòÈáè&lt;/p>
&lt;ol>
&lt;li>‰ΩøÁî®ÊñπÊã¨Âè∑ [] ËøõË°åÂºïÁî®
&lt;ol>
&lt;li>docker[&amp;lsquo;registryMirrors&amp;rsquo;] ÂèòÈáèÁöÑÂÄº‰∏∫&lt;a href="https://ac1rmo5p.mirror.aliyuncs.com">https://ac1rmo5p.mirror.aliyuncs.com&lt;/a>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>‰ΩøÁî®ÁÇπÂè∑ . ËøõË°åÂºïÁî®
&lt;ol>
&lt;li>docker.registryMirrors ÂèòÈáèÁöÑÂÄº‰∏∫&lt;a href="https://ac1rmo5p.mirror.aliyuncs.com">https://ac1rmo5p.mirror.aliyuncs.com&lt;/a>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>NoteÔºöÂ¶ÇÊûú‰ΩøÁî® ÁÇπÂè∑ ÂºïÁî®ÂèòÈáèÂèØËÉΩ‰ºöÂºïËµ∑ÈóÆÈ¢òÔºåÂõ†‰∏∫‰ºö‰∏é python Â≠óÂÖ∏ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ïÂÜ≤Á™Å„ÄÇÊâÄ‰ª•ÔºåÂ∞ΩÈáè‰ΩøÁî®ÊñπÊã¨Âè∑Êù•ÂºïÁî®ÂèòÈáè&lt;/p></description></item><item><title>Docs: ÈîôËØØÂ§ÑÁêÜ</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.%E8%BF%90%E7%BB%B4/ansible/playbook/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</guid><description>
&lt;h1 id="Ê¶ÇËø∞">Ê¶ÇËø∞&lt;/h1>
&lt;blockquote>
&lt;p>ÂèÇËÄÉÔºö&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_error_handling.html">ÂÆòÊñπÊñáÊ°£ÔºåÁî®Êà∑ÊåáÂçó-Âú® playbook ‰∏≠ÁöÑÈîôËØØÂ§ÑÁêÜ&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="ÂøΩÁï•Â§±Ë¥•ÁöÑ‰ªªÂä°ignore_errors">ÂøΩÁï•Â§±Ë¥•ÁöÑ‰ªªÂä°(ignore_errors)&lt;/h1>
&lt;p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂΩì‰ªªÊÑèÁõÆÊ†áÊú∫Âô®‰∏äÁöÑ‰ªªÂä°ÁªìÊûúÂ§±Ë¥•Êó∂ÔºåAnsible ÈÉΩ‰ºöÂÅúÊ≠¢ÁªßÁª≠ÊâßË°åÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá &lt;code>ignore_errors&lt;/code> ÂÖ≥ÈîÆÂ≠óÂøΩÁï•ÈîôËØØÔºå‰ª•‰æøÁªßÁª≠ÊâßË°åÂêéÁª≠‰ªªÂä°„ÄÇ
ignore_errors Êåá‰ª§‰ªÖÂú®‰ªªÂä°ËÉΩÂ§üËøêË°åÂπ∂ËøîÂõû‚ÄúÂ§±Ë¥•‚ÄùÂÄºÊó∂Ëµ∑‰ΩúÁî®„ÄÇÂÆÉ‰∏ç‰ºöËÆ© Ansible ÂøΩÁï•Êú™ÂÆö‰πâÁöÑÂèòÈáèÈîôËØØ„ÄÅËøûÊé•Â§±Ë¥•„ÄÅÊâßË°åÈóÆÈ¢òÔºà‰æãÂ¶ÇÔºåÁº∫Â∞ëÂåÖÔºâÊàñËØ≠Ê≥ïÈîôËØØ„ÄÇ&lt;/p>
&lt;h1 id="ÊîπÂèò‰ªªÂä°Áä∂ÊÄÅfailed_when-‰∏é-changed_when">ÊîπÂèò‰ªªÂä°Áä∂ÊÄÅ(failed_when ‰∏é changed_when)&lt;/h1>
&lt;p>Ansible ÂèØ‰ª•ÈÄöËøáÁâπÂÆöÊù°‰ª∂ÂÆö‰πâ‰ªªÂä°ÁöÑÊâßË°åÁä∂ÊÄÅÔºåÈÄöËøáÂØπ &lt;code>failed_when&lt;/code>„ÄÅ&lt;code>changed_when&lt;/code> ÂÖ≥ÈîÆÂ≠óÊåáÂÆöÁöÑÊù°‰ª∂ËøõË°åÂà§Êñ≠ÔºåÁî®‰ª•&lt;strong>ÂÆö‰πâ&lt;/strong> failed„ÄÅchanged„ÄÅok Á≠â&lt;strong>‰ªªÂä°ÊâßË°åÁä∂ÊÄÅÊÑèÂë≥ÁùÄ‰ªÄ‰πà&lt;/strong>„ÄÇ
failed_when&lt;/p>
&lt;ul>
&lt;li>Ëã•ÁªìÊûú‰∏∫ÁúüÔºåÂàô‰ªªÂä°ÊâßË°åÁªìÊûúÂèò‰∏∫ &lt;code>fatal&lt;/code>&lt;/li>
&lt;li>Ëã•ÁªìÊûú‰∏∫ÂÅáÔºåÂàô‰ªªÂä°ÊâßË°åÁªìÊûúÂèò‰∏∫ &lt;code>changed&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>changed_when&lt;/p>
&lt;ul>
&lt;li>Ëã•ÁªìÊûú‰∏∫ÁúüÔºåÂàô‰ªªÂä°ÊâßË°åÁªìÊûúÂèò‰∏∫ &lt;code>changed&lt;/code>&lt;/li>
&lt;li>Ëã•ÁªìÊûú‰∏∫ÂÅáÔºåÂàô‰ªªÂä°ÊâßË°åÁªìÊûúÂèò‰∏∫ &lt;code>ok&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ÊØîÂ¶ÇÔºåÊàë‰ª¨Â∏∏Áî® shell Ê®°ÂùóÊâßË°å‰∏Ä‰∫õÂëΩ‰ª§ÔºåËÄå shell Ê®°ÂùóÁöÑ‰ªªÂä°Áä∂ÊÄÅÊÄªÊòØ changed ÁöÑ~~Â¶ÇÊûú‰∏Ä‰∏™ shell ÂëΩ‰ª§ÊâßË°åÂêéÔºåÊ≤°ÊúâÂèòÂåñÔºåÊàë‰ª¨ÊÉ≥ËÆ©‰ªñÂ∞Ü‰ªªÂä°Áä∂ÊÄÅËÆæ‰∏∫ okÔºåÂ∞±ÂèØ‰ª•ÈÄöËøá changed_when ÂäüËÉΩÔºåÊØîÂ¶ÇÁé∞Âú®ÊúâÂ¶Ç‰∏ã‰∏§‰∏™‰ªªÂä°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Changed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÁúüÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ changed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">shell&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cmd&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;docker start changed_when&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">register&lt;/span>: &lt;span style="color:#ae81ff">is_started&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">changed_when&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;#39;changed_when&amp;#39; in is_started[&amp;#39;stdout&amp;#39;]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ignore_errors&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Changed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÂÅáÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ ok&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">shell&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cmd&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;docker start changed_when&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">register&lt;/span>: &lt;span style="color:#ae81ff">is_started&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">changed_when&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;#39;changed_when&amp;#39; in is_started[&amp;#39;stderr&amp;#39;]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ignore_errors&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Failed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÁúüÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ failed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">shell&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cmd&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;docker start failed_when&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">register&lt;/span>: &lt;span style="color:#ae81ff">is_started&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">failed_when&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;#39;failed_when&amp;#39; in is_started[&amp;#39;stdout&amp;#39;]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ignore_errors&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Failed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÂÅáÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ changed&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">shell&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cmd&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;docker start failed_when&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">register&lt;/span>: &lt;span style="color:#ae81ff">is_started&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">failed_when&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;&amp;#39;failed_when&amp;#39; in is_started[&amp;#39;stderr&amp;#39;]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ignore_errors&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ÂÅáËÆæÁõÆÊ†áÊú∫Âô®‰∏äÂ∑≤ÁªèÊúâ‰∏Ä‰∏™Â∑≤ÁªèÂÅúÊ≠¢ÁöÑÔºåÂêç‰∏∫ test ÁöÑÂÆπÂô®ÔºåÂàôÊâßË°åÁªìÊûúÂ¶Ç‰∏ã&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#75715e"># ansible-playbook -i inventory/test.yaml -e @inventory/test_password.yaml playbooks/error_handing.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PLAY &lt;span style="color:#f92672">[&lt;/span>test&lt;span style="color:#f92672">]&lt;/span> ****************************************************************************************************************************************
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TASK &lt;span style="color:#f92672">[&lt;/span>error_handing : Changed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÁúüÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ changed&lt;span style="color:#f92672">]&lt;/span> *****************************************************************************************
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>changed: &lt;span style="color:#f92672">[&lt;/span>hw-cloud-xngy-jump-server-linux-2&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TASK &lt;span style="color:#f92672">[&lt;/span>error_handing : Changed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÂÅáÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ ok&lt;span style="color:#f92672">]&lt;/span> **********************************************************************************************
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ok: &lt;span style="color:#f92672">[&lt;/span>hw-cloud-xngy-jump-server-linux-2&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TASK &lt;span style="color:#f92672">[&lt;/span>error_handing : Failed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÁúüÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ failed&lt;span style="color:#f92672">]&lt;/span> *******************************************************************************************
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fatal: &lt;span style="color:#f92672">[&lt;/span>hw-cloud-xngy-jump-server-linux-2&lt;span style="color:#f92672">]&lt;/span>: FAILED! &lt;span style="color:#f92672">=&lt;/span>&amp;gt; &lt;span style="color:#f92672">{&lt;/span>&lt;span style="color:#e6db74">&amp;#34;changed&amp;#34;&lt;/span>: true, &lt;span style="color:#e6db74">&amp;#34;cmd&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;docker start failed_when&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;delta&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;0:00:00.253780&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;end&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;2022-
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">...ignoring
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">TASK [error_handing : Failed_when Âà§Êñ≠ÁöÑÁªìÊûú‰∏∫ÂÅáÊó∂Ôºå‰ªªÂä°Áä∂ÊÄÅ‰∏∫ changed] ******************************************************************************************
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">changed: [hw-cloud-xngy-jump-server-linux-2]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">PLAY RECAP *****************************************************************************************************************************************
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">hw-cloud-xngy-jump-server-linux-2 : ok=4 changed=3 unreachable=0 failed=0 skipped=0 rescued=0 ignored=1
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Áî±‰∫éÂêØÂä®‰∏Ä‰∏™ÂÆπÂô®ÔºåÂ¶ÇÊûúËÉΩÊ≠£Â∏∏ÂêØÂä®ÔºåÂ∞Ü‰ºöËøîÂõûÂÆπÂô®ÂêçÔºåÊâÄ‰ª•Êàë‰ª¨ÈÄöËøáÂà§Êñ≠ÂëΩ‰ª§Ë°åÁöÑËæìÂá∫ÂÜÖÂÆπ‰∏≠ÊòØÂê¶ÂåÖÂê´ test Â≠óÁ¨¶‰∏≤Êù•Âà§Êñ≠ÂÆπÂô®ÊòØÂê¶ÂêØÂä®‰∫Ü&lt;/p>
&lt;ul>
&lt;li>Ëã•ÂÆπÂô®ËøòÊ≤°ÂêØÂä®ÔºåÂàôÂëΩ‰ª§Ë°å‰ºöËøîÂõûÂ≠óÁ¨¶‰∏≤ÔºåÈÇ£‰πà changed_when ÁöÑÂà§Êñ≠ÁªìÊûú‰∏∫ÁúüÔºåËØ¥Êòé‰∫ßÁîü‰∫ÜÂèòÂåñÔºåÂàôÂ∞Ü‰ªªÂä°Áä∂ÊÄÅËÆæÁΩÆ‰∏∫ changedÔºõ&lt;/li>
&lt;li>Ëã•ÂÆπÂô®Â∑≤ÁªèÂêØÂä®ÔºåÂàôÂëΩ‰ª§Ë°å‰∏ç‰ºöËøîÂõû‰ªª‰ΩïÂ≠óÁ¨¶‰∏≤ÔºåÈÇ£‰πà changed_when ÁöÑÂà§Êñ≠ÁªìÊûúÂ∞±‰∏∫ÂÅáÔºåËØ¥ÊòéÊ≤°Êúâ‰ªª‰ΩïÂèòÂåñÔºåÊ≠§Êó∂‰ªªÂä°Áä∂ÊÄÅÂàôËÆæÁΩÆ‰∏∫ ok„ÄÇ&lt;/li>
&lt;/ul>
&lt;p>failed_when ÁöÑÊïàÊûúÂêåÁêÜ
Ê≥®ÊÑèÔºöfailed_when ‰∏é changed_when ÁöÑÂà§Êñ≠ÈÄªËæëÊúâÊó∂ÂÄôÂæàÂèçÁõ¥ËßâÔºå‰ΩøÁî®Êó∂‰∏ÄÂÆöË¶Å‰∏áÂàÜÊ≥®ÊÑè&lt;/p></description></item></channel></rss>