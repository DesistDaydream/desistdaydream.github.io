<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>断念梦 – Nginx 配置详解</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</link><description>Recent content in Nginx 配置详解 on 断念梦</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Nginx 配置详解</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://nginx.org/en/docs/beginners_guide.html#conf_structure">org 官方文档,初学者指南-配置文件结构&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://nginx.org/en/docs/dirindex.html">org 官方文档,全部指令列表&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://nginx.org/en/docs/varindex.html">org 官方文档,全部变量列表&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/#">官方文档,管理指南-基础功能-创建 NGINX 配置文件&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Nginx 由 &lt;strong>Modules(模块)&lt;/strong> 组成， Modules 由配置文件中的 &lt;strong>Directives(指令)&lt;/strong> 控制其运行行为。有的 Directives 可以控制多个模块，只不过在控制不同模块时，产生的效果也许会不尽相同。&lt;/p>
&lt;h2 id="directives指令">Directives(指令)&lt;/h2>
&lt;p>Directives(指令) 分为如下几种：&lt;/p>
&lt;ul>
&lt;li>Simple Directives(简单指令)&lt;/li>
&lt;li>Block Directives(块指令)&lt;/li>
&lt;li>Conexts(配置环境 | 上下文)&lt;/li>
&lt;/ul>
&lt;h3 id="simple-directives简单指令">Simple Directives(简单指令)&lt;/h3>
&lt;p>由空格分割的 &lt;strong>Name(指令名称)&lt;/strong> 和 &lt;strong>Parameters(指令参数)&lt;/strong>，以 &lt;code>;&lt;/code> 符号结尾。&lt;/p>
&lt;ul>
&lt;li>如果从 Nginx 的代码角度看，指令就相当于结构体中的属性，参数就是该属性的值。&lt;/li>
&lt;/ul>
&lt;h3 id="block-directives块指令">Block Directives(块指令)&lt;/h3>
&lt;p>将多个相关的简单指令组合在一起的容器，并将它们用 &lt;code>{}&lt;/code> 符号包围起来。&lt;/p>
&lt;h3 id="top-level-directives顶级指令--也称为-contexts配置环境--上下文">Top Level Directives(顶级指令) # 也称为 Contexts(配置环境 | 上下文)。&lt;/h3>
&lt;p>将多个相关的 块指令 和 简单指令 组合在一起的指令。一共分为 4 类 Contexts：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/events%20%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4.md">&lt;strong>events {}&lt;/strong>&lt;/a> # 用于配置如何处理常规连接。&lt;/li>
&lt;li>&lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/http%20%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4.md">&lt;strong>http {}&lt;/strong>&lt;/a> # http 流量处理配置，通常用来配置 7 层代理。由 ngx_http_core_module 模块处理其中配置&lt;/li>
&lt;li>&lt;strong>mail {}&lt;/strong> # mail 流量处理配置。由 ngx_mail_core_module 模块处理其中配置&lt;/li>
&lt;li>&lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/stream%20%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4.md">&lt;strong>stream {}&lt;/strong>&lt;/a> # TCP 和 UDP 流量处理配置，通常用来配置 4 层代理。由 ngx_stream_core_module 模块处理其中配置&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/core%20%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4.md">&lt;strong>main&lt;/strong>&lt;/a> # 如果某些指令在上述 4 类 Contexts 之外，则称之为 main Context。可以说，events{}、http{}、mail{}、stream{} 四个 Contexts，都属于 main 上下文中的指令。说白了，main 上下文就是 Nginx 的配置文件~其实，main 就是指最顶层的 core 模块指令&lt;/p>
&lt;p>每一个 Context 类型的指令都对应控制一个 NGX_CORE_MODULE 类型的模块&lt;/p>
&lt;ul>
&lt;li>main 指令 —&amp;gt; 控制 core 模块&lt;/li>
&lt;li>events {} 指令 —&amp;gt; 控制 events 模块&lt;/li>
&lt;li>http {} 指令 —&amp;gt; 控制 http 模块&lt;/li>
&lt;li>mail {} 指令 —&amp;gt; 控制 mail 模块&lt;/li>
&lt;li>stream {} 指令 —&amp;gt; 控制 stream 模块&lt;/li>
&lt;/ul>
&lt;p>所以，配置文件的格式实际上也是一个树状结构：
&lt;img src="https://notes-learning.oss-cn-beijing.aliyuncs.com/tt8mpd/1619841196176-fa5e09e5-44b9-49e2-bdc3-bccc385d0218.png" alt="树形结构.png">
最顶层的 main 指令，包含 简单指令 和 4 个 Contexts，每个 Context 又包含 简单指令/块指令。&lt;/p>
&lt;h2 id="inheritance继承">Inheritance(继承)&lt;/h2>
&lt;p>通常，子块指令 将会继承其 父块指令 中的指令设置。某些 简单指令 可以出现在多个 块指令 中，这种情况下，可以通过在 子块指令 中设置该 简单指令，以便覆盖其从 父块指令 中继承过来的设置。&lt;/p>
&lt;h2 id="variables变量">Variables(变量)&lt;/h2>
&lt;p>在 Nginx 的配置文件中，还可以设置并引用变量，通过 &lt;code>set&lt;/code> 指令，可以定义一个变量，并在其他指令中使用 &lt;code>$变量名&lt;/code> 引用变量。同样，也有环境变量的概念，Nginx 的很多模块在加载并时候后，会产生环境变量，也可以直接引用&lt;/p>
&lt;p>变量最常用的地方就是通过 &lt;code>log_format&lt;/code> 指令定义日志内容~~&lt;/p>
&lt;h2 id="基本配置示例">基本配置示例&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 在 4 种配置环境之外的指令属于 main 配置环境，一般用于配置 nginx 运行的基础信息
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">user&lt;/span> &lt;span style="color:#e6db74">nobody&lt;/span>; &lt;span style="color:#75715e"># 这是一个 main context 中的指令
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 事件配置环境。用于配置连接参数等信息
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">events&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 关于连接处理的配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># http 流量处理配置环境
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">http&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 影响所有 virtual servers 的 http 流量的配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">localhost&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置处理 http 流量的 Virtual Server 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/one&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置用于处理以&amp;#39;/one&amp;#39;开头的URI的流量
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/two&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置用于处理以&amp;#39;/two&amp;#39;开头的URI的流量
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 配置处理 http 流量的 Virtual Server 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># mail 流量处理环境
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">mail&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">....&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># TCP 和 UDP 流量处理配置环境
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#e6db74">stream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 影响所有 virtual servers 的 TCP/UDP 流量的配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#配置处理 TCP 流量的 Virtual Server 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Note：&lt;/p>
&lt;ol>
&lt;li>通常 &lt;code>{}&lt;/code> 中的指令只对大括号内部内容生效；不在 &lt;code>{}&lt;/code> 中且在文件开头的，则对全局生效；配置指令要以分号结尾&lt;/li>
&lt;li>配置技巧：为了使配置更易于维护，还可以将大段的配置拆分为一组一组存储在 /etc/nginx/conf.d/ 目录下的文件，并在 nginx.conf 这个主配置文件中使用 &lt;code>include&lt;/code> 指令来引用这些文件。&lt;/li>
&lt;/ol>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>其实，Nginx 的配置本质就是对模块的配置，这些指令就是模块可以接收的形参；而指令的值就是代码中，应该给模块传递的实参。&lt;/p>
&lt;p>而 Nginx 配置文件的组织结构更像 INI 格式的配置文件，Nginx 的 顶级指令就是 Selections(部分) 的概念；简单指令就是 Key/Value Pairs(键/值对) 的概念；块指令其实就是一种嵌套形式的简单指令。&lt;/p>
&lt;h1 id="配置文件详解">配置文件详解&lt;/h1>
&lt;p>本质上，Nginx 的配置文件，就是由 &lt;strong>Directives(指令)&lt;/strong> 与 &lt;strong>Contexts(配置环境 | 上下文)&lt;/strong> 组成，而这些指令和配置环境，又是围绕 Virtual Servers 运转。&lt;/p>
&lt;h2 id="virtual-servers虚拟主机-抽象概念">Virtual Servers(虚拟主机) 抽象概念&lt;/h2>
&lt;p>**Virtual Servers(虚拟主机) **是 Nginx 的抽象概念，Virtual Servers 用来定义 **流量入口 **和 &lt;strong>流量处理&lt;/strong>。而这两块功能也是 Nginx 正常工作的最基本功能。&lt;/p>
&lt;h3 id="流量入口">流量入口&lt;/h3>
&lt;p>流量入口包括监听的地址、域名等。对于发送到 Nginx 的流量，根据流量中的内容，分配到不同的入口，进行后续流量处理。&lt;/p>
&lt;h3 id="流量处理">流量处理&lt;/h3>
&lt;p>流量处理包括将流量代理到何处、是否丢弃、连接超时时长等。&lt;/p>
&lt;h4 id="后端服务器">后端服务器&lt;/h4>
&lt;p>由于流量处理需要将流量代理到指定的服务器，所以还需要配置后端服务器来接收流量。&lt;/p>
&lt;h2 id="总结-1">总结&lt;/h2>
&lt;p>Virtual Server 的概念，通过 **&lt;code>server{}&lt;/code> **指令来实现。在每个流量处理的配置环境中，都应该包含一个或多个 server{} 指令。server{} 指令是 nginx 正常运行的基础配置。虚拟主机，顾名思义，对于用户来说，访问的就是一台一台服务器，但是对于 nginx 来说，是虚拟出来的。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>对于 http 流量(http 配置环境)&lt;/strong> # 每个 &lt;code>server{} 指令块&lt;/code> 控制访问特定域名或者 ip 地址上对资源请求的处理。server 指令块中的一个或多个 location 指令块定义了根据 URI 来处理流量的规则
&lt;ol>
&lt;li>比如用户访问 map.baidu.com 和 baike.baidu.com。看上去是访问了两台服务器，但是实际上，这是经过作为代理设备的 ngxin 来进行选择后的虚拟服务器。一般情况下，baike.baidu.com 与 map.baidu.com 这俩域名所解析出来的 ip 应该是同一个公网 ip(比如 123.123.123.123)(baidu 有钱用很多公网 IP 除外)。所以可以想到，用户在浏览器输入任何一个域名，访问请求都会来到 123.123.123.123，然后根据请求报文中的 Request-URL 字段中的域名与 server_name 进行配对，用户输入的 URL 中域名与哪个 server_name 相同，则该请求就会通过这个 server 来进行处理，然后根据该 server 中 location 的关键字来决定把改请求转发给哪里。&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>&lt;strong>mail 和 TCP/UDP 流量(mail 和 stream 配置环境)&lt;/strong> # 每个 &lt;code>server{} 指令块&lt;/code> 控制处理到达指定 TCP port 或 UNIX socket 的流量。
&lt;ol>
&lt;li>比如用户访问 30000 端口，则可以根据其中的规则，将 对 30000 端口发起的请求，代理到其他设备的某些端口上。&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>其实说白了，每个 Virtual Server 都相当于一个独立运行的服务，用来处理客户端的请求。具体如何处理，则在每个 server{} 指令块中定义。可以这么说，Nginx 中所有指令，其实都是为 Virtual Servers 服务的。&lt;/p>
&lt;h1 id="指令详解">指令详解&lt;/h1>
&lt;h2 id="main-模块指令docsit学习笔记3集群与分布式nginxnginx20-配置详解core20-模块指令md-配置详解core-模块指令md">[main 模块指令](/docs/IT学习笔记/3.集群与分布式/Nginx/Nginx%20 配置详解/core%20 模块指令.md 配置详解/core 模块指令.md)**&lt;/h2>
&lt;h2 id="events-模块指令docsit学习笔记3集群与分布式nginxnginx20-配置详解events20-模块指令md-配置详解events-模块指令md">[events 模块指令](/docs/IT学习笔记/3.集群与分布式/Nginx/Nginx%20 配置详解/events%20 模块指令.md 配置详解/events 模块指令.md)&lt;/h2>
&lt;p>[http 模块指令](/docs/IT学习笔记/3.集群与分布式/Nginx/Nginx%20 配置详解/http%20 模块指令.md 配置详解/http 模块指令.md)&lt;/p>
&lt;p>常用来配置七层代理、web 应用&lt;/p>
&lt;h2 id="mail-模块指令">mail 模块指令&lt;/h2>
&lt;p>[stream 模块指令](/docs/IT学习笔记/3.集群与分布式/Nginx/Nginx%20 配置详解/stream%20 模块指令.md 配置详解/stream 模块指令.md)&lt;/p>
&lt;p>常用来配置四层代理&lt;/p></description></item><item><title>Docs: core 模块指令</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/core-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/core-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://nginx.org/en/docs/ngx_core_module.html">org 官方文档,核心功能&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>main 模块主要用来为 nginx 程序的运行方式进行定义，并不涉及流量处理相关工作。&lt;/p>
&lt;h1 id="指令详解">指令详解&lt;/h1>
&lt;p>&lt;strong>user USERNAME [GROUPNAME];&lt;/strong> # 指定运行 work 线程的用户和组
&lt;strong>pid /PATH/PidFile;&lt;/strong> # 指定 nginx 守护进程的 pid 文件
&lt;strong>work_rlimit_nofile NUMBER;&lt;/strong> # 指定所有 work 线程加起来所能打开的最大文件句柄数&lt;/p></description></item><item><title>Docs: events 模块指令</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/events-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/events-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;h1 id="指令详解">指令详解&lt;/h1>
&lt;p>&lt;a href="http://nginx.org/en/docs/ngx_core_module.html#worker_connections">&lt;strong>worker_connections NUMBER;&lt;/strong>&lt;/a> # worker 进程最大并发连接数&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>worker_connections 512;&lt;/code>&lt;/li>
&lt;/ul></description></item><item><title>Docs: http 模块指令</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/http-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/http-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://nginx.org/en/docs/http/ngx_http_core_module.html">org 官方文档,http core 模块&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/">官方文档,管理指南-负载均衡-HTTP 负载均衡&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>http 模块及其子模块通过 &lt;code>http {}&lt;/code> 配置环境中的指令控制行为&lt;/p>
&lt;p>&lt;code>http{}&lt;/code> 配置环境下的每个 &lt;code>server{}&lt;/code> 指令块控制访问特定域名或者 ip 地址上对资源请求的处理。&lt;code>server{}&lt;/code> 指令块中的一个或多个 &lt;code>location{}&lt;/code> 指令块定义了根据 URL 来处理流量的规则&lt;/p>
&lt;ul>
&lt;li>比如用户访问 map.baidu.com 和 baike.baidu.com。看上去是访问了两台服务器，但是实际上，这是经过作为代理设备的 ngxin 来进行选择后的虚拟服务器。一般情况下，baike.baidu.com 与 map.baidu.com 这俩域名所解析出来的 ip 应该是同一个公网 ip(比如 123.123.123.123)(baidu 有钱用很多公网 IP 除外)。所以可以想到，用户在浏览器输入任何一个域名，访问请求都会来到 123.123.123.123，然后根据请求报文中的 Request-URL 字段中的域名与 server_name 进行配对，用户输入的 URL 中域名与哪个 server_name 相同，则该请求就会通过这个 server 来进行处理，然后根据该 server 中 location 的关键字来决定把改请求转发给哪里。&lt;/li>
&lt;/ul>
&lt;p>对于 &lt;code>http{}&lt;/code> 配置环境来说，server{}、server_name、location{}、proxy_pass 是实现 7 层代理的关键指令。server_name 指定接受流量的域名，&lt;code>location{}&lt;/code> 匹配路径，然后通过 proxy_pass 将流量代理到指定的后端。&lt;/p>
&lt;h2 id="简单的-http-配置环境示例">简单的 http{} 配置环境示例&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">http&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">access_log&lt;/span> &lt;span style="color:#e6db74">/dev/stdout&lt;/span> &lt;span style="color:#e6db74">main&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">backend&lt;/span> { &lt;span style="color:#75715e"># 后端配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">server&lt;/span> &lt;span style="color:#e6db74">backend1.example.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> &lt;span style="color:#e6db74">backend2.example.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> &lt;span style="color:#ae81ff">192&lt;/span>&lt;span style="color:#e6db74">.0.0.1&lt;/span> &lt;span style="color:#e6db74">backup&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">localhost&lt;/span>; &lt;span style="color:#75715e"># 流量入口
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> { &lt;span style="color:#75715e"># 流量处理
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://backend&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">include&lt;/span> &lt;span style="color:#e6db74">/etc/nginx/conf.d/*.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="virtual-server-基本配置">Virtual Server 基本配置&lt;/h1>
&lt;h2 id="流量入口指令">流量入口指令&lt;/h2>
&lt;p>流量入口的指令通常都定义在 &lt;code>**server{} 块指令**&lt;/code> 中。&lt;/p>
&lt;h3 id="server">server&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#server">https://nginx.org/en/docs/http/ngx_http_core_module.html#server&lt;/a>&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}&lt;/li>
&lt;/ul>
&lt;p>server{} 指令块用来定义 Virtual Server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#e6db74">[::]:80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">&amp;#34;baike.baidu.com&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://192.168.0.100:8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.......&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下面详解的各种 简单指令 或 块指令 一般情况，都将会定义在 &lt;code>server{}&lt;/code> 块指令中&lt;/p>
&lt;h3 id="listen-targetparameter">listen TARGET[PARAMETER];&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#listen">https://nginx.org/en/docs/http/ngx_http_core_module.html#listen&lt;/a>&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>listen *：80 | *：8000;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>指定 Virtual Server 监听的端口，也可加上 IP:PORT&lt;/p>
&lt;ul>
&lt;li>&lt;strong>TARGET&lt;/strong> # 每个 Virtual Server 的 listen 指令都会让 Nginx 监听一个 TARGET。TARGET 可以有多种格式：
&lt;ul>
&lt;li>ADDRESS:[PORT] # 监听在指定的 IP 和端口上，ADDRESS 可以使用通配符。&lt;/li>
&lt;li>PORT # 省略地址，即监听在所有 IP 的指定端口上。&lt;/li>
&lt;li>UNIX:PATH # 监听在以 unix: 为前缀的 UNIX 套接字上。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>PARAMETER&lt;/strong> # 可以为指定的监听配置参数，多个参数以空格分割：
&lt;ul>
&lt;li>&lt;strong>default_server&lt;/strong> # 将该 Virtual Server 设为默认。若客户端的请求没有匹配到任何 Virtual Server，则该请求由默认 Virtual Server 处理。
&lt;ul>
&lt;li>注意：若没有任何 Virtual Server 配置了 listen 指令的 defautl_server 参数，那么当匹配不到 Virtual Server 时，默认的 Virtual Server 就是&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ssl&lt;/strong> # 启动 SSL 模块，让此监听上接受的所有连接都应在 SSL 模式下工作&lt;/li>
&lt;li>&amp;hellip;&amp;hellip;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="server_name-string">server_name STRING;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#server_name">https://nginx.org/en/docs/http/ngx_http_core_module.html#server_name&lt;/a>&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>server_name &amp;quot;&amp;quot;;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>入口名称(也就是 Virtual Server 的名字)。用来匹配一个请求 Header 中的 Host 字段。&lt;/p>
&lt;p>STRING 可以是完整（精确）名称，通配符或正则表达式。通配符是一个字符串，在字符串的开始，结尾或同时包括和都包括星号（*）。星号匹配任何字符序列。 NGINX Plus 对正则表达式使用 Perl 语法;在其前面加上波浪号（〜）。&lt;/p>
&lt;p>server_name 指令是用来匹配用户在浏览器浏览网站时，输入的 域名 或者 IP:PORT 的。比如用户访问 &lt;code>www.baidu.com&lt;/code>，那么 &lt;code>server_name&lt;/code> 就可以设置为 &lt;code>*.baidu.com&lt;/code>&lt;/p>
&lt;p>如果有多个域名，则可以写多个 server_name 指令，也就是说所有来自这些域名的流量都会被统一处理。&lt;/p>
&lt;h2 id="流量处理指令">流量处理指令&lt;/h2>
&lt;p>流量处理的指令通常都在 &lt;code>location URI {}&lt;/code> 块指令内。&lt;/p>
&lt;h3 id="location--uri">location [=|~|~*|^~] URI&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location">http://nginx.org/en/docs/http/ngx_http_core_module.html#location&lt;/a>&lt;/p>
&lt;p>根据用户请求的 URI 进行匹配，匹配到时，此请求将被响应的 &lt;code>location{}&lt;/code> 块指令中的指令所处理。对于用户请求的匹配优先级：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>=&lt;/strong> #&lt;/li>
&lt;li>&lt;strong>^~&lt;/strong> #&lt;/li>
&lt;li>&lt;strong>~&lt;/strong> # 正则匹配。区分大小写的匹配&lt;/li>
&lt;li>&lt;strong>~*&lt;/strong> # 正则匹配。不区分大小写&lt;/li>
&lt;li>&lt;strong>无符号&lt;/strong> # 精确匹配,区分大小写,不区分大小写&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>下面详解的各种 简单指令 或 块指令 一般情况，都将会定义在 &lt;code>location URL {}&lt;/code> 块指令中&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> { &lt;span style="color:#75715e"># 用户请求 / 目录下的文件的时候如何处理
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">limit_except&lt;/span> &lt;span style="color:#e6db74">GET&lt;/span> &lt;span style="color:#e6db74">POST&lt;/span> &lt;span style="color:#e6db74">HEAD&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">deny&lt;/span> &lt;span style="color:#e6db74">all&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">if&lt;/span> &lt;span style="color:#e6db74">http_version&lt;/span> == &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.0&lt;/span> &lt;span style="color:#e6db74">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">return&lt;/span> &lt;span style="color:#e6db74">ngx.exec(&amp;#34;/hcs_proxy_10&amp;#34;,&lt;/span> &lt;span style="color:#e6db74">args)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">return&lt;/span> &lt;span style="color:#e6db74">ngx.exec(&amp;#34;/hcs_proxy_11&amp;#34;,&lt;/span> &lt;span style="color:#e6db74">args)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">location&lt;/span> ~ &lt;span style="color:#e6db74">\.php$&lt;/span> { &lt;span style="color:#75715e">#用户请求的是.php文件的时候是如何处理的
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">fastcgi_pass&lt;/span> 127.0.0.1:&lt;span style="color:#ae81ff">9000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.......&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="proxy_pass-url">proxy_pass URL;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass">https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass&lt;/a>&lt;/p>
&lt;p>代替用户把对 location 定义的请求下的 URL 交给指定的 UPSTREAM 来处理请求。该指令属于 ngx_http_proxy_modeule 模块
URL 有多种表示方法(下面的 Protocol 通常都是 http 或 https)&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Protocol://ServerGroup/URI;&lt;/strong> # 将流量代理到 &lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/upstream%20%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4.md">一组服务器&lt;/a> 上。每个流量都会根据负载均衡的规则交给 upstream{} 指令块中定义的服务器。
&lt;ul>
&lt;li>新版中，也可以省略 Protocol://，直接使用 ServerGroup 的名称即可。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Protocol://IP:PORT/URI;&lt;/strong> # 将流量代理到指定的服务器上。当只有一台可用的后端服务器时可以使用这种方式，这样就不用再使用 upstream 指令块定义了&lt;/li>
&lt;li>&lt;strong>Protocol:unix:/PATH/TO/FILE:/URI;&lt;/strong> # 将流量代理到本地的 UNIX-domain Socket 上。socket 的路径需要使用 &lt;code>:&lt;/code> 包裹起来。&lt;/li>
&lt;/ul>
&lt;p>在&lt;a href="#%E5%85%B6%E4%BB%96%E6%8C%87%E4%BB%A4">其他指令&lt;/a>中，以 &lt;code>proxy_&lt;/code> 开头的简单指令，都可以作为 &lt;code>proxy_pass&lt;/code> 指令的扩充，以定义更加丰富多样的流量处理功能。&lt;/p>
&lt;p>注意：&lt;/p>
&lt;ul>
&lt;li>WebSocket 代理需要特殊配置。详见&lt;a href="https://nginx.org/en/docs/http/websocket.html">官方文档-websocket&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="特殊的流量处理">特殊的流量处理&lt;/h3>
&lt;p>&lt;strong>fastcgi_pass 127.0.0.1:9000;&lt;/strong> # 反向代理重定向该请求到 127.0.0.1:9000 上,Nginx 本身不支持 PHP 等语言，但是它可以通过 FastCGI 来将请求扔给某些语言或框架处理（例如 PHP、Python、Perl)
代理 fastcgi 协议的指令，当协议不是 http 协议的时候，则要使用 fastcgi 模块，注意与 proxy_pass 的区别。由于 nginx 本身并不支持动态内容的 php 等文件，需要由专门的服务器来提供，nginx 收到 .php 等请求的时候，则将该请求通过 fastcgi 协议，转发给后端能处理动态内容的服务器。比如可以在 location 中设定 .php 访问的条件，然后 {} 内中写明 fastcgi 所定义的服务器&lt;/p>
&lt;p>&lt;strong>fastcgi_index index.php;&lt;/strong> #&lt;/p>
&lt;p>&lt;strong>fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;&lt;/strong> #&lt;/p>
&lt;p>&lt;strong>fastcgi_cache_path path PATH ARGS&amp;hellip;;&lt;/strong> #&lt;/p>
&lt;h1 id="其他指令">其他指令&lt;/h1>
&lt;p>这些指令一般都直接定义在顶层的 &lt;code>http{}&lt;/code> 配置环境中，与 &lt;code>server{}&lt;/code>、&lt;code>upstream{}&lt;/code> 等块指令平级。还有一些指令是可以适用于多个指令块中的。定义在顶层的 &lt;code>http{}&lt;/code> 配置环境中时，效果将会应用在每个 Virtual Server 中，同时也可以定义在单独的 指令块让，让指令作用于局部。&lt;/p>
&lt;p>指令使用时的不成文规范：&lt;/p>
&lt;ul>
&lt;li>通常来说，凡是作用范围包含 &lt;code>location {}&lt;/code> 块指令的 简单指令，都直接定义在 &lt;code>location{}&lt;/code> 块指令中。&lt;/li>
&lt;/ul>
&lt;h2 id="ngx_http_core_module-模块指令">ngx_http_core_module 模块指令&lt;/h2>
&lt;blockquote>
&lt;p>代码：&lt;a href="https://github.com/nginx/nginx/blob/master/src/http/ngx_http_core_module.c">https://github.com/nginx/nginx/blob/master/src/http/ngx_http_core_module.c&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="alias-path">alias PATH;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#alias">https://nginx.org/en/docs/http/ngx_http_core_module.html#alias&lt;/a>&lt;/p>
&lt;p>用于 loation 上下文，定义 location 指令定义的路径的别名，注意与 root 指令的区别&lt;/p>
&lt;h3 id="client_body_in_file_only-on--clean--off">client_body_in_file_only on | clean | off;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_in_file_only">https://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_in_file_only&lt;/a>&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>client_body_in_file_only off;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>确定 Nginx 是否应该将整个客户端请求正文保存到文件中。可以在调试期间或使用 &lt;code>$request_body_file&lt;/code> 变量或模块 ngx_http_perl_module 的$ r-&amp;gt; request_body_file 方法时使用此指令。&lt;/p>
&lt;p>设置为 on 时，请求处理后不会删除临时文件&lt;/p>
&lt;p>clean 值将导致请求处理后留下的临时文件被删除。&lt;/p>
&lt;h3 id="client_header_timeout-num">client_header_timeout NUM;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#client_header_timeout">https://nginx.org/en/docs/http/ngx_http_core_module.html#client_header_timeout&lt;/a>&lt;/p>
&lt;p>读取 http 请求报文首部的超时时长&lt;/p>
&lt;h3 id="error_page-code--uri">error_page CODE &amp;hellip; URI;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#error_page">https://nginx.org/en/docs/http/ngx_http_core_module.html#error_page&lt;/a>&lt;/p>
&lt;p>根据 http 响应状态码来指名特用的错误页面&lt;/p>
&lt;h3 id="ignore_invalid_headers-onoff">ignore_invalid_headers on|off;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#ignore_invalid_headers">https://nginx.org/en/docs/http/ngx_http_core_module.html#ignore_invalid_headers&lt;/a>&lt;/p>
&lt;p>是否忽略无效的请求头。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>ignore_invalid_headers on;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}&lt;/li>
&lt;/ul>
&lt;p>这里指的无效的请求头，主要是针对请求头的 key 来说，有效的请求头的 key 只能是由 英文字母、数字、连字符、下划线 这其中的 1 个或多个，而下划线的有效性，由 underscores_in_headers 指令控制。&lt;/p>
&lt;h3 id="keepalive_disable-msie6safarinone">keepalive_disable msie6|safari|none;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_disable">https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_disable&lt;/a>&lt;/p>
&lt;p>为指定类型的 User Agent(说白了就是浏览器) 禁用长连接&lt;/p>
&lt;h3 id="keepalive_requests-number">keepalive_requests NUMBER;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_requests">https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_requests&lt;/a>&lt;/p>
&lt;p>在一个长连接上所能够允许的最大资源数&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>keepalive_requests 1000;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="keepalive_timeout-duration">keepalive_timeout DURATION;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_timeout">https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_timeout&lt;/a>&lt;/p>
&lt;p>设定长连接的超时时长为默认 75 秒&lt;/p>
&lt;ul>
&lt;li>默认值：keepalive_timeout 75s;&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="root-path">root PATH;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#root">https://nginx.org/en/docs/http/ngx_http_core_module.html#root&lt;/a>&lt;/p>
&lt;p>指明请求的 URL 所对应的资源所在文件系统上的起始路径。&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>把 root 配置指令写到 &lt;code>location / {} 指令块&lt;/code> 中，即表明当用户请求的是 / 下的资源时候，去 root 定义的本地的那个路径去找对应的资源。&lt;/p>
&lt;h3 id="sendfile-onoff">sendfile on|off;&lt;/h3>
&lt;p>&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#sendfile">https://nginx.org/en/docs/http/ngx_http_core_module.html#sendfile&lt;/a>&lt;/p>
&lt;p>开启或关闭 sendfile() 功能，即&lt;a href="docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.Kernel(%E5%86%85%E6%A0%B8)/6.File_System_%E7%AE%A1%E7%90%86/%E9%9B%B6%E6%8B%B7%E8%B4%9D.md">零拷贝&lt;/a>功能。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>sendfile off;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>在此配置中，使用 SF_NODISKIO 标志调用 sendfile()，这将导致它不会在磁盘 I / O 上阻塞，而是报告该数据不在内存中。然后，nginx 通过读取一个字节来启动异步数据加载。第一次读取时，FreeBSD 内核将文件的前 128K 字节加载到内存中，尽管接下来的读取只会加载 16K 块中的数据。可以使用 read_ahead 指令更改此设置。&lt;/p>
&lt;h3 id="server_names_hash_bucket_size-size">server_names_hash_bucket_size SIZE;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_bucket_size">http://nginx.org/en/docs/http/ngx_http_core_module.html#server_names_hash_bucket_size&lt;/a>&lt;/p>
&lt;p>设置 server_name 指定设定的服务器名称哈希表的桶容量。默认值取决于处理缓存线的大小。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>server_namers_hash_bucket_size 32|64|128;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}&lt;/li>
&lt;/ul>
&lt;h3 id="tcp_nodelay-onoff">tcp_nodelay on|off;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#tcp_nodelay">http://nginx.org/en/docs/http/ngx_http_core_module.html#tcp_nodelay&lt;/a>&lt;/p>
&lt;p>是否开启长连接使用 tcp_nodelay 选项&lt;/p>
&lt;h3 id="underscores_in_headers-onoff">underscores_in_headers on|off;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers">http://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers&lt;/a>&lt;/p>
&lt;p>是否允许请求头中的 key 带有下划线。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>underscores_in_headers off;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}&lt;/li>
&lt;/ul>
&lt;p>默认不允许，所有请求头中带有下划线的请求虽然可以被正常代理，但是其中带有下划线的请求头无法被传递到后端服务器。该指令受 ignore_invalid_headers(忽略无效请求头) 指令约束。若关闭 ignore_invalid_headers 指令，则 underscores_in_headers 指令不管如何配置都没有用。&lt;/p>
&lt;h2 id="ngx_http_log_module-模块指令">ngx_http_log_module 模块指令&lt;/h2>
&lt;blockquote>
&lt;p>代码：&lt;a href="https://github.com/nginx/nginx/blob/master/src/http/modules/ngx_http_log_module.c">https://github.com/nginx/nginx/blob/master/src/http/modules/ngx_http_log_module.c&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="access_log-path-format-parameter">access_log PATH FORMAT [PARAMETER];&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_log_module.html#access_log">http://nginx.org/en/docs/http/ngx_http_log_module.html#access_log&lt;/a>&lt;/p>
&lt;p>设置 access 日志的写入路径。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>access_log logs/access.log combined;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>FORMAT 是 &lt;code>log_format&lt;/code> 指令定义的日志格式名称，若不指定则默认是名为 combined 的日志格式&lt;/p>
&lt;h3 id="log_formatnameescapedefaultjsonnonestring">log_format NAME [escape=default|json|none] STRING &amp;hellip;;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format">http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format&lt;/a>&lt;/p>
&lt;p>设定 Nginx 的日志格式。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>log_format combined &amp;quot;...&amp;quot;;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}&lt;/li>
&lt;/ul>
&lt;p>定义一个日志格式并将该格式命名为 NAME，格式名称可以在 access_log 等指令中直接引用。&lt;/p>
&lt;p>STRING 就是具体的日志格式，其中可以引用一些自带的变量，类似于编程语言中的 printf 关键字效果。具体可用变量详见官方指令详解。&lt;/p>
&lt;p>combined 是 Nginx 默认的日志格式名称，格式如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">log_format&lt;/span> &lt;span style="color:#e6db74">combined&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>$remote_addr &lt;span style="color:#e6db74">-&lt;/span> $remote_user &lt;span style="color:#e6db74">[&lt;/span>$time_local] &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#34;&lt;/span>$request&amp;#34; $status $body_bytes_sent &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#34;&lt;/span>$http_referer&amp;#34; &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$http_user_agent&amp;#34;&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>更多日志格式设置方法，见 &lt;a href="https://desistdaydream.github.io/docs/IT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/log_format%20%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4.md">log_format 模块指令&lt;/a>&lt;/p>
&lt;h2 id="ngx_http_proxy_module-模块指令">ngx_http_proxy_module 模块指令&lt;/h2>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html">org 官方文档，http-ngx_http_proxy_module&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/nginx/nginx/blob/master/src/http/modules/ngx_http_proxy_module.c">GitHub 代码：nginx/nginx/src/http/modules/ngx_http_proxy_module.c&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="proxy_pass-url-1">proxy_pass URL;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass&lt;/a>&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>无&lt;/code>&lt;/li>
&lt;li>作用范围：location{}&lt;/li>
&lt;/ul>
&lt;p>该指令是 ngx_http_proxy_module 模块的核心指令，也是 http{}、stream{} 指令块中用来执行流量处理的指令。&lt;/p>
&lt;blockquote>
&lt;p>参考：&lt;a href="https://mp.weixin.qq.com/s/D3dri6v0Tk45TOWsDb0HqQ">https://mp.weixin.qq.com/s/D3dri6v0Tk45TOWsDb0HqQ&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>根据 URL 最后有没有 &lt;code>/&lt;/code> 会分为多种情况（现假设客户端请求 URL 为：&lt;code>https://172.16.1.1/hello/world.html&lt;/code>）：&lt;/p>
&lt;ul>
&lt;li>有 &lt;code>/&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/hello/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>代理到 http://127.0.0.1/world.html&lt;/li>
&lt;li>无 &lt;code>/&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/hello/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>代理到 URL：http://127.0.0.1/hello/world.html&lt;/li>
&lt;li>有其他路由，且有 &lt;code>/&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/hello/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1/test/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>代理到 URL：http://127.0.0.1/test/world.html&lt;/li>
&lt;li>有其他路由，且无 &lt;code>/&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/hello/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://127.0.0.1/test&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>代理到 URL：http://127.0.0.1/testworld.html&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_cache_path-path-args">proxy_cache_path PATH ARGS&amp;hellip;;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_cache_path">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_cache_path&lt;/a>&lt;/p>
&lt;p>设定代理服务缓存路径和其它参数&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_http_version-version">proxy_http_version VERSION;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version&lt;/a>&lt;/p>
&lt;p>设置用于代理的 HTTP 协议版本。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>proxy_http_version 1.0;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>建议将 1.1 版与 Keepalive 连接和 NTLM 身份验证配合使用。&lt;/p>
&lt;/blockquote>
&lt;h3 id="proxy_intercept_errors-onoff">proxy_intercept_errors on|off;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_intercept_errors">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_intercept_errors&lt;/a>&lt;/p>
&lt;p>确定是否应将代码大于或等于 300 的代理响应传递给客户端，还是应拦截并重定向到 nginx，以便使用 error_page 指令进行处理&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_redirect-redirect-replacement">proxy_redirect REDIRECT REPLACEMENT;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect&lt;/a>&lt;/p>
&lt;p>修改被代理服务器的响应头中 Location 和 Refresh 字段的值。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>proxy_redirect default;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>假如一个被代理的服务器响应头为 &lt;code>Location: http://localhost:8000/two/some/uri/&lt;/code>。那么如果配置了如下指令：&lt;code>proxy_redirect http://localhost:8000/two/ http://frontend/one/;&lt;/code> 之后。Nginx 响应给客户端的头变成了 &lt;code>Location: http://frontend/one/some/uri/&lt;/code>&lt;/p>
&lt;p>&lt;strong>EXAMPLE&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>proxy_redirect http:// https://;&lt;/code>
&lt;ul>
&lt;li>所有 3XX 跳转的 http 的请求都会被转为 https&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_set_header-field-value">proxy_set_header FIELD VALUE;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header&lt;/a>&lt;/p>
&lt;p>用来重定义发往后端服务器的请求 Header 内容。&lt;strong>常用指令&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>默认值：
&lt;ul>
&lt;li>&lt;code>proxy_set_header Host $proxy_host;&lt;/code>&lt;/li>
&lt;li>&lt;code>proxy_set_header Connection close;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>FIELD(字段)&lt;/strong> # 指定要重新定义的请求 Header 的字段
&lt;strong>VALUE(值)&lt;/strong> # Header 字段的值。可以是包含文本、变量（nginx 的内置变量）或者它们的组合。&lt;/p>
&lt;ul>
&lt;li>注意：
&lt;ul>
&lt;li>在 nginx 的配置文件中，如果当前模块中没有 proxy_set_header 的设置，则会从上级别继承配置。继承顺序为：http, server, location。&lt;/li>
&lt;li>由于 UPSTREAM 服务器收到的请求报文所含 IP 为代理服务器的 IP，那么就需要在代理服务器上配置该项，把用户 IP 暴露给 UPSTREAM 服务器&lt;/li>
&lt;li>该指令最常用在 &lt;code>location{}&lt;/code> 块指令中，以便为每个路径的 HTTP 请求，都设置各自的 请求头。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_ssl_certificate-file">proxy_ssl_certificate file;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ssl_certificate">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ssl_certificate&lt;/a>&lt;/p>
&lt;p>指定 PEM 格式的证书文件，Ngxin 作为客户端向被代理的 HTTPS 服务器发起请求时，用来进行身份验证&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_ssl_certificate_key-file">proxy_ssl_certificate_key file;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ssl_certificate_key">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ssl_certificate_key&lt;/a>&lt;/p>
&lt;p>指定 PEM 格式的密钥，Ngxin 作为客户端向被代理的 HTTPS 服务器发起请求时，用来进行身份验证&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="proxy_ssl_trusted_certificate-file">proxy_ssl_trusted_certificate FILE;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ssl_trusted_certificate">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ssl_trusted_certificate&lt;/a>&lt;/p>
&lt;p>指定想要信任的 CA 证书文件，Ngxin 作为客户端向被代理的 HTTPS 服务器发起请求时，用来进行身份验证&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="代理超时相关指令">代理超时相关指令&lt;/h3>
&lt;h4 id="proxy_connect_timeout-duration">proxy_connect_timeout DURATION;&lt;/h4>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_connect_timeout">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_connect_timeout&lt;/a>&lt;/p>
&lt;p>与被代理服务器建立连接的超时时间。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>proxy_connect_timeout 60s;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>注意：这个超时时间通常不应该超过 75 秒&lt;/p>
&lt;h4 id="proxy_read_timeout-duration">proxy_read_timeout DURATION;&lt;/h4>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_read_timeout">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_read_timeout&lt;/a>&lt;/p>
&lt;p>从被代理服务器读取响应的超时时间&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>proxy_read_timeout 60s;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>该超时时间仅在两个连续的&lt;strong>读取&lt;/strong>操作时间，而不是用于整个响应的传输。如果被代理服务器在这段时间内&lt;strong>未传输&lt;/strong>任何内容，则连接将关闭。&lt;/p>
&lt;p>所谓的两个连续读取操作，就是发送请求后，尝试读取响应的操作，其实就是读取 socket 中的数据。所以才被称为 等待被代理服务器响应的超时时间。&lt;/p>
&lt;p>当一个请求从 Client 发送到 Nginx 后，Nginx 再转发给被代理服务器，如果被代理服务器的响应时间超过了 proxy_read_timeout，则 Nginx 将会返回给 Client 一个 &lt;strong>504 状态码&lt;/strong>。&lt;/p>
&lt;h4 id="proxy_send_timeout-duration">proxy_send_timeout DURATION;&lt;/h4>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_send_timeout">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_send_timeout&lt;/a>&lt;/p>
&lt;p>将请求发送到被代理服务器的超时时间。&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>proxy_send_timeout 60s;&lt;/code>&lt;/li>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>该超时时间仅在两个连续的&lt;strong>写入&lt;/strong>操作时间，而不是用于整个响应的传输。如果被代理服务器在这段时间内&lt;strong>未收到&lt;/strong>任何内容，则连接将关闭&lt;/p>
&lt;h2 id="ngx_http_rewrite_moudle-模块指令">ngx_http_rewrite_moudle 模块指令&lt;/h2>
&lt;blockquote>
&lt;p>代码：&lt;a href="https://github.com/nginx/nginx/blob/master/src/http/modules/ngx_http_rewrite_module.c">https://github.com/nginx/nginx/blob/master/src/http/modules/ngx_http_rewrite_module.c&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 class=".." id="if-condition">if (Condition)&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if&lt;/a>&lt;/p>
&lt;p>用于 server 和 location 上下文中，类似于 if..else..这种编程语言&lt;/p>
&lt;ul>
&lt;li>作用范围：server{}、location{}&lt;/li>
&lt;/ul>
&lt;p>Condition 是具体的匹配条件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#e6db74">(&lt;/span>$remote_addr ~ &lt;span style="color:#e6db74">&amp;#34;^(12.34|56.78)&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;amp;&amp;amp;&lt;/span> $http_user_agent ~&lt;span style="color:#e6db74">*&lt;/span> &lt;span style="color:#e6db74">&amp;#34;spider&amp;#34;)&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">return&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="return-code-text--url">return CODE [TEXT | URL];&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return&lt;/a>&lt;/p>
&lt;p>停止处理，并讲指定的状态码返回给客户端。常与 listen 指令的 default_server 参数一起使用，并指定状态码非 200，当客户端访问的域名不存在时，通过默认的 Virtual Server 处理，返回非 200 的状态码。&lt;/p>
&lt;ul>
&lt;li>作用范围：server{}、location{}、if{}&lt;/li>
&lt;/ul>
&lt;h3 id="rewrite-regex-replacement-flag">rewrite RegEx Replacement [FLAG];&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite&lt;/a>&lt;/p>
&lt;p>URL 重写，把 RegEx 匹配到的资源重定向到 Replacement 定义的位置&lt;/p>
&lt;ul>
&lt;li>Flag 的用法：
&lt;ul>
&lt;li>last，此 rewrite 规则重写完成后，不再被后面的其他 rewrite 规则进行处理，由 User Agent 重新对重写后 URL 发起新请求&lt;/li>
&lt;li>break，一旦此 rewrite 规则重写完成后，由 User Agent 重新对重写后的 URL 发起新请求，该新请求不再进行 rewrite 检查&lt;/li>
&lt;li>redirect，以 302 响应码，返回新的 URL，即在 web 界面地址栏上显示的 URL 也变了，注意跟前面两个 Flag 的区别&lt;/li>
&lt;li>permanent，以 301 响应码，返回新的 URL&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>EXAMPLE
&lt;ul>
&lt;li>rewrite ^/images/(.*.jpg)$ /imgs/$1 break; # 把请求到 images 目录下的所有资源重定向到 imgs 目录下&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="其他模块指令">其他模块指令&lt;/h2>
&lt;h3 id="add_header-name-value-always">add_header NAME VALUE [always];&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header">http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header&lt;/a>&lt;/p>
&lt;p>重定义发往 client 的响应首部报文&lt;/p>
&lt;ul>
&lt;li>作用范围：http{}、server{}、location{}&lt;/li>
&lt;/ul>
&lt;h3 id="index-file">index FILE;&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_index_module.html#index">http://nginx.org/en/docs/http/ngx_http_index_module.html#index&lt;/a>&lt;/p>
&lt;p>设定默认主页面&lt;/p>
&lt;h3 id="stub_status-onoff">stub_status on|off&lt;/h3>
&lt;p>&lt;a href="http://nginx.org/en/docs/http/ngx_http_stub_status_module.html#stub_status">http://nginx.org/en/docs/http/ngx_http_stub_status_module.html#stub_status&lt;/a>&lt;/p>
&lt;p>开启或关闭监控模块，仅能用于 location 上下文&lt;/p>
&lt;h1 id="配置示例">配置示例&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">http&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://wss_svr.desistdaydream.ltd&lt;/span>; &lt;span style="color:#75715e"># 转发
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>; &lt;span style="color:#75715e"># 代理所用的 http 版本设为 1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real_IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $remote_addr:$remote_port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade; &lt;span style="color:#75715e"># set_header表示将http协议头升级为websocket协议
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">upgrade&lt;/span>; &lt;span style="color:#75715e"># set_header表示将http协议头升级为websocket协议
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: stream 模块指令</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/stream-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/stream-%E6%A8%A1%E5%9D%97%E6%8C%87%E4%BB%A4/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://nginx.org/en/docs/stream/ngx_stream_core_module.html">org 官方文档,stream core 模块&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/">官方文档,管理指南-负载均衡-TCP 与 UDP 负载均衡&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>stream 模块及其子模块通过 &lt;code>stream {}&lt;/code> 配置环境中的指令控制行为&lt;/p>
&lt;h2 id="简单的-stream-配置环境示例">简单的 stream{} 配置环境示例&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">stream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">stream_backend&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">least_conn&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> backend1.example.com:&lt;span style="color:#ae81ff">12345&lt;/span> &lt;span style="color:#e6db74">weight=5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> backend2.example.com:&lt;span style="color:#ae81ff">12345&lt;/span> &lt;span style="color:#e6db74">max_fails=2&lt;/span> &lt;span style="color:#e6db74">fail_timeout=30s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> backend3.example.com:&lt;span style="color:#ae81ff">12345&lt;/span> &lt;span style="color:#e6db74">max_conns=3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">dns_servers&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">least_conn&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 192.168.136.130:&lt;span style="color:#ae81ff">53&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 192.168.136.131:&lt;span style="color:#ae81ff">53&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 192.168.136.132:&lt;span style="color:#ae81ff">53&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">12345&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">stream_backend&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_timeout&lt;/span> &lt;span style="color:#e6db74">3s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_connect_timeout&lt;/span> &lt;span style="color:#e6db74">1s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">53&lt;/span> &lt;span style="color:#e6db74">udp&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">dns_servers&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">12346&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> backend4.example.com:&lt;span style="color:#ae81ff">12346&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="virtual-server-基本配置">Virtual Server 基本配置&lt;/h1>
&lt;h2 id="流量入口指令">流量入口指令&lt;/h2>
&lt;p>注意：流量入口的指令通常都定义在 &lt;code>server{} 块指令&lt;/code> 中。&lt;/p>
&lt;h3 id="server-httpnginxorgendocshttpngx_http_core_modulehtmlserver">&lt;a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#server">server {&amp;hellip;}&lt;/a>&lt;/h3>
&lt;p>定义 Virtual Server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">stream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">12345&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">53&lt;/span> &lt;span style="color:#e6db74">udp&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="listen-target-parameterhttpnginxorgendocsstreamngx_stream_core_modulehtmllisten">&lt;a href="http://nginx.org/en/docs/stream/ngx_stream_core_module.html#listen">listen TARGET [PARAMETER];&lt;/a>&lt;/h3>
&lt;p>指定 Virtual Server 监听的端口，也可加上 IP:PORT。每个 Virtual Server 的 listen 指令都会让 Nginx 监听一个 TARGET&lt;/p>
&lt;ul>
&lt;li>&lt;strong>TARGET&lt;/strong> 有多种格式
&lt;ul>
&lt;li>&lt;strong>ADDRESS:[PORT]&lt;/strong> # 监听在指定的 IP 和端口上，ADDRESS 可以使用通配符。&lt;/li>
&lt;li>&lt;strong>PORT&lt;/strong> # 省略地址，即监听在所有 IP 的指定端口上。&lt;/li>
&lt;li>&lt;strong>UNIX&lt;/strong> # 监听在以 unix: 为前缀的 UNIX 套接字上。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>PARAMETER&lt;/strong> 可以指定是 tcp 还是 udp 等等额外的信息。&lt;/li>
&lt;/ul>
&lt;h2 id="流量处理指令">流量处理指令&lt;/h2>
&lt;p>&lt;code>stream{}&lt;/code> 配置环境中的流量处理指令直接配置在 &lt;code>server{} 指令块&lt;/code>中即可。与 &lt;code>http{}&lt;/code> 配置环境不太一样，并没有 &lt;code>location{}&lt;/code> 块指令。&lt;/p>
&lt;h3 id="proxy_pass-addresshttpnginxorgendocsstreamngx_stream_proxy_modulehtmlproxy_pass">&lt;a href="http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html#proxy_pass">proxy_pass ADDRESS;&lt;/a>&lt;/h3>
&lt;p>将流量入口进来的流量代理到指定的 ADDRESS 上。该指令是 ngx_stream_proxy_module 模块的核心指令&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>无&lt;/code>&lt;/li>
&lt;li>作用范围：server{}&lt;/li>
&lt;/ul>
&lt;p>ADDRESS 有多种表示方法&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ServerGroup&lt;/strong> # 将流量代理到&lt;a href="https://www.yuque.com/go/doc/34075747">一组服务器&lt;/a>上。每个流量都会根据负载均衡的规则交给 upstream{} 指令块中定义的服务器。
&lt;ul>
&lt;li>新版中，也可以省略 Protocol://，直接使用 ServerGroup 的名称即可。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>IP:PORT&lt;/strong> # ，当只有一台可用的后端服务器时可以使用这种方式，这样就不用再使用 upstream 指令块定义了&lt;/li>
&lt;li>&lt;strong>unix:/PATH/TO/FILE;&lt;/strong> # 将流量代理到本地的 UNIX-domain Socket 上&lt;/li>
&lt;/ul>
&lt;p>在[其他指令](/docs/IT学习笔记/3.集群与分布式/Nginx/Nginx%20 配置详解/stream%20 模块指令.md 模块指令.md)中，以 &lt;code>proxy_&lt;/code> 开头的简单指令，都可以作为 &lt;code>proxy_pass&lt;/code> 指令的扩充，以定义更加丰富多样的流量处理功能。&lt;/p>
&lt;h1 id="其他指令">其他指令&lt;/h1>
&lt;p>这些指令一般都直接定义在顶层的 &lt;code>stream{}&lt;/code> 配置环境中，与 &lt;code>server{}&lt;/code>、&lt;code>upstream{}&lt;/code> 等块指令平级。还有一些指令是可以适用于多个指令块中的。定义在顶层的 &lt;code>stream{}&lt;/code> 配置环境中时，效果将会应用在每个 Virtual Server 中，同时也可以定义在单独的指令块中，让指令作用于局部。&lt;/p>
&lt;h2 id="ngx_stream_proxy_module-模块指令">ngx_stream_proxy_module 模块指令&lt;/h2>
&lt;blockquote>
&lt;p>代码：&lt;a href="https://github.com/nginx/nginx/blob/master/src/stream/ngx_stream_proxy_module.c">https://github.com/nginx/nginx/blob/master/src/stream/ngx_stream_proxy_module.c&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="超时相关指令">超时相关指令&lt;/h3>
&lt;h4 id="proxy_connect_timeout-durationhttpnginxorgendocsstreamngx_stream_proxy_modulehtmlproxy_connect_timeout">&lt;a href="http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html#proxy_connect_timeout">proxy_connect_timeout DURATION;&lt;/a>&lt;/h4>
&lt;p>与被代理服务器建立连接的超时时间&lt;/p>
&lt;ul>
&lt;li>默认值：&lt;code>proxy_connect_timeout 60s;&lt;/code>&lt;/li>
&lt;li>作用范围：stream{}、server{}&lt;/li>
&lt;/ul>
&lt;h1 id="配置示例">配置示例&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">stream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">konggang_dashboard&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 10.10.16.19:&lt;span style="color:#ae81ff">32000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 10.10.16.20:&lt;span style="color:#ae81ff">32000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">32000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">konggang_dashboard&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_connect_timeout&lt;/span> &lt;span style="color:#e6db74">10s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 其他属于 NGX_CORE_MODULE 类型的模块</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%85%B6%E4%BB%96%E5%B1%9E%E4%BA%8E-ngx_core_module-%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A8%A1%E5%9D%97/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%85%B6%E4%BB%96%E5%B1%9E%E4%BA%8E-ngx_core_module-%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A8%A1%E5%9D%97/</guid><description>
&lt;h1 id="ngx_conf_module">NGX_CONF_MODULE&lt;/h1>
&lt;p>&lt;a href="http://nginx.org/en/docs/ngx_core_module.html#include">&lt;strong>include /PATH/FILE&lt;/strong>&lt;/a> # 在该配置中包含一个网站-可用的配置文件，即把定义的文件内容引入到这里，(也可以写入多个 include，引入多个配置文件以便管理，包括但不限于 server 配置，还可以是 nginx 的配置文件，mail 的配置文件等)&lt;/p>
&lt;ul>
&lt;li>作用范围：可以作用在任意 Contexts 中&lt;/li>
&lt;/ul>
&lt;p>该指令可以写在任意 块指令 中，只要被包含的文件格式，符合当前 块指令 应该包含的语法即可。&lt;/p></description></item><item><title>Docs: Nginx 作为web服务器配置示例</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/nginx-%E4%BD%9C%E4%B8%BAweb%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/nginx-%E4%BD%9C%E4%B8%BAweb%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</guid><description>
&lt;h1 id="nginx-的-location-里面的-rootalias-的使用技巧与区别">Nginx 的 location 里面的 root、alias 的使用技巧与区别&lt;/h1>
&lt;blockquote>
&lt;p>知乎：&lt;a href="https://zhuanlan.zhihu.com/p/379076598">https://zhuanlan.zhihu.com/p/379076598&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="location">location&lt;/h2>
&lt;p>Nginx 里面的 location，可以针对一个特殊的 URI 路径进行单独的设置。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">location&lt;/span> &lt;span style="color:#f92672">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">root&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">tongfu&lt;/span>.&lt;span style="color:#a6e22e">net&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">web&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#66d9ef">static&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在 location 块里面可以单独设置映射目录、重写逻辑、默认文档等等。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">location&lt;/span> &lt;span style="color:#f92672">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">root&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">tongfu&lt;/span>.&lt;span style="color:#a6e22e">net&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">web&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">download&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">index&lt;/span> &lt;span style="color:#a6e22e">index&lt;/span>.&lt;span style="color:#a6e22e">htm&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">location&lt;/span> &lt;span style="color:#f92672">~&lt;/span> &lt;span style="color:#f92672">^&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">download&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">/&lt;/span>.&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>.(&lt;span style="color:#a6e22e">zip&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#a6e22e">rar&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#a6e22e">tgz&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#a6e22e">gz&lt;/span>)&lt;span style="color:#a6e22e">$&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rewrite&lt;/span> &lt;span style="color:#f92672">^&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">download&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">/&lt;/span>(.&lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#a6e22e">$&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">downloadValidation&lt;/span>.&lt;span style="color:#a6e22e">php&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#a6e22e">$1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="root">root&lt;/h2>
&lt;p>Nginx 里面的 root 参数用来指定映射根目录，末尾不加“/”。&lt;/p>
&lt;h3 id="主机默认目录">主机默认目录&lt;/h3>
&lt;p>直接在 server 里面设置 root 就是设置主机的根目录。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">root&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">tongfu&lt;/span>.&lt;span style="color:#a6e22e">net&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">web&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#66d9ef">static&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="匹配-uri-目录">匹配 URI 目录&lt;/h3>
&lt;p>在 location 里面设置 root 就是设置匹配 URI 的根目录。&lt;/p>
&lt;p>下面的例子里如果访问 &lt;a href="https://link.zhihu.com/?target=http%3A//localhost/icon/abc.png">http://localhost/icon/abc.png&lt;/a> 网址，映射到的服务器路径是 /tongfu.net/web/icons**/icon/abc.png**。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">location&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">icon&lt;/span>&lt;span style="color:#f92672">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">root&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">tongfu&lt;/span>.&lt;span style="color:#a6e22e">net&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">web&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">icons&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="alias">alias&lt;/h2>
&lt;p>Nginx 里面的 root 参数用来指定映射目录，末尾需要加“/”。&lt;/p>
&lt;p>下面的例子里如果访问 &lt;a href="https://link.zhihu.com/?target=http%3A//localhost/icon/abc.png">http://localhost/icon/abc.png&lt;/a> 网址，映射到的服务器路径是 /tongfu.net/web/icons/&lt;strong>abc.png&lt;/strong>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">location&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">icon&lt;/span>&lt;span style="color:#f92672">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">alias&lt;/span> &lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">tongfu&lt;/span>.&lt;span style="color:#a6e22e">net&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">web&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#a6e22e">icons&lt;/span>&lt;span style="color:#f92672">/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="nginx-代理-vue-项目的单页应用刷新后-404-问题">Nginx 代理 Vue 项目的单页应用刷新后 404 问题&lt;/h1>
&lt;p>在 location 中添加 &lt;code>try_files $uri $uri/ /index.html;&lt;/code>&lt;/p></description></item><item><title>Docs: Nginx 作为代理服务器配置示例</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/nginx-%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/nginx-%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</guid><description>
&lt;h1 id="概述">概述&lt;/h1>
&lt;blockquote>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://mp.weixin.qq.com/s/27IuQAe8UZGXIdNApE2Ljg">公众号，Nginx 代理 WebSocket 方法&lt;/a>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="7-层代理配置">7 层代理配置&lt;/h1>
&lt;p>这个配置里的 172.19.42.217 是 kubernetes 集群的入口，一般在 80 和 443 上都起一个 ingress controler，这样，多种域名都代理到同一个 kubernetes 集群，然后由 ingress 再将流量进行路由分配。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">user&lt;/span> &lt;span style="color:#e6db74">nginx&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">worker_processes&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">error_log&lt;/span> &lt;span style="color:#e6db74">/dev/stdout&lt;/span> &lt;span style="color:#e6db74">warn&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pid&lt;/span> &lt;span style="color:#e6db74">/var/run/nginx.pid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">events&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">worker_connections&lt;/span> &lt;span style="color:#ae81ff">102400&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">http&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">default_type&lt;/span> &lt;span style="color:#e6db74">application/octet-stream&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">access_log&lt;/span> &lt;span style="color:#e6db74">/dev/stdout&lt;/span> &lt;span style="color:#e6db74">main&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">keepalive_timeout&lt;/span> &lt;span style="color:#ae81ff">120&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">log_format&lt;/span> &lt;span style="color:#e6db74">main&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>$remote_addr &lt;span style="color:#e6db74">-&lt;/span> $remote_user &lt;span style="color:#e6db74">[&lt;/span>$time_local] &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$request&amp;#34; &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>$status $body_bytes_sent &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$http_referer&amp;#34; &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&amp;#34;&lt;/span>$http_user_agent&amp;#34; &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$http_x_forwarded_for&amp;#34;&amp;#39;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;&lt;/span>$upstream_addr &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;ups_resp_time:&lt;/span> $upstream_response_time &lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;request_time:&lt;/span> $request_time&amp;#39;;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sendfile&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_names_hash_bucket_size&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">grafana.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">prometheus.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">alertmanager.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">nacos.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">www.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_in_file_only&lt;/span> &lt;span style="color:#e6db74">clean&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_buffer_size&lt;/span> &lt;span style="color:#e6db74">64K&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_max_body_size&lt;/span> &lt;span style="color:#e6db74">40M&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sendfile&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">send_timeout&lt;/span> &lt;span style="color:#e6db74">300s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.19.42.217/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-Proto&lt;/span> $scheme;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">include&lt;/span> &lt;span style="color:#e6db74">/etc/nginx/mime.types&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">include&lt;/span> &lt;span style="color:#e6db74">/etc/nginx/conf.d/*.conf&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">include&lt;/span> &lt;span style="color:#e6db74">/etc/nginx/conf.d/protal/*.conf&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="4-层代理配置">4 层代理配置&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">user&lt;/span> &lt;span style="color:#e6db74">nginx&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">worker_processes&lt;/span> &lt;span style="color:#e6db74">auto&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">error_log&lt;/span> &lt;span style="color:#e6db74">/var/log/nginx/error.log&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">pid&lt;/span> &lt;span style="color:#e6db74">/run/nginx.pid&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">include&lt;/span> /usr/share/nginx/modules/*.conf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">events&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">worker_connections&lt;/span> &lt;span style="color:#ae81ff">10240&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">stream&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">include&lt;/span> &lt;span style="color:#e6db74">stream.d/*.conf&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">grafana&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 172.38.40.216:&lt;span style="color:#ae81ff">30000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 172.38.40.217:&lt;span style="color:#ae81ff">30000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">upstream&lt;/span> &lt;span style="color:#e6db74">prometheus&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 172.38.40.216:&lt;span style="color:#ae81ff">30001&lt;/span> &lt;span style="color:#e6db74">weight=8&lt;/span> &lt;span style="color:#e6db74">max_fails=2&lt;/span> &lt;span style="color:#e6db74">fail_timeout=30s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> 172.38.40.217:&lt;span style="color:#ae81ff">30001&lt;/span> &lt;span style="color:#e6db74">weight=8&lt;/span> &lt;span style="color:#e6db74">max_fails=2&lt;/span> &lt;span style="color:#e6db74">fail_timeout=30s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">30000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">grafana&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_connect_timeout&lt;/span> &lt;span style="color:#e6db74">10s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">30001&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">prometheus&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_connect_timeout&lt;/span> &lt;span style="color:#e6db74">2s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">http&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="待整理配置示例">待整理配置示例&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">grafana.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">prometheus.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">alertmanager.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">nacos.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">www.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_in_file_only&lt;/span> &lt;span style="color:#e6db74">clean&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_buffer_size&lt;/span> &lt;span style="color:#e6db74">64K&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_max_body_size&lt;/span> &lt;span style="color:#e6db74">40M&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sendfile&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">send_timeout&lt;/span> &lt;span style="color:#e6db74">300s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://172.19.42.217/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-Proto&lt;/span> $scheme;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="https">https&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">443&lt;/span> &lt;span style="color:#e6db74">ssl&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">rancher.desistdaydream.ltd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ssl&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># crt证书
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">ssl_certificate&lt;/span> &lt;span style="color:#e6db74">../keys/bj/rancher.desistdaydream.ltd.crt&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># key证书
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">ssl_certificate_key&lt;/span> &lt;span style="color:#e6db74">../keys/bj/rancher.desistdaydream.ltd.key&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_in_file_only&lt;/span> &lt;span style="color:#e6db74">clean&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_body_buffer_size&lt;/span> &lt;span style="color:#e6db74">64K&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">client_max_body_size&lt;/span> &lt;span style="color:#e6db74">40M&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sendfile&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">send_timeout&lt;/span> &lt;span style="color:#e6db74">300s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">https://172.19.42.217:60443/&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Real-IP&lt;/span> $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Host&lt;/span> $host;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-For&lt;/span> $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">X-Forwarded-Proto&lt;/span> $scheme;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_http_version&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#e6db74">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Upgrade&lt;/span> $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_set_header&lt;/span> &lt;span style="color:#e6db74">Connection&lt;/span> &lt;span style="color:#e6db74">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: 多用途模块的指令</title><link>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://desistdaydream.github.io/docs/it%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/nginx/nginx-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/%E5%A4%9A%E7%94%A8%E9%80%94%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8C%87%E4%BB%A4/</guid><description/></item></channel></rss>